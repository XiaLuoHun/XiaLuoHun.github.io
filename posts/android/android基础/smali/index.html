<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Smali - 夏洛魂的个人博客</title><meta name="Description" content="个人笔记本"><meta property="og:title" content="Smali" />
<meta property="og:description" content="Smali Smali是Android dex文件的反汇编. Dalvik 概述 Android移动设备平台的核心组成部分之一,支持已转换为.dex(即Dalvik Ex" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/smali/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-09-05T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Smali"/>
<meta name="twitter:description" content="Smali Smali是Android dex文件的反汇编. Dalvik 概述 Android移动设备平台的核心组成部分之一,支持已转换为.dex(即Dalvik Ex"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/smali/" /><link rel="prev" href="https://XiaLuoHun.github.io/posts/%E5%B9%B3%E5%8F%B0api/github/" /><link rel="next" href="https://XiaLuoHun.github.io/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/cobaltstrike/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Smali",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/XiaLuoHun.github.io\/posts\/android\/android%E5%9F%BA%E7%A1%80\/smali\/"
        },"genre": "posts","keywords": "Smali","wordcount":  6286 ,
        "url": "https:\/\/XiaLuoHun.github.io\/posts\/android\/android%E5%9F%BA%E7%A1%80\/smali\/","datePublished": "2021-09-05T00:00:00+00:00","dateModified": "2021-09-05T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "夏洛魂"},"author": {
                "@type": "Person",
                "name": "夏洛魂"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="夏洛魂的个人博客">主页</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于作者 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="夏洛魂的个人博客">主页</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于作者</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Smali</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>夏洛魂</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/android%E5%9F%BA%E7%A1%80/"><i class="far fa-folder fa-fw"></i>Android基础</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-09-05">2021-09-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 6286 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 13 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#smali">Smali</a>
          <ul>
            <li><a href="#dalvik">Dalvik</a>
              <ul>
                <li><a href="#概述">概述</a></li>
                <li><a href="#指令格式">指令格式</a>
                  <ul>
                    <li><a href="#instruction-formatshtml">instruction-formats.html</a></li>
                    <li><a href="#dalvik-bytecodehtml">dalvik-bytecode.html</a></li>
                  </ul>
                </li>
                <li><a href="#字符串池">字符串池</a></li>
              </ul>
            </li>
            <li><a href="#dex反汇编工具">Dex反汇编工具</a>
              <ul>
                <li>
                  <ul>
                    <li><a href="#dexdump">Dexdump</a></li>
                    <li><a href="#ida">IDA</a></li>
                    <li><a href="#dex2jar和jd-gui">dex2jar和jd-gui</a></li>
                    <li><a href="#jeb神器">JEB(神器)</a></li>
                    <li><a href="#baksmali">baksmali</a></li>
                    <li><a href="#smali-1">smali</a></li>
                    <li><a href="#apktool">apktool</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#smali汇编">Smali汇编</a>
              <ul>
                <li><a href="#概述-1">概述</a>
                  <ul>
                    <li><a href="#寄存器">寄存器</a></li>
                    <li><a href="#类型表示">类型表示</a></li>
                    <li><a href="#方法表示">方法表示</a></li>
                    <li><a href="#字段表示">字段表示</a></li>
                    <li><a href="#参数与局部变量的区分">参数与局部变量的区分</a>
                      <ul>
                        <li><a href="#java代码">Java代码</a></li>
                        <li><a href="#对应的smali示例">对应的smali示例</a></li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><a href="#指令">指令</a>
                  <ul>
                    <li><a href="#nop">nop</a></li>
                    <li><a href="#move">move</a>
                      <ul>
                        <li><a href="#4字节整型传送">4字节整型传送</a></li>
                        <li><a href="#8字节整型传送">8字节整型传送</a></li>
                        <li><a href="#对象传送">对象传送</a></li>
                        <li><a href="#取返回值">取返回值</a></li>
                        <li><a href="#取异常">取异常</a></li>
                      </ul>
                    </li>
                    <li><a href="#return">return</a></li>
                    <li><a href="#const">const</a></li>
                    <li><a href="#monitor">monitor</a></li>
                    <li><a href="#check-case">check-case</a></li>
                    <li><a href="#instance-of">instance-of</a></li>
                    <li><a href="#new-instance">new-instance</a></li>
                    <li><a href="#数组">数组</a></li>
                    <li><a href="#分支">分支</a>
                      <ul>
                        <li><a href="#if">if</a></li>
                        <li><a href="#switch">Switch</a></li>
                        <li><a href="#for">for</a></li>
                        <li><a href="#while">while</a></li>
                        <li><a href="#do-while">do-while</a></li>
                      </ul>
                    </li>
                    <li><a href="#字段操作">字段操作</a>
                      <ul>
                        <li><a href="#非静态字段">非静态字段</a></li>
                        <li><a href="#静态字段">静态字段</a></li>
                      </ul>
                    </li>
                    <li><a href="#方法操作">方法操作</a></li>
                    <li><a href="#异常">异常</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#smali调试">Smali调试</a>
              <ul>
                <li><a href="#jdbexe">jdb.exe</a>
                  <ul>
                    <li><a href="#jdwp协议">jdwp协议</a></li>
                    <li><a href="#jdb所在目录">jdb所在目录</a></li>
                  </ul>
                </li>
                <li><a href="#android调试运行">Android调试运行</a>
                  <ul>
                    <li><a href="#androidmenifest文件说明debug">AndroidMenifest文件说明Debug</a></li>
                    <li><a href="#使用am调试运行">使用am调试运行</a>
                      <ul>
                        <li><a href="#查看帮助">查看帮助</a></li>
                        <li><a href="#调试运行一个activity">调试运行一个Activity</a></li>
                      </ul>
                    </li>
                  </ul>
                </li>
                <li><a href="#jeb">Jeb</a>
                  <ul>
                    <li><a href="#被调试程序源代码">被调试程序源代码</a></li>
                    <li><a href="#附加调试">附加调试</a></li>
                  </ul>
                </li>
                <li><a href="#androidstudio推荐">AndroidStudio(推荐)</a>
                  <ul>
                    <li><a href="#下载smali反汇编插件-smalidea">下载Smali反汇编插件 smalidea.</a></li>
                    <li><a href="#安装插件">安装插件.</a></li>
                    <li><a href="#使用apktool反编译apk">使用apktool反编译apk.</a></li>
                    <li><a href="#使用as导入刚反编译出来的文件">使用AS导入刚反编译出来的文件</a></li>
                    <li><a href="#调试运行一个activity-1">调试运行一个Activity</a></li>
                    <li><a href="#端口映射">端口映射</a></li>
                    <li><a href="#as下断远程附加">AS下断,远程附加</a></li>
                  </ul>
                </li>
                <li><a href="#反调试">反调试</a>
                  <ul>
                    <li><a href="#检测调试标志">检测调试标志</a></li>
                    <li><a href="#时间差">时间差</a></li>
                    <li><a href="#检测ida端口号23946">检测IDA端口号23946</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="smali">Smali</h2>
<p>Smali是Android dex文件的反汇编.</p>
<h3 id="dalvik">Dalvik</h3>
<h4 id="概述">概述</h4>
<ul>
<li>
<p>Android移动设备平台的核心组成部分之一,支持已转换为.dex(即Dalvik Executable)格式的Java应用程序的运行.</p>
</li>
<li>
<p>允许在有限的内存中同时运行多个虚拟机的实例,并且每一个Dalvik应用作为一个独立的Linux进程执行.</p>
</li>
<li>
<p>2014年6月5号,ART虚拟机代替Dalvik虚拟机.</p>
</li>
</ul>
<h4 id="指令格式">指令格式</h4>
<p>低版本NDK的源码中有Dalvik指令格式介绍,这里我们使用在线的Android源码查看Dalvik指令格式
<a href="http://androidxref.com/" target="_blank" rel="noopener noreffer">http://androidxref.com/</a></p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/smali/Smali_Dalvik%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F.7z" rel="">Smali_Dalvik指令格式.7z</a></p>
<h5 id="instruction-formatshtml">instruction-formats.html</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e6%8c%87%e4%bb%a4%e6%a0%bc%e5%bc%8f1.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png, images/Smali/%e6%8c%87%e4%bb%a4%e6%a0%bc%e5%bc%8f1.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png"
        title="指令格式1" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e6%8c%87%e4%bb%a4%e6%a0%bc%e5%bc%8f2.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F2.png, images/Smali/%e6%8c%87%e4%bb%a4%e6%a0%bc%e5%bc%8f2.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F2.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F2.png"
        title="指令格式2" /></p>
<p>上图中,左侧每一个字母表示4位,空格表示16位.
中间一列的 22x
第一个2表示有几个16位, 第二个2表示有几个寄存器,第三个x表示没有附加数值.</p>
<h5 id="dalvik-bytecodehtml">dalvik-bytecode.html</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e6%8c%87%e4%bb%a4%e6%a0%bc%e5%bc%8f3.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F3.png, images/Smali/%e6%8c%87%e4%bb%a4%e6%a0%bc%e5%bc%8f3.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F3.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F3.png"
        title="指令格式3" /></p>
<p>解析指令的时候,先根据op拿到指令格式,然后去instruction-formats.html查.</p>
<h4 id="字符串池">字符串池</h4>
<p>例子：op VAA, string@BBBB
指令用到了1个寄存器参数vAA,并且还附加了一个字符串常量池索引string@BBBB</p>
<p>mov v0, &ldquo;Hello&rdquo;
mov v0, 0x12345678
以上两种对于解释执行的语言来说都是不可以的.
我们可以做个池,通常来说是个哈希表,如:
0 &ldquo;Hello Luo&rdquo;
1 &ldquo;HelloHun&rdquo;
代码就可以写成 mov v0, 0,但是这样无法区分是给数值0还是池的下标,
所有我们通常这样写,mov v0, string@0</p>
<h3 id="dex反汇编工具">Dex反汇编工具</h3>
<h5 id="dexdump">Dexdump</h5>
<p>Android自带的,开源.</p>
<h5 id="ida">IDA</h5>
<p>可以用来看Smali汇编.</p>
<h5 id="dex2jar和jd-gui">dex2jar和jd-gui</h5>
<p>Java字节码&ndash;&gt;Dex字节码
Dex字节码&ndash;&gt;Java字节码
Java有很多成熟的反编译工具,
我们可以利用dex2jar这个工具将Dex字节码转换为Java字节码,就可以使用Java的反编译工具了.
<strong>需要注意的是</strong>,jd-gui的反编译结果不是很可靠.</p>
<h5 id="jeb神器">JEB(神器)</h5>
<p>将IDA的每个字母加1就是JEB.</p>
<p>Android版的IDA.</p>
<h5 id="baksmali">baksmali</h5>
<p>反汇编Dex文件.</p>
<h5 id="smali-1">smali</h5>
<p>将修改后的smali文件重新编译为Dex文件.
通常我们使用Jeb寻找关键位置,然后baksmali修改,smali重新编译.
但是这样太麻烦了,就有了apktool.</p>
<h5 id="apktool">apktool</h5>
<p>Google提供的apk编译工具,内部用baksmail,加了资源的解析和编译.</p>
<h3 id="smali汇编">Smali汇编</h3>
<h4 id="概述-1">概述</h4>
<h5 id="寄存器">寄存器</h5>
<p>Dalvik是基于寄存器的虚拟机,没有栈,寄存器为v0-v65535.</p>
<p>不用任何寄存器存函数返回值.</p>
<h5 id="类型表示">类型表示</h5>
<table>
<thead>
<tr>
<th>语法</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>V</td>
<td>void</td>
</tr>
<tr>
<td>Z</td>
<td>boolean</td>
</tr>
<tr>
<td>B</td>
<td>byte</td>
</tr>
<tr>
<td>S</td>
<td>short</td>
</tr>
<tr>
<td>C</td>
<td>char</td>
</tr>
<tr>
<td>I</td>
<td>int</td>
</tr>
<tr>
<td>J</td>
<td>long</td>
</tr>
<tr>
<td>F</td>
<td>float</td>
</tr>
<tr>
<td>D</td>
<td>double</td>
</tr>
<tr>
<td>L</td>
<td>类类型</td>
</tr>
<tr>
<td>[</td>
<td>一维数组</td>
</tr>
<tr>
<td>[[</td>
<td>二维数组</td>
</tr>
<tr>
<td>[[[</td>
<td>三维数组</td>
</tr>
</tbody>
</table>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">myAdd</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="方法表示">方法表示</h5>
<p>Dalvik使用<strong>方法名</strong>,<strong>参数</strong>,<strong>返回值</strong>来描述一个方法.</p>
<p><strong>方法格式</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">LPackage/Name/ObjectName;-&gt;MethodName(III) Z
LPackage/Name/ObjectName; : 类类型
MethodName : 方法名
(III) : 为参数类型(int,int,int)
Z : 为返回值类型(boolean)
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="nf">invoke-virtual</span> <span class="err">{</span><span class="no">p0</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span><span class="err">}</span><span class="p">,</span> <span class="no">Lorg</span><span class="err">/</span><span class="no">example</span><span class="err">/</span><span class="no">luotst</span><span class="err">/</span><span class="no">MainActivity</span><span class="c">;-&gt;myAdd(II)I
</span></code></pre></td></tr></table>
</div>
</div><h5 id="字段表示">字段表示</h5>
<p>Dalvik使用<strong>类类型</strong>,<strong>字段名字</strong>,<strong>字段类型</strong>来描述一个字段.</p>
<p><strong>字段格式</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">LPackage/Name/ObjectName;-&gt;FieldName:Ljava/lang/String
LPackage/Name/ObjectName; : 类类型
FieldName : 为字段名称
Ljava/lang/String : 为字段类型
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.line</span> <span class="mi">23</span>
<span class="nf">const</span><span class="err">/</span><span class="mi">16</span> <span class="no">v0</span><span class="p">,</span> <span class="mi">0x14</span>

<span class="nf">iput</span> <span class="no">v0</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">Lorg</span><span class="err">/</span><span class="no">example</span><span class="err">/</span><span class="no">luotst</span><span class="err">/</span><span class="no">MainActivity</span><span class="c">;-&gt;mData1:I
</span><span class="c"></span>
<span class="na">.line</span> <span class="mi">24</span>
<span class="nf">const-string</span> <span class="no">v0</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">LuoHun</span><span class="err">&#34;</span>

<span class="nf">iput-object</span> <span class="no">v0</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">Lorg</span><span class="err">/</span><span class="no">example</span><span class="err">/</span><span class="no">luotst</span><span class="err">/</span><span class="no">MainActivity</span><span class="c">;-&gt;mData2:Ljava/lang/String;
</span></code></pre></td></tr></table>
</div>
</div><h5 id="参数与局部变量的区分">参数与局部变量的区分</h5>
<h6 id="java代码">Java代码</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">myAdd</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
     <span class="kt">int</span> <span class="n">l1</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
     <span class="kt">int</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">20</span><span class="o">;</span>
     <span class="k">return</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="o">;</span>
 <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="对应的smali示例">对应的smali示例</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">myAdd</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">6</span>
<span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v0</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">00000004</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v1</span><span class="p">,</span> <span class="mi">20</span>
<span class="err">00000008</span>  <span class="nf">add-int</span>             <span class="no">v2</span><span class="p">,</span> <span class="no">p1</span><span class="p">,</span> <span class="no">p2</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">return</span>              <span class="no">v2</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><p>上图中p1,p2是Jeb为我们显示的,这是P命名法,为了修改代码和我们识别函数参数方便而设计的,实际上是寄存器v4,v5.</p>
<p>smali中的局部变量使用的寄存器是V0-Vn,参数使用的寄存器是Vn+1-Vm.
从上图中可以看到用了6个寄存器,myAdd的参数声明中用了2个,加上this指针就是3个,也就是说v3-v5是参数,
从而推出v0-v2是局部变量,需要注意的是v3中存放的是this指针.
需要提一点的是,P命名法的好处,假如说我们新增了一个局部变量寄存器,这样的话,参数寄存器就会全变动,十分麻烦,使用P命名法,我们新增了一个局部变量寄存器,重新编译的时候,工具会帮我们自动将原来的参数寄存器加1.</p>
<h4 id="指令">指令</h4>
<p>主要查看dalvik-bytecode.html文件.</p>
<h5 id="nop">nop</h5>
<p>空操作,通常是为了地址对齐.</p>
<h5 id="move">move</h5>
<h6 id="4字节整型传送">4字节整型传送</h6>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/move1.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move1.png, images/Smali/move1.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move1.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move1.png"
        title="move1" /></p>
<p>Dalvik是基于寄存器的,没有栈的概念,全部用寄存器操作,寄存器最大有65536个.
上述第一条指令用4位表示寄存器,4位可表示的寄存器范围为v0-v15,
若是一个函数局部变量很多,寄存器使用超过了16个,第一条指令就放不下了,
所以有了第2和第3条指令.
/from表示源寄存器用16位表示
/16表示目标和源寄存器均用16位表示.</p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">l1</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">20</span><span class="o">;</span>
<span class="n">l1</span> <span class="o">=</span> <span class="n">l2</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v0</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">00000004</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v1</span><span class="p">,</span> <span class="mi">20</span>
<span class="err">00000008</span>  <span class="nf">move</span>                <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="8字节整型传送">8字节整型传送</h6>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/move2.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move2.png, images/Smali/move2.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move2.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move2.png"
        title="move2" /></p>
<p>寄存器是32位的,long是64位,一个寄存器放不下,所以用两个相邻的寄存器存放64位整型,
move-wide就是用来传送64位整型.</p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">long</span> <span class="n">l1</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
<span class="kt">long</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">20</span><span class="o">;</span>
<span class="n">l1</span> <span class="o">=</span> <span class="n">l2</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">00000000</span>  <span class="nf">const-wide</span><span class="err">/</span><span class="mi">16</span>       <span class="no">v0</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">00000004</span>  <span class="nf">const-wide</span><span class="err">/</span><span class="mi">16</span>       <span class="no">v2</span><span class="p">,</span> <span class="mi">20</span>
<span class="err">00000008</span>  <span class="nf">move-wide</span>           <span class="no">v0</span><span class="p">,</span> <span class="no">v2</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="对象传送">对象传送</h6>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/move3.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move3.png, images/Smali/move3.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move3.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move3.png"
        title="move3" /></p>
<p>mov-object用来传送类对象.</p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">MainActivity</span> <span class="n">m1</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">0000000</span><span class="nf">A</span>  <span class="no">move-object</span>         <span class="no">v4</span><span class="p">,</span> <span class="no">p0</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="取返回值">取返回值</h6>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/move4.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move4.png, images/Smali/move4.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move4.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move4.png"
        title="move4" /></p>
<p>在smali中,不用任何寄存器来存放函数的返回值,需要通过move-result来取函数的返回值.</p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">D</span><span class="o">){</span> <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&#34;onCreate&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">myAdd</span><span class="o">(</span><span class="n">100</span><span class="o">,</span> <span class="n">200</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">int</span> <span class="nf">myAdd</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">00000020</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v0</span><span class="p">,</span> <span class="mi">100</span>
<span class="err">00000024</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v1</span><span class="p">,</span> <span class="mi">200</span>
<span class="err">00000028</span>  <span class="nf">invoke-virtual</span>      <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">myAdd</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">0000002</span><span class="nf">E</span>  <span class="no">move-result</span>        <span class="no">v0</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="取异常">取异常</h6>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/move5.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move5.png, images/Smali/move5.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move5.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/move5.png"
        title="move5" /></p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="k">try</span> <span class="o">{</span>
          <span class="n">ServerSocket</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="n">0x5566</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">:</span><span class="nf">try_0</span>
<span class="err">00000000</span>  <span class="nf">new-instance</span>        <span class="no">v0</span><span class="p">,</span> <span class="no">ServerSocket</span>
<span class="err">00000004</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v1</span><span class="p">,</span> <span class="mi">0x5566</span>
<span class="err">00000008</span>  <span class="nf">invoke-direct</span>       <span class="no">ServerSocket-</span><span class="err">&gt;&lt;</span><span class="no">init</span><span class="err">&gt;</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
          <span class="na">.catch</span> <span class="no">IOException</span> <span class="err">{</span><span class="p">:</span><span class="no">try_0</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_E</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_10</span>
<span class="err">:</span><span class="nf">tryend_E</span>
<span class="err">0000000</span><span class="nf">E</span>  <span class="no">goto</span>                <span class="p">:</span><span class="mi">18</span>
<span class="err">:</span><span class="nf">catch_10</span>  <span class="c"># used for: Ljava/io/IOException;
</span><span class="c"></span><span class="mi">00000010</span>  <span class="no">move-exception</span>      <span class="no">v0</span>
<span class="err">00000012</span>  <span class="nf">invoke-virtual</span>      <span class="no">IOException-</span><span class="err">&gt;</span><span class="no">printStackTrace</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">v0</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="return">return</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/return.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/return.png, images/Smali/return.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/return.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/return.png"
        title="return" /></p>
<h5 id="const">const</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/const.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/const.png, images/Smali/const.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/const.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/const.png"
        title="const" /></p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">16</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">n3</span> <span class="o">=</span> <span class="n">0x12345678</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">n4</span> <span class="o">=</span> <span class="n">0x14000000</span><span class="o">;</span>

<span class="kt">long</span> <span class="n">l1</span> <span class="o">=</span> <span class="n">2</span><span class="o">;</span>
<span class="kt">long</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">0x12345678</span><span class="o">;</span>

<span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;Hello Luo&#34;</span><span class="o">;</span>

<span class="n">Class</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">MainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">00000002</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v1</span><span class="p">,</span> <span class="mi">16</span>
<span class="err">00000006</span>  <span class="nf">const</span>               <span class="no">v2</span><span class="p">,</span> <span class="mi">305419896</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">const</span><span class="err">/</span><span class="no">high16</span>        <span class="no">v3</span><span class="p">,</span> <span class="mi">0x14000000</span>
<span class="err">00000010</span>  <span class="nf">const-wide</span><span class="err">/</span><span class="mi">16</span>       <span class="no">v4</span><span class="p">,</span> <span class="mi">2</span>
<span class="err">00000014</span>  <span class="nf">const-wide</span><span class="err">/</span><span class="mi">32</span>       <span class="no">v6</span><span class="p">,</span> <span class="mi">305419896</span>
<span class="err">0000001</span><span class="nf">A</span>  <span class="no">const-string</span>        <span class="no">v8</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">Hello</span> <span class="no">Luo</span><span class="err">&#34;</span>
<span class="err">0000001</span><span class="nf">E</span>  <span class="no">const-class</span>         <span class="no">v9</span><span class="p">,</span> <span class="no">MainActivity</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="monitor">monitor</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/monitor.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/monitor.png, images/Smali/monitor.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/monitor.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/monitor.png"
        title="monitor" /></p>
<p>同步指令.</p>
<p><strong>示例一</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">synchronized</span> <span class="kt">int</span> <span class="nf">myAdd</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span><span class="o">;</span>
   <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">declared-synchronized</span> <span class="no">myAdd</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">3</span>
<span class="err">00000000</span>  <span class="nf">monitor-enter</span>       <span class="no">p0</span>
<span class="err">00000002</span>  <span class="nf">add-int</span><span class="err">/</span><span class="mi">2</span><span class="no">addr</span>       <span class="no">p1</span><span class="p">,</span> <span class="no">p2</span>
<span class="err">00000004</span>  <span class="nf">monitor-exit</span>        <span class="no">p0</span>
<span class="err">00000006</span>  <span class="nf">return</span>              <span class="no">p1</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>示例二</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">mySub</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
      <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">mySub</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">3</span>
<span class="err">00000000</span>  <span class="nf">monitor-enter</span>       <span class="no">p0</span>
<span class="err">00000002</span>  <span class="nf">sub-int</span><span class="err">/</span><span class="mi">2</span><span class="no">addr</span>       <span class="no">p1</span><span class="p">,</span> <span class="no">p2</span>
<span class="err">:</span><span class="nf">try_4</span>
<span class="err">00000004</span>  <span class="nf">monitor-exit</span>        <span class="no">p0</span>
<span class="err">00000006</span>  <span class="nf">return</span>              <span class="no">p1</span>
<span class="err">:</span><span class="nf">catch_8</span>  <span class="c"># used for: *
</span><span class="c"></span><span class="mi">00000008</span>  <span class="no">move-exception</span>      <span class="no">p1</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">monitor-exit</span>        <span class="no">p0</span>
          <span class="na">.catchall</span> <span class="err">{</span><span class="p">:</span><span class="no">try_4</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_C</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_8</span>
<span class="err">:</span><span class="nf">tryend_C</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">throw</span>               <span class="no">p1</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><p>这个地方多了一处monitor-exit,是为了防止代码进入同步区域后,代码崩了,无法退出同步.</p>
<h5 id="check-case">check-case</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/check-case.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/check-case.png, images/Smali/check-case.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/check-case.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/check-case.png"
        title="check-case" /></p>
<p>对象强转.</p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">Case</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="kt">float</span> <span class="n">f</span><span class="o">){</span>
       <span class="kt">int</span> <span class="n">n1</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">f</span><span class="o">;</span>
       <span class="n">MainActivity</span> <span class="n">n2</span> <span class="o">=</span> <span class="o">(</span><span class="n">MainActivity</span><span class="o">)</span><span class="n">obj</span><span class="o">;</span>
   <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">public</span> <span class="no">Case</span><span class="p">(</span><span class="no">Object</span><span class="p">,</span> <span class="no">F</span><span class="p">)</span><span class="no">V</span>
          <span class="na">.registers</span> <span class="mi">5</span>
<span class="err">00000000</span>  <span class="nf">float-to-int</span>        <span class="no">v0</span><span class="p">,</span> <span class="no">p2</span>
<span class="err">00000002</span>  <span class="nf">move-object</span>         <span class="no">v1</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">00000004</span>  <span class="nf">check-cast</span>          <span class="no">v1</span><span class="p">,</span> <span class="no">MainActivity</span>
<span class="err">00000008</span>  <span class="nf">return-void</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="instance-of">instance-of</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/instance-of.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/instance-of.png, images/Smali/instance-of.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/instance-of.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/instance-of.png"
        title="instance-of" /></p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">Case</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">,</span> <span class="kt">float</span> <span class="n">f</span><span class="o">){</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">MainActivity</span><span class="o">){</span>
           <span class="n">MainActivity</span> <span class="n">n2</span> <span class="o">=</span> <span class="o">(</span><span class="n">MainActivity</span><span class="o">)</span><span class="n">obj</span><span class="o">;</span>
       <span class="o">}</span>
   <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">public</span> <span class="no">Case</span><span class="p">(</span><span class="no">Object</span><span class="p">,</span> <span class="no">F</span><span class="p">)</span><span class="no">V</span>
          <span class="na">.registers</span> <span class="mi">4</span>
<span class="err">00000000</span>  <span class="nf">instance-of</span>         <span class="no">v0</span><span class="p">,</span> <span class="no">p1</span><span class="p">,</span> <span class="no">MainActivity</span>
<span class="err">00000004</span>  <span class="nf">if-eqz</span>              <span class="no">v0</span><span class="p">,</span> <span class="p">:</span><span class="no">E</span>
<span class="err">:8</span>
<span class="err">00000008</span>  <span class="nf">move-object</span>         <span class="no">v0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">check-cast</span>          <span class="no">v0</span><span class="p">,</span> <span class="no">MainActivity</span>
<span class="err">:</span><span class="nf">E</span>
<span class="err">0000000</span><span class="nf">E</span>  <span class="no">return-void</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="new-instance">new-instance</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/new-instance.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/new-instance.png, images/Smali/new-instance.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/new-instance.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/new-instance.png"
        title="new-instance" /></p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">MainActivity</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MainActivity</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">00000000</span>  <span class="nf">new-instance</span>        <span class="no">v0</span><span class="p">,</span> <span class="no">MainActivity</span>
<span class="err">00000004</span>  <span class="nf">invoke-direct</span>       <span class="no">MainActivity-</span><span class="err">&gt;&lt;</span><span class="no">init</span><span class="err">&gt;</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">v0</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="数组">数组</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e6%95%b0%e7%bb%841.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%95%B0%E7%BB%841.png, images/Smali/%e6%95%b0%e7%bb%841.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%95%B0%E7%BB%841.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%95%B0%E7%BB%841.png"
        title="数组1" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e6%95%b0%e7%bb%842.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%95%B0%E7%BB%842.png, images/Smali/%e6%95%b0%e7%bb%842.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%95%B0%E7%BB%842.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%95%B0%E7%BB%842.png"
        title="数组2" /></p>
<p><strong>示例一维数组</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">TstAry</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
       <span class="kt">short</span> <span class="n">nAry</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">};</span>
       <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">nAry</span><span class="o">[</span><span class="n">2</span><span class="o">];</span>
       <span class="n">nAry</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
       <span class="k">return</span> <span class="n">n</span><span class="o">;</span>
   <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstAry</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">7</span>
<span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>              <span class="no">v0</span><span class="p">,</span> <span class="mi">4</span>
<span class="err">00000002</span>  <span class="nf">new-array</span>            <span class="no">v0</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="p">[</span><span class="no">S</span>    <span class="err">//</span><span class="no">new一个数组</span>
<span class="err">00000006</span>  <span class="nf">fill-array-data</span>      <span class="no">v0</span><span class="p">,</span> <span class="p">:</span><span class="mi">20</span>       <span class="err">//初始化数组</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">const</span><span class="err">/</span><span class="mi">4</span>              <span class="no">v1</span><span class="p">,</span> <span class="mi">2</span>          
<span class="mi">0000000</span><span class="no">E</span>  <span class="no">aget-short</span>           <span class="no">v1</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>    <span class="err">//</span><span class="no">v1表示数组序号</span><span class="p">,</span><span class="err">将数组中</span><span class="no">v1序号的值给v1</span>
<span class="err">00000012</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v2</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">00000014</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v3</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">00000018</span>  <span class="nf">aput-short</span>           <span class="no">v3</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v2</span>    <span class="err">//</span><span class="no">v2是数组序号</span><span class="p">,</span><span class="err">将数组中序号为</span><span class="no">v2中的值修改为v3</span>
<span class="err">0000001</span><span class="nf">C</span>  <span class="no">return</span>                <span class="no">v1</span>
<span class="err">:20</span>
<span class="err">00000020</span>  <span class="na">.array-data</span> <span class="mi">2</span> <span class="no">x</span> <span class="mi">0x4</span>
              <span class="err">0</span><span class="nf">x1</span>
              <span class="err">0</span><span class="nf">x2</span>
              <span class="err">0</span><span class="nf">x3</span>
              <span class="err">0</span><span class="nf">x4</span>
          <span class="na">.end</span> <span class="no">array-data</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><p>aget拿数组值,aput修改数组值.</p>
<p><strong>示例二维数组</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">TstAry</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
       <span class="kt">short</span> <span class="n">nAry</span><span class="o">[][]</span> <span class="o">=</span> <span class="o">{{</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">},</span> <span class="o">{</span><span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">}};</span>
       <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">nAry</span><span class="o">[</span><span class="n">1</span><span class="o">][</span><span class="n">0</span><span class="o">];</span>
       <span class="n">nAry</span><span class="o">[</span><span class="n">0</span><span class="o">][</span><span class="n">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
       <span class="k">return</span> <span class="n">n</span><span class="o">;</span>
   <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstAry</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">8</span>
<span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">2</span>
<span class="err">00000002</span>  <span class="nf">new-array</span>           <span class="no">v1</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="p">[[</span><span class="no">S</span>      <span class="err">//</span><span class="no">new</span> <span class="err">一个一维数组</span><span class="no">v1</span>
<span class="err">00000006</span>  <span class="nf">new-array</span>           <span class="no">v2</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="p">[</span><span class="no">S</span>       <span class="err">//</span><span class="no">new一个一维数组v2</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">fill-array-data</span>     <span class="no">v2</span><span class="p">,</span> <span class="p">:</span><span class="mi">40</span>          <span class="err">//初始化一维数组</span><span class="no">v2</span>
<span class="err">00000010</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v3</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">00000012</span>  <span class="nf">aput-object</span>         <span class="no">v2</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="no">v3</span>      <span class="err">//修改一维数组</span><span class="no">v1中序号为0的值为v2</span>
<span class="err">00000016</span>  <span class="nf">new-array</span>           <span class="no">v0</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="p">[</span><span class="no">S</span>       <span class="err">//</span><span class="no">new一个一维数组v0</span>
<span class="err">0000001</span><span class="nf">A</span>  <span class="no">fill-array-data</span>     <span class="no">v0</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="no">C</span>          <span class="err">//初始化一维数组</span><span class="no">v0</span>
<span class="err">00000020</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v2</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">00000022</span>  <span class="nf">aput-object</span>         <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="no">v2</span>      <span class="err">//修改一维数组</span><span class="no">v1中序号为1的值为v0</span>
<span class="err">00000026</span>  <span class="nf">move-object</span>         <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">00000028</span>  <span class="nf">aget-object</span>         <span class="no">v1</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v2</span>      <span class="err">//</span><span class="no">v2表示数组序号</span><span class="p">,</span><span class="err">将数组</span><span class="no">v0中序号为v2的值给v1</span>
<span class="err">0000002</span><span class="nf">C</span>  <span class="no">aget-short</span>          <span class="no">v1</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="no">v3</span>      <span class="err">//</span><span class="no">v3表示数组序号</span><span class="p">,</span><span class="err">将数组</span><span class="no">v1中序号为v3的值给v1</span>
<span class="err">00000030</span>  <span class="nf">aget-object</span>         <span class="no">v3</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v3</span>     
<span class="mi">00000034</span>  <span class="no">const</span><span class="err">/</span><span class="mi">16</span>           <span class="no">v4</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">00000038</span>  <span class="nf">aput-short</span>          <span class="no">v4</span><span class="p">,</span> <span class="no">v3</span><span class="p">,</span> <span class="no">v2</span>     <span class="err">//以上</span><span class="mi">3</span><span class="err">句</span><span class="p">,</span><span class="err">等同于</span><span class="no">nAry</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="err">=</span> <span class="mi">10</span><span class="c">;
</span><span class="c"></span><span class="mi">0000003</span><span class="no">C</span>  <span class="no">return</span>              <span class="no">v1</span>
<span class="err">:40</span>
<span class="err">00000040</span>  <span class="na">.array-data</span> <span class="mi">2</span> <span class="no">x</span> <span class="mi">0x2</span>
              <span class="err">0</span><span class="nf">x1</span>
              <span class="err">0</span><span class="nf">x2</span>
          <span class="na">.end</span> <span class="no">array-data</span>
<span class="err">:4</span><span class="nf">C</span>
<span class="err">0000004</span><span class="nf">C</span>  <span class="no">.array-data</span> <span class="mi">2</span> <span class="no">x</span> <span class="mi">0x2</span>
              <span class="err">0</span><span class="nf">x3</span>
              <span class="err">0</span><span class="nf">x4</span>
          <span class="na">.end</span> <span class="no">array-data</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><p>汇编中没有二维数组的概念,实际上是new一个一维数组,里面的元素是一维数组.</p>
<h5 id="分支">分支</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e5%88%86%e6%94%af1.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E5%88%86%E6%94%AF1.png, images/Smali/%e5%88%86%e6%94%af1.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E5%88%86%E6%94%AF1.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E5%88%86%E6%94%AF1.png"
        title="分支1" /></p>
<h6 id="if">if</h6>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">TstIf</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">p1</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">return</span> <span class="n">p1</span><span class="o">;</span>
     <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
         <span class="k">return</span> <span class="n">p2</span><span class="o">;</span>
     <span class="o">}</span>
 <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstIf</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">3</span>
<span class="err">00000000</span>  <span class="nf">if-le</span>               <span class="no">p1</span><span class="p">,</span> <span class="no">p2</span><span class="p">,</span> <span class="p">:</span><span class="mi">6</span>
<span class="err">:4</span>
<span class="err">00000004</span>  <span class="nf">return</span>              <span class="no">p1</span>
<span class="err">:6</span>
<span class="err">00000006</span>  <span class="nf">return</span>              <span class="no">p2</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="switch">Switch</h6>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/Switch.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Switch.png, images/Smali/Switch.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Switch.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Switch.png"
        title="Switch" /></p>
<p>当case的数量不是很大的时候,会被优化成if-else,这种的下面不再演示.</p>
<p><strong>示例packed</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">TstCase</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">p1</span><span class="o">){</span>
        <span class="k">case</span> <span class="n">1</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">1</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">case</span> <span class="n">2</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">3</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">case</span> <span class="n">3</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">6</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">case</span> <span class="n">4</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">8</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">default</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">9</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstCase</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">3</span>
<span class="err">00000000</span>  <span class="nf">packed-switch</span>       <span class="no">p1</span><span class="p">,</span> <span class="p">:</span><span class="mi">20</span>
<span class="err">:6</span>
<span class="err">00000006</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v0</span><span class="p">,</span> <span class="mi">9</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">return</span>              <span class="no">v0</span>
<span class="err">:</span><span class="nf">C</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v0</span><span class="p">,</span> <span class="mi">8</span>
<span class="err">00000010</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="err">:12</span>
<span class="err">00000012</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">6</span>
<span class="err">00000014</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="err">:16</span>
<span class="err">00000016</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">3</span>
<span class="err">00000018</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="err">:1</span><span class="nf">A</span>
<span class="err">0000001</span><span class="nf">A</span>  <span class="no">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">0000001</span><span class="nf">C</span>  <span class="no">return</span>              <span class="no">v0</span>
<span class="err">:20</span>
<span class="err">00000020</span>  <span class="na">.packed-switch</span> <span class="mi">1</span>   <span class="err">//从</span><span class="mi">1</span><span class="err">开始计数</span><span class="p">,</span> <span class="err">相当于</span><span class="no">switch</span><span class="p">(</span><span class="no">p1</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span>
              <span class="err">:1</span><span class="nf">A</span>
              <span class="err">:16</span>
              <span class="err">:12</span>
              <span class="err">:</span><span class="nf">C</span>
          <span class="na">.end</span> <span class="no">packed-switch</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>示例sparse</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">TstCase</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">p1</span><span class="o">){</span>
        <span class="k">case</span> <span class="n">1</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">1</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">case</span> <span class="n">3</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">3</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">case</span> <span class="n">6</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">6</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">case</span> <span class="n">8</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">8</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">default</span><span class="o">:{</span>
            <span class="k">return</span> <span class="n">9</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstCase</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">3</span>
<span class="err">00000000</span>  <span class="nf">sparse-switch</span>       <span class="no">p1</span><span class="p">,</span> <span class="p">:</span><span class="mi">20</span>
<span class="err">:6</span>
<span class="err">00000006</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v0</span><span class="p">,</span> <span class="mi">9</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">return</span>              <span class="no">v0</span>
<span class="err">:</span><span class="nf">C</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v0</span><span class="p">,</span> <span class="mi">8</span>
<span class="err">00000010</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="err">:12</span>
<span class="err">00000012</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">6</span>
<span class="err">00000014</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="err">:16</span>
<span class="err">00000016</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">3</span>
<span class="err">00000018</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="err">:1</span><span class="nf">A</span>
<span class="err">0000001</span><span class="nf">A</span>  <span class="no">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">0000001</span><span class="nf">C</span>  <span class="no">return</span>              <span class="no">v0</span>
<span class="err">:20</span>
<span class="err">00000020</span>  <span class="na">.sparse-switch</span>
              <span class="err">1</span> <span class="err">-&gt;</span> <span class="err">:1</span><span class="nf">A</span>
              <span class="err">3</span> <span class="err">-&gt;</span> <span class="err">:16</span>
              <span class="err">6</span> <span class="err">-&gt;</span> <span class="err">:12</span>
              <span class="err">8</span> <span class="err">-&gt;</span> <span class="err">:</span><span class="nf">C</span>
          <span class="na">.end</span> <span class="no">sparse-switch</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="for">for</h6>
<p><strong>示例常规</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">TstFor</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">nSum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
          <span class="n">nSum</span> <span class="o">+=</span> <span class="n">i</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">nSum</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstFor</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">4</span>
<span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">00000002</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v1</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">:4</span>
<span class="err">00000004</span>  <span class="nf">if-ge</span>               <span class="no">v1</span><span class="p">,</span> <span class="no">p1</span><span class="p">,</span> <span class="p">:</span><span class="mi">10</span>
<span class="err">:8</span>
<span class="err">00000008</span>  <span class="nf">add-int</span><span class="err">/</span><span class="mi">2</span><span class="no">addr</span>       <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">add-int</span><span class="err">/</span><span class="no">lit8</span>        <span class="no">v1</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">0000000</span><span class="nf">E</span>  <span class="no">goto</span>                <span class="p">:</span><span class="mi">4</span>
<span class="err">:10</span>
<span class="err">00000010</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>示例迭代器</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">D</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&#34;onCreate&#34;</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

      <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">lst</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
      <span class="n">lst</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
      <span class="n">lst</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">2</span><span class="o">);</span>
      <span class="n">lst</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">3</span><span class="o">);</span>

      <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">TstFor</span><span class="o">(</span><span class="n">lst</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kt">int</span> <span class="nf">TstFor</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">lst</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">nSum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">:</span> <span class="n">lst</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">nSum</span> <span class="o">+=</span> <span class="n">n</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="n">nSum</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstFor</span><span class="p">(</span><span class="no">List</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">5</span>
<span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">00000002</span>  <span class="nf">invoke-interface</span>    <span class="no">List-</span><span class="err">&gt;</span><span class="no">iterator</span><span class="p">()</span><span class="no">Iterator</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">00000008</span>  <span class="nf">move-result-object</span>  <span class="no">v1</span>
<span class="err">:</span><span class="nf">A</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">invoke-interface</span>    <span class="no">Iterator-</span><span class="err">&gt;</span><span class="no">hasNext</span><span class="p">()</span><span class="no">Z</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">00000010</span>  <span class="nf">move-result</span>         <span class="no">v2</span>
<span class="err">00000012</span>  <span class="nf">if-eqz</span>              <span class="no">v2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="no">E</span>
<span class="err">:16</span>
<span class="err">00000016</span>  <span class="nf">invoke-interface</span>    <span class="no">Iterator-</span><span class="err">&gt;</span><span class="no">next</span><span class="p">()</span><span class="no">Object</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">0000001</span><span class="nf">C</span>  <span class="no">move-result-object</span>  <span class="no">v2</span>
<span class="err">0000001</span><span class="nf">E</span>  <span class="no">check-cast</span>          <span class="no">v2</span><span class="p">,</span> <span class="no">Integer</span>
<span class="err">00000022</span>  <span class="nf">invoke-virtual</span>      <span class="no">Integer-</span><span class="err">&gt;</span><span class="no">intValue</span><span class="p">()</span><span class="no">I</span><span class="p">,</span> <span class="no">v2</span>
<span class="err">00000028</span>  <span class="nf">move-result</span>         <span class="no">v2</span>
<span class="err">0000002</span><span class="nf">A</span>  <span class="no">add-int</span><span class="err">/</span><span class="mi">2</span><span class="no">addr</span>       <span class="no">v0</span><span class="p">,</span> <span class="no">v2</span>
<span class="err">0000002</span><span class="nf">C</span>  <span class="no">goto</span>                <span class="p">:</span><span class="no">A</span>
<span class="err">:2</span><span class="nf">E</span>
<span class="err">0000002</span><span class="nf">E</span>  <span class="no">return</span>              <span class="no">v0</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><p>上述Smali汇编可以翻译为:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
<span class="n">Iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
 <span class="k">while</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
        <span class="n">Integer</span> <span class="n">obj</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">intValue</span><span class="o">();</span>
        <span class="n">v0</span> <span class="o">+=</span> <span class="n">v2</span><span class="o">;</span>
       <span class="o">}</span>
<span class="k">return</span> <span class="n">v0</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">v0</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">lst</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
<span class="k">while</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()){</span>
    <span class="kt">int</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">().</span><span class="na">intValue</span><span class="o">();</span>
    <span class="n">v0</span> <span class="o">+=</span> <span class="n">v2</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">return</span> <span class="n">v0</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>需要注意的是</strong>,这种带模板的,Jeb是没办法还原成上述的原始Java代码的.</p>
<h6 id="while">while</h6>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">TstWhile</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">nSum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">p1</span> <span class="o">&lt;</span> <span class="n">20</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">nSum</span> <span class="o">+=</span> <span class="n">p1</span><span class="o">;</span>
        <span class="n">p1</span><span class="o">++;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">nSum</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstWhile</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">4</span>
<span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">:2</span>
<span class="err">00000002</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v1</span><span class="p">,</span> <span class="mi">20</span>
<span class="err">00000006</span>  <span class="nf">if-ge</span>               <span class="no">p1</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="p">:</span><span class="mi">12</span>
<span class="err">:</span><span class="nf">A</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">add-int</span><span class="err">/</span><span class="mi">2</span><span class="no">addr</span>       <span class="no">v0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">add-int</span><span class="err">/</span><span class="no">lit8</span>        <span class="no">p1</span><span class="p">,</span> <span class="no">p1</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">00000010</span>  <span class="nf">goto</span>                <span class="p">:</span><span class="mi">2</span>
<span class="err">:12</span>
<span class="err">00000012</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="do-while">do-while</h6>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="nf">TstDoWhile</span><span class="o">(</span><span class="kt">int</span> <span class="n">p1</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">nSum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="k">do</span> <span class="o">{</span>
        <span class="n">nSum</span> <span class="o">+=</span> <span class="n">p1</span><span class="o">;</span>
        <span class="n">p1</span><span class="o">++;</span>
    <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">p1</span> <span class="o">&lt;</span> <span class="n">20</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">nSum</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">TstDoWhile</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">I</span>
          <span class="na">.registers</span> <span class="mi">4</span>
<span class="err">00000000</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v0</span><span class="p">,</span> <span class="mi">0</span>
<span class="err">:2</span>
<span class="err">00000002</span>  <span class="nf">add-int</span><span class="err">/</span><span class="mi">2</span><span class="no">addr</span>       <span class="no">v0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">00000004</span>  <span class="nf">add-int</span><span class="err">/</span><span class="no">lit8</span>        <span class="no">p1</span><span class="p">,</span> <span class="no">p1</span><span class="p">,</span> <span class="mi">1</span>
<span class="err">00000008</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v1</span><span class="p">,</span> <span class="mi">20</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">if-lt</span>                <span class="no">p1</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="p">:</span><span class="mi">12</span>
<span class="err">:10</span>
<span class="err">00000010</span>  <span class="nf">return</span>              <span class="no">v0</span>
<span class="err">:12</span>
<span class="err">00000012</span>  <span class="nf">goto</span>                <span class="p">:</span><span class="mi">2</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="字段操作">字段操作</h5>
<h6 id="非静态字段">非静态字段</h6>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e9%9d%9e%e9%9d%99%e6%80%81%e5%ad%97%e6%ae%b5.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E9%9D%9E%E9%9D%99%E6%80%81%E5%AD%97%E6%AE%B5.png, images/Smali/%e9%9d%9e%e9%9d%99%e6%80%81%e5%ad%97%e6%ae%b5.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E9%9D%9E%E9%9D%99%E6%80%81%E5%AD%97%E6%AE%B5.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E9%9D%9E%E9%9D%99%E6%80%81%E5%AD%97%E6%AE%B5.png"
        title="非静态字段" /></p>
<p>iget,非静态字段赋值.
iput,给静态字段赋值.</p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">int</span> <span class="n">mData1</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
<span class="kd">private</span> <span class="kt">float</span> <span class="n">mData2</span> <span class="o">=</span> <span class="n">3</span><span class="o">.</span><span class="na">5f</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">Object</span> <span class="n">mData3</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">mData1</span><span class="o">;</span>
    <span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mData2</span><span class="o">;</span>
    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">mData3</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">.method public constructor &lt;init&gt;()V
          .registers 2
00000000  invoke-direct       AppCompatActivity-&gt;&lt;init&gt;()V, p0
00000006  const/4             v0, 1
00000008  iput                v0, p0, MainActivity-&gt;mData1:I
0000000C  const/high16        v0, 0x40600000
00000010  iput                v0, p0, MainActivity-&gt;mData2:F
00000014  const/4             v0, 0
00000016  iput-object         v0, p0, MainActivity-&gt;mData3:Object
0000001A  return-void
.end method
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">protected</span> <span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span>
          <span class="na">.registers</span> <span class="mi">5</span>
<span class="err">00000000</span>  <span class="nf">invoke-super</span>        <span class="no">AppCompatActivity-</span><span class="err">&gt;</span><span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">00000006</span>  <span class="nf">const</span>               <span class="no">v0</span><span class="p">,</span> <span class="mi">0x7F0B001C</span> 
<span class="mi">0000000</span><span class="no">C</span>  <span class="no">invoke-virtual</span>      <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">setContentView</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">v0</span> 
<span class="mi">00000012</span>  <span class="no">iget</span>                <span class="no">v0</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">mData1</span><span class="p">:</span><span class="no">I</span>
<span class="err">00000016</span>  <span class="nf">iget</span>                <span class="no">v1</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">mData2</span><span class="p">:</span><span class="no">F</span>
<span class="err">0000001</span><span class="nf">A</span>  <span class="no">iget-object</span>         <span class="no">v2</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">mData3</span><span class="p">:</span><span class="no">Object</span>
<span class="err">0000001</span><span class="nf">E</span>  <span class="no">return-void</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="静态字段">静态字段</h6>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e9%9d%99%e6%80%81%e5%ad%97%e6%ae%b5.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E9%9D%99%E6%80%81%E5%AD%97%E6%AE%B5.png, images/Smali/%e9%9d%99%e6%80%81%e5%ad%97%e6%ae%b5.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E9%9D%99%E6%80%81%E5%AD%97%E6%AE%B5.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E9%9D%99%E6%80%81%E5%AD%97%E6%AE%B5.png"
        title="静态字段" /></p>
<p>sget,静态字段赋值.
sput,给静态字段赋值.</p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">mData1</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">float</span> <span class="n">mData2</span> <span class="o">=</span> <span class="n">3</span><span class="o">.</span><span class="na">5f</span><span class="o">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">Object</span> <span class="n">mData3</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">mData1</span><span class="o">;</span>
    <span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="n">mData2</span><span class="o">;</span>
    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">mData3</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">.method static constructor &lt;clinit&gt;()V
          .registers 1
00000000  const/4             v0, 1
00000002  sput                v0, MainActivity-&gt;mData1:I
00000006  const/high16        v0, 0x40600000
0000000A  sput                v0, MainActivity-&gt;mData2:F
0000000E  const/4             v0, 0
00000010  sput-object         v0, MainActivity-&gt;mData3:Object
00000014  return-void
.end method
</code></pre></td></tr></table>
</div>
</div><p>静态字段的初始化,在clinit中.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">protected</span> <span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span>
          <span class="na">.registers</span> <span class="mi">5</span>
<span class="err">00000000</span>  <span class="nf">invoke-super</span>        <span class="no">AppCompatActivity-</span><span class="err">&gt;</span><span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">00000006</span>  <span class="nf">const</span>               <span class="no">v0</span><span class="p">,</span> <span class="mi">0x7F0B001C</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">invoke-virtual</span>      <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">setContentView</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">v0</span>
<span class="err">00000012</span>  <span class="nf">sget</span>                <span class="no">v0</span><span class="p">,</span> <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">mData1</span><span class="p">:</span><span class="no">I</span>
<span class="err">00000016</span>  <span class="nf">sget</span>                <span class="no">v1</span><span class="p">,</span> <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">mData2</span><span class="p">:</span><span class="no">F</span>
<span class="err">0000001</span><span class="nf">A</span>  <span class="no">sget-object</span>         <span class="no">v2</span><span class="p">,</span> <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">mData3</span><span class="p">:</span><span class="no">Object</span>
<span class="err">0000001</span><span class="nf">E</span>  <span class="no">return-void</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="方法操作">方法操作</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e6%96%b9%e6%b3%95%e6%93%8d%e4%bd%9c.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%96%B9%E6%B3%95%E6%93%8D%E4%BD%9C.png, images/Smali/%e6%96%b9%e6%b3%95%e6%93%8d%e4%bd%9c.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%96%B9%E6%B3%95%E6%93%8D%E4%BD%9C.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%96%B9%E6%B3%95%E6%93%8D%E4%BD%9C.png"
        title="方法操作" /></p>
<p>分别对应 虚函数、调父类方法、直接方法、静态方法、接口.
其中直接方法只有两种情况,①构造.②私有.</p>
<p><strong>示例</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">int</span> <span class="nf">mySub</span><span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">n1</span><span class="o">-</span> <span class="n">n2</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">mySub</span><span class="o">(</span><span class="n">10</span><span class="o">,</span><span class="n">3</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Samli:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">protected</span> <span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span>
          <span class="na">.registers</span> <span class="mi">4</span>
<span class="err">00000000</span>  <span class="nf">invoke-super</span>        <span class="no">AppCompatActivity-</span><span class="err">&gt;</span><span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">00000006</span>  <span class="nf">const</span>               <span class="no">v0</span><span class="p">,</span> <span class="mi">0x7F0B001C</span>
<span class="err">0000000</span><span class="nf">C</span>  <span class="no">invoke-virtual</span>      <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">setContentView</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">v0</span>
<span class="err">00000012</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">16</span>            <span class="no">v0</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">00000016</span>  <span class="nf">const</span><span class="err">/</span><span class="mi">4</span>             <span class="no">v1</span><span class="p">,</span> <span class="mi">3</span>
<span class="err">00000018</span>  <span class="nf">invoke-direct</span>       <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">mySub</span><span class="p">(</span><span class="no">I</span><span class="p">,</span> <span class="no">I</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">0000001</span><span class="nf">E</span>  <span class="no">move-result</span>         <span class="no">v0</span>
<span class="err">00000020</span>  <span class="nf">return-void</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="异常">异常</h5>
<p><strong>示例 try-catch</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">Exception1</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Throwable</span><span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">ArrayIndexOutOfBoundsException</span><span class="o">();</span>
<span class="o">}</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">Exception1</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">ArrayIndexOutOfBoundsException</span> <span class="n">e</span><span class="o">){</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&#34;Luo&#34;</span><span class="o">,</span> <span class="s">&#34;ArrayIndexOutOfBoundsException&#34;</span><span class="o">);</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&#34;Luo&#34;</span><span class="o">,</span> <span class="s">&#34;Exception&#34;</span><span class="o">);</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">throwable</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&#34;Luo&#34;</span><span class="o">,</span> <span class="s">&#34;Throwable&#34;</span><span class="o">);</span>
        <span class="n">throwable</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">protected</span> <span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span>
          <span class="na">.registers</span> <span class="mi">4</span>
<span class="err">00000000</span>  <span class="nf">const-string</span>        <span class="no">v0</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">Luo</span><span class="err">&#34;</span>
<span class="err">00000004</span>  <span class="nf">invoke-super</span>        <span class="no">AppCompatActivity-</span><span class="err">&gt;</span><span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">0000000</span><span class="nf">A</span>  <span class="no">const</span>               <span class="no">p1</span><span class="p">,</span> <span class="mi">0x7F0B001C</span>
<span class="err">00000010</span>  <span class="nf">invoke-virtual</span>      <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">setContentView</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">:</span><span class="nf">try_16</span>
<span class="err">00000016</span>  <span class="nf">invoke-virtual</span>      <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">Exception1</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span>
          <span class="na">.catch</span> <span class="no">ArrayIndexOutOfBoundsException</span> <span class="err">{</span><span class="p">:</span><span class="no">try_16</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_1C</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_46</span>
          <span class="na">.catch</span> <span class="no">Exception</span> <span class="err">{</span><span class="p">:</span><span class="no">try_16</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_1C</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_32</span>
          <span class="na">.catchall</span> <span class="err">{</span><span class="p">:</span><span class="no">try_16</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_1C</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_1E</span>
<span class="err">:</span><span class="nf">tryend_1C</span>
<span class="err">0000001</span><span class="nf">C</span>  <span class="no">goto</span>                <span class="p">:</span><span class="mi">58</span>
<span class="err">:</span><span class="nf">catch_1E</span>  <span class="c"># used for: *
</span><span class="c"></span><span class="mi">0000001</span><span class="no">E</span>  <span class="no">move-exception</span>      <span class="no">p1</span>
<span class="err">00000020</span>  <span class="nf">const-string</span>        <span class="no">v1</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">Throwable</span><span class="err">&#34;</span>
<span class="err">00000024</span>  <span class="nf">invoke-static</span>       <span class="no">Log-</span><span class="err">&gt;</span><span class="no">d</span><span class="p">(</span><span class="no">String</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">0000002</span><span class="nf">A</span>  <span class="no">invoke-virtual</span>      <span class="no">Throwable-</span><span class="err">&gt;</span><span class="no">printStackTrace</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">00000030</span>  <span class="nf">goto</span>                <span class="p">:</span><span class="mi">58</span>
<span class="err">:</span><span class="nf">catch_32</span>  <span class="c"># used for: Ljava/lang/Exception;
</span><span class="c"></span><span class="mi">00000032</span>  <span class="no">move-exception</span>      <span class="no">p1</span>
<span class="err">00000034</span>  <span class="nf">const-string</span>        <span class="no">v1</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">Exception</span><span class="err">&#34;</span>
<span class="err">00000038</span>  <span class="nf">invoke-static</span>       <span class="no">Log-</span><span class="err">&gt;</span><span class="no">d</span><span class="p">(</span><span class="no">String</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">0000003</span><span class="nf">E</span>  <span class="no">invoke-virtual</span>      <span class="no">Exception-</span><span class="err">&gt;</span><span class="no">printStackTrace</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">00000044</span>  <span class="nf">goto</span>                <span class="p">:</span><span class="mi">58</span>
<span class="err">:</span><span class="nf">catch_46</span>  <span class="c"># used for: Ljava/lang/ArrayIndexOutOfBoundsException;
</span><span class="c"></span><span class="mi">00000046</span>  <span class="no">move-exception</span>      <span class="no">p1</span>
<span class="err">00000048</span>  <span class="nf">const-string</span>        <span class="no">v1</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">ArrayIndexOutOfBoundsException</span><span class="err">&#34;</span>
<span class="err">0000004</span><span class="nf">C</span>  <span class="no">invoke-static</span>       <span class="no">Log-</span><span class="err">&gt;</span><span class="no">d</span><span class="p">(</span><span class="no">String</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">v0</span><span class="p">,</span> <span class="no">v1</span>
<span class="err">00000052</span>  <span class="nf">invoke-virtual</span>      <span class="no">ArrayIndexOutOfBoundsException-</span><span class="err">&gt;</span><span class="no">printStackTrace</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">:58</span>
<span class="err">00000058</span>  <span class="nf">return-void</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.catch</span> <span class="no">ArrayIndexOutOfBoundsException</span> <span class="err">{</span><span class="p">:</span><span class="no">try_16</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_1C</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_46</span>  <span class="c">#这个地方是说标号try_16-tryend_1C之间会抛异常,catch代码在标号catch_46处,下面的同理.
</span><span class="c"></span><span class="no">.catch</span> <span class="no">Exception</span> <span class="err">{</span><span class="p">:</span><span class="no">try_16</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_1C</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_32</span>
<span class="na">.catchall</span> <span class="err">{</span><span class="p">:</span><span class="no">try_16</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_1C</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_1E</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>示例 try-catch-finally</strong>:</p>
<p>Java:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">Exception1</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Throwable</span><span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">ArrayIndexOutOfBoundsException</span><span class="o">();</span>
<span class="o">}</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">Exception1</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">ArrayIndexOutOfBoundsException</span> <span class="n">e</span><span class="o">){</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&#34;Luo&#34;</span><span class="o">,</span> <span class="s">&#34;ArrayIndexOutOfBoundsException&#34;</span><span class="o">);</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&#34;Luo&#34;</span><span class="o">,</span> <span class="s">&#34;Exception&#34;</span><span class="o">);</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">throwable</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&#34;Luo&#34;</span><span class="o">,</span> <span class="s">&#34;Throwable&#34;</span><span class="o">);</span>
        <span class="n">throwable</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">finally</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&#34;Luo&#34;</span><span class="o">,</span> <span class="s">&#34;finally&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Smali:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="na">.method</span> <span class="no">protected</span> <span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span>
          <span class="na">.registers</span> <span class="mi">5</span>
<span class="err">00000000</span>  <span class="nf">const-string</span>        <span class="no">v0</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">finally</span><span class="err">&#34;</span>
<span class="err">00000004</span>  <span class="nf">const-string</span>        <span class="no">v1</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">Luo</span><span class="err">&#34;</span>
<span class="err">00000008</span>  <span class="nf">invoke-super</span>        <span class="no">AppCompatActivity-</span><span class="err">&gt;</span><span class="no">onCreate</span><span class="p">(</span><span class="no">Bundle</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">0000000</span><span class="nf">E</span>  <span class="no">const</span>               <span class="no">p1</span><span class="p">,</span> <span class="mi">0x7F0B001C</span>        <span class="c"># layout:activity_main
</span><span class="c"></span><span class="mi">00000014</span>  <span class="no">invoke-virtual</span>      <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">setContentView</span><span class="p">(</span><span class="no">I</span><span class="p">)</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">:</span><span class="nf">try_1A</span>
<span class="err">0000001</span><span class="nf">A</span>  <span class="no">invoke-virtual</span>      <span class="no">MainActivity-</span><span class="err">&gt;</span><span class="no">Exception1</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">p0</span>
          <span class="na">.catch</span> <span class="no">ArrayIndexOutOfBoundsException</span> <span class="err">{</span><span class="p">:</span><span class="no">try_1A</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_20</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_50</span>
          <span class="na">.catch</span> <span class="no">Exception</span> <span class="err">{</span><span class="p">:</span><span class="no">try_1A</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_20</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_3C</span>
          <span class="na">.catchall</span> <span class="err">{</span><span class="p">:</span><span class="no">try_1A</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_20</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_28</span>
<span class="err">:</span><span class="nf">tryend_20</span>
<span class="err">00000020</span>  <span class="nf">invoke-static</span>       <span class="no">Log-</span><span class="err">&gt;</span><span class="no">d</span><span class="p">(</span><span class="no">String</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="no">v0</span>
<span class="err">00000026</span>  <span class="nf">goto</span>                <span class="p">:</span><span class="mi">64</span>
<span class="err">:</span><span class="nf">catch_28</span>  <span class="c"># used for: *
</span><span class="c"></span><span class="mi">00000028</span>  <span class="no">move-exception</span>      <span class="no">p1</span>
<span class="err">:</span><span class="nf">try_2A</span>
<span class="err">0000002</span><span class="nf">A</span>  <span class="no">const-string</span>        <span class="no">v2</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">Throwable</span><span class="err">&#34;</span>
<span class="err">0000002</span><span class="nf">E</span>  <span class="no">invoke-static</span>       <span class="no">Log-</span><span class="err">&gt;</span><span class="no">d</span><span class="p">(</span><span class="no">String</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="no">v2</span>
<span class="err">00000034</span>  <span class="nf">invoke-virtual</span>      <span class="no">Throwable-</span><span class="err">&gt;</span><span class="no">printStackTrace</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">0000003</span><span class="nf">A</span>  <span class="no">goto</span>                <span class="p">:</span><span class="no">tryend_20</span>
<span class="err">:</span><span class="nf">catch_3C</span>  <span class="c"># used for: Ljava/lang/Exception;
</span><span class="c"></span><span class="mi">0000003</span><span class="no">C</span>  <span class="no">move-exception</span>      <span class="no">p1</span>
<span class="err">0000003</span><span class="nf">E</span>  <span class="no">const-string</span>        <span class="no">v2</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">Exception</span><span class="err">&#34;</span>
<span class="err">00000042</span>  <span class="nf">invoke-static</span>       <span class="no">Log-</span><span class="err">&gt;</span><span class="no">d</span><span class="p">(</span><span class="no">String</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="no">v2</span>
<span class="err">00000048</span>  <span class="nf">invoke-virtual</span>      <span class="no">Exception-</span><span class="err">&gt;</span><span class="no">printStackTrace</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">p1</span>
<span class="err">0000004</span><span class="nf">E</span>  <span class="no">goto</span>                <span class="p">:</span><span class="no">tryend_20</span>
<span class="err">:</span><span class="nf">catch_50</span>  <span class="c"># used for: Ljava/lang/ArrayIndexOutOfBoundsException;
</span><span class="c"></span><span class="mi">00000050</span>  <span class="no">move-exception</span>      <span class="no">p1</span>
<span class="err">00000052</span>  <span class="nf">const-string</span>        <span class="no">v2</span><span class="p">,</span> <span class="err">&#34;</span><span class="no">ArrayIndexOutOfBoundsException</span><span class="err">&#34;</span>
<span class="err">00000056</span>  <span class="nf">invoke-static</span>       <span class="no">Log-</span><span class="err">&gt;</span><span class="no">d</span><span class="p">(</span><span class="no">String</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="no">v2</span>
<span class="err">0000005</span><span class="nf">C</span>  <span class="no">invoke-virtual</span>      <span class="no">ArrayIndexOutOfBoundsException-</span><span class="err">&gt;</span><span class="no">printStackTrace</span><span class="p">()</span><span class="no">V</span><span class="p">,</span> <span class="no">p1</span>
          <span class="na">.catchall</span> <span class="err">{</span><span class="p">:</span><span class="no">try_2A</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_62</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_66</span>
<span class="err">:</span><span class="nf">tryend_62</span>
<span class="err">00000062</span>  <span class="nf">goto</span>                <span class="p">:</span><span class="no">tryend_20</span>
<span class="err">:64</span>
<span class="err">00000064</span>  <span class="nf">return-void</span>
<span class="err">:</span><span class="nf">catch_66</span>  <span class="c"># used for: *
</span><span class="c"></span><span class="mi">00000066</span>  <span class="no">move-exception</span>      <span class="no">p1</span>
<span class="err">00000068</span>  <span class="nf">invoke-static</span>       <span class="no">Log-</span><span class="err">&gt;</span><span class="no">d</span><span class="p">(</span><span class="no">String</span><span class="p">,</span> <span class="no">String</span><span class="p">)</span><span class="no">I</span><span class="p">,</span> <span class="no">v1</span><span class="p">,</span> <span class="no">v0</span>
<span class="err">0000006</span><span class="nf">E</span>  <span class="no">throw</span>               <span class="no">p1</span>
<span class="na">.end</span> <span class="no">method</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">/*首先需要明确的是</span><span class="nf">finally的代码</span><span class="p">,</span><span class="err">不管有木有抛异常或者</span><span class="no">catch中的代码崩了</span><span class="p">,</span><span class="err">都会走</span><span class="no">finally的代码.</span>
<span class="err">编译器将</span><span class="nf">finally的代码提出来放在每个catch中</span><span class="p">,</span><span class="err">所以还原的时候</span><span class="p">,</span><span class="err">将每个</span><span class="no">catch中重复的代码提出来</span><span class="p">,</span><span class="err">就是</span><span class="no">finally的代码</span><span class="p">*</span>
<span class="na">.catch</span> <span class="no">ArrayIndexOutOfBoundsException</span> <span class="err">{</span><span class="p">:</span><span class="no">try_1A</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_20</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_50</span>
<span class="na">.catch</span> <span class="no">Exception</span> <span class="err">{</span><span class="p">:</span><span class="no">try_1A</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_20</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_3C</span>
<span class="na">.catchall</span> <span class="err">{</span><span class="p">:</span><span class="no">try_1A</span> <span class="no">..</span> <span class="p">:</span><span class="no">tryend_20</span><span class="err">}</span> <span class="p">:</span><span class="no">catch_28</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="smali调试">Smali调试</h3>
<h4 id="jdbexe">jdb.exe</h4>
<h5 id="jdwp协议">jdwp协议</h5>
<p>是Java Debug Wire Protocol的缩写,定义了调试器(debugger)和被调试的Java虚拟机(target vm)之间的通信协议.</p>
<p>使用jdwp协议来双机调试Android程序,调试之前需要端口映射,但很多工具已提前做好了端口映射.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">adb forward tcp:8700 jdwp:PID
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/jdwp%e5%8d%8f%e8%ae%ae.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/jdwp%E5%8D%8F%E8%AE%AE.png, images/Smali/jdwp%e5%8d%8f%e8%ae%ae.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/jdwp%E5%8D%8F%E8%AE%AE.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/jdwp%E5%8D%8F%E8%AE%AE.png"
        title="jdwp协议" /></p>
<h5 id="jdb所在目录">jdb所在目录</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/jdb%e6%89%80%e5%9c%a8%e7%9b%ae%e5%bd%95.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/jdb%E6%89%80%E5%9C%A8%E7%9B%AE%E5%BD%95.png, images/Smali/jdb%e6%89%80%e5%9c%a8%e7%9b%ae%e5%bd%95.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/jdb%E6%89%80%E5%9C%A8%E7%9B%AE%E5%BD%95.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/jdb%E6%89%80%E5%9C%A8%E7%9B%AE%E5%BD%95.png"
        title="jdb所在目录" /></p>
<p>输入jdb &ndash;help可查看帮助.</p>
<p>jdb可以用来调Android程序,Android上调试端口一般为8700,但是单步很麻烦,很多工具已集成该功能.</p>
<h4 id="android调试运行">Android调试运行</h4>
<h5 id="androidmenifest文件说明debug">AndroidMenifest文件说明Debug</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">android:debuggable=&#34;true&#34;
</code></pre></td></tr></table>
</div>
</div><p>虚拟机加不加这个都可以调试.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AndroidMenifest%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8eDebug.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AndroidMenifest%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8EDebug.png, images/Smali/AndroidMenifest%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8eDebug.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AndroidMenifest%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8EDebug.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AndroidMenifest%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8EDebug.png"
        title="AndroidMenifest文件说明Debug" /></p>
<h5 id="使用am调试运行">使用am调试运行</h5>
<p>位于Android系统,system/bin目录.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e4%bd%8d%e4%ba%8eAndroid%e7%b3%bb%e7%bb%9f,%e7%9b%ae%e5%bd%95.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E4%BD%8D%E4%BA%8EAndroid%E7%B3%BB%E7%BB%9F%2c%E7%9B%AE%E5%BD%95.png, images/Smali/%e4%bd%8d%e4%ba%8eAndroid%e7%b3%bb%e7%bb%9f%2c%e7%9b%ae%e5%bd%95.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E4%BD%8D%E4%BA%8EAndroid%E7%B3%BB%E7%BB%9F%2c%E7%9B%AE%E5%BD%95.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E4%BD%8D%E4%BA%8EAndroid%E7%B3%BB%E7%BB%9F,%E7%9B%AE%E5%BD%95.png"
        title="位于Android系统,目录" /></p>
<h6 id="查看帮助">查看帮助</h6>
<p>命令行输入 adb shell进shell</p>
<p>然后输入am,即可查看帮助.</p>
<h6 id="调试运行一个activity">调试运行一个Activity</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">am start -D -N org.example.luotest/.MainActivity
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e8%b0%83%e8%af%95%e8%bf%90%e8%a1%8c%e4%b8%80%e4%b8%aaActivity.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E8%B0%83%E8%AF%95%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AAActivity.png, images/Smali/%e8%b0%83%e8%af%95%e8%bf%90%e8%a1%8c%e4%b8%80%e4%b8%aaActivity.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E8%B0%83%E8%AF%95%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AAActivity.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E8%B0%83%E8%AF%95%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AAActivity.png"
        title="调试运行一个Activity" /></p>
<h4 id="jeb">Jeb</h4>
<h5 id="被调试程序源代码">被调试程序源代码</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>

        <span class="n">Button</span> <span class="n">button</span> <span class="o">=</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">);</span>
        <span class="n">button</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">3</span><span class="o">;</span>
                <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&#34;Luo&#34;</span><span class="o">,</span> <span class="s">&#34;onClick: &#34;</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="附加调试">附加调试</h5>
<p>切记调试的时候,关闭AndroidStudio,AS会占用8700端口.</p>
<ol>
<li>在虚拟机中运行该程序.</li>
<li>用Jeb打开该apk,找到按钮相应函数,下断(Ctrl + B)</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/Jeb%e9%99%84%e5%8a%a0%e8%b0%83%e8%af%952.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%952.png, images/Smali/Jeb%e9%99%84%e5%8a%a0%e8%b0%83%e8%af%952.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%952.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%952.png"
        title="Jeb附加调试2" /></p>
<ol start="3">
<li>Jeb菜单,调试器开始.</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/Jeb%e9%99%84%e5%8a%a0%e8%b0%83%e8%af%953.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%953.png, images/Smali/Jeb%e9%99%84%e5%8a%a0%e8%b0%83%e8%af%953.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%953.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%953.png"
        title="Jeb附加调试3" /></p>
<ol start="4">
<li>点附上,Jeb就会附加.</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/Jeb%e9%99%84%e5%8a%a0%e8%b0%83%e8%af%954.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%954.png, images/Smali/Jeb%e9%99%84%e5%8a%a0%e8%b0%83%e8%af%954.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%954.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%954.png"
        title="Jeb附加调试4" /></p>
<ol start="5">
<li>在虚拟机中,点击程序的按钮,就会在刚开始下断的地方断下.</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/Jeb%e9%99%84%e5%8a%a0%e8%b0%83%e8%af%955.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%955.png, images/Smali/Jeb%e9%99%84%e5%8a%a0%e8%b0%83%e8%af%955.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%955.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/Jeb%E9%99%84%E5%8A%A0%E8%B0%83%E8%AF%955.png"
        title="Jeb附加调试5" /></p>
<h4 id="androidstudio推荐">AndroidStudio(推荐)</h4>
<h5 id="下载smali反汇编插件-smalidea">下载Smali反汇编插件 smalidea.</h5>
<p><a href="https://bitbucket.org/JesusFreke/smalidea/downloads/" target="_blank" rel="noopener noreffer">https://bitbucket.org/JesusFreke/smalidea/downloads/</a></p>
<h5 id="安装插件">安装插件.</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b62_1.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B62_1.png, images/Smali/AS%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b62_1.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B62_1.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B62_1.png"
        title="AS安装插件2_1" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b62_2.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B62_2.png, images/Smali/AS%e5%ae%89%e8%a3%85%e6%8f%92%e4%bb%b62_2.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B62_2.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B62_2.png"
        title="AS安装插件2_2" /></p>
<h5 id="使用apktool反编译apk">使用apktool反编译apk.</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">java -jar apktool.jar d -f app-debug.apk
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%953.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%953.png, images/Smali/AS%e8%b0%83%e8%af%953.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%953.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%953.png"
        title="AS调试3" /></p>
<h5 id="使用as导入刚反编译出来的文件">使用AS导入刚反编译出来的文件</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%954_1.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_1.png, images/Smali/AS%e8%b0%83%e8%af%954_1.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_1.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_1.png"
        title="AS调试4_1" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%954_2.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_2.png, images/Smali/AS%e8%b0%83%e8%af%954_2.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_2.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_2.png"
        title="AS调试4_2" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%954_3.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_3.png, images/Smali/AS%e8%b0%83%e8%af%954_3.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_3.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%954_3.png"
        title="AS调试4_3" /></p>
<h5 id="调试运行一个activity-1">调试运行一个Activity</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="c1">//adb shell am start -D -n packageName/ActivityName(这两个参数在AndroidMainfest.xml里都可以找到)
</span><span class="c1">//分别对应package=xxx activity中android:name=xxx
</span><span class="c1"></span><span class="n">adb</span> <span class="n">shell</span> <span class="n">am</span> <span class="n">start</span> <span class="o">-</span><span class="n">D</span> <span class="o">-</span><span class="n">N</span> <span class="n">org</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">luotest</span><span class="o">/</span><span class="p">.</span><span class="n">MainActivity</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%955.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%955.png, images/Smali/AS%e8%b0%83%e8%af%955.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%955.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%955.png"
        title="AS调试5" /></p>
<h5 id="端口映射">端口映射</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">adb forward tcp:8700 jdwp:2745
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%956.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%956.png, images/Smali/AS%e8%b0%83%e8%af%956.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%956.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%956.png"
        title="AS调试6" /></p>
<h5 id="as下断远程附加">AS下断,远程附加</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%957_1.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_1.png, images/Smali/AS%e8%b0%83%e8%af%957_1.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_1.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_1.png"
        title="AS调试7_1" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%957_2.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_2.png, images/Smali/AS%e8%b0%83%e8%af%957_2.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_2.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_2.png"
        title="AS调试7_2" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%957_3.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_3.png, images/Smali/AS%e8%b0%83%e8%af%957_3.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_3.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_3.png"
        title="AS调试7_3" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%957_4.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_4.png, images/Smali/AS%e8%b0%83%e8%af%957_4.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_4.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%957_4.png"
        title="AS调试7_4" /></p>
<p>点击Debug按钮进行调试,就可以调试了.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/AS%e8%b0%83%e8%af%958.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%958.png, images/Smali/AS%e8%b0%83%e8%af%958.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%958.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/AS%E8%B0%83%E8%AF%958.png"
        title="AS调试8" /></p>
<h4 id="反调试">反调试</h4>
<h5 id="检测调试标志">检测调试标志</h5>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e6%a3%80%e6%b5%8b%e8%b0%83%e8%af%95%e6%a0%87%e5%bf%97.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%A3%80%E6%B5%8B%E8%B0%83%E8%AF%95%E6%A0%87%E5%BF%97.png, images/Smali/%e6%a3%80%e6%b5%8b%e8%b0%83%e8%af%95%e6%a0%87%e5%bf%97.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%A3%80%E6%B5%8B%E8%B0%83%E8%AF%95%E6%A0%87%E5%BF%97.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E6%A3%80%E6%B5%8B%E8%B0%83%E8%AF%95%E6%A0%87%E5%BF%97.png"
        title="检测调试标志" /></p>
<p>对策:给open这个api下断,发现他读的TracePid,就返回0.</p>
<h5 id="时间差">时间差</h5>
<p>不通过api拿时间,防止别人通过下时间断点来修改时间.</p>
<h5 id="检测ida端口号23946">检测IDA端口号23946</h5>
<p><strong>修改IDA端口号</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">/data/local/tmp/android_server -i 127.0.0.1 -p 8899
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="images/Smali/%e4%bf%ae%e6%94%b9IDA%e7%ab%af%e5%8f%a3%e5%8f%b7.png"
        data-srcset="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E4%BF%AE%E6%94%B9IDA%E7%AB%AF%E5%8F%A3%E5%8F%B7.png, images/Smali/%e4%bf%ae%e6%94%b9IDA%e7%ab%af%e5%8f%a3%e5%8f%b7.png 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E4%BF%AE%E6%94%B9IDA%E7%AB%AF%E5%8F%A3%E5%8F%B7.png 2x"
        data-sizes="auto"
        alt="/posts/android/android%E5%9F%BA%E7%A1%80/smali/images/Smali/%E4%BF%AE%E6%94%B9IDA%E7%AB%AF%E5%8F%A3%E5%8F%B7.png"
        title="修改IDA端口号" /></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-09-05</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/smali/">Smali</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/%E5%B9%B3%E5%8F%B0api/github/" class="prev" rel="prev" title="Github Api调用"><i class="fas fa-angle-left fa-fw"></i>Github Api调用</a>
            <a href="/posts/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/cobaltstrike/" class="next" rel="next" title="CobaltStrike使用">CobaltStrike使用<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">夏洛魂</div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">夏洛魂</a></span>&nbsp;|&nbsp;<span class="license">MIT</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":150},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
