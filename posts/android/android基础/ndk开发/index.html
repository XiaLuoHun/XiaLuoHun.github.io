<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>NDK开发 - 夏洛魂的个人博客</title><meta name="author" content="夏洛魂">
<meta name="author-link" content="">
<meta name="description" content="概述 全称:Native Development Kit,可让您使用C和C&#43;&#43;等语言以原生代码实现应用的各个部分. 网址: https://developer.android.google.cn/ndk 文件类型: 1 2 3 .o 等同于.Obj .a 等同于.l" /><meta name="keywords" content='NDK' />
  <meta itemprop="name" content="NDK开发">
  <meta itemprop="description" content="概述 全称:Native Development Kit,可让您使用C和C&#43;&#43;等语言以原生代码实现应用的各个部分. 网址: https://developer.android.google.cn/ndk 文件类型: 1 2 3 .o 等同于.Obj .a 等同于.l">
  <meta itemprop="datePublished" content="2021-10-21T00:00:00+00:00">
  <meta itemprop="dateModified" content="2021-10-21T00:00:00+00:00">
  <meta itemprop="wordCount" content="7449">
  <meta itemprop="image" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B.png">
  <meta itemprop="keywords" content="NDK"><meta property="og:url" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/">
  <meta property="og:site_name" content="夏洛魂的个人博客">
  <meta property="og:title" content="NDK开发">
  <meta property="og:description" content="概述 全称:Native Development Kit,可让您使用C和C&#43;&#43;等语言以原生代码实现应用的各个部分. 网址: https://developer.android.google.cn/ndk 文件类型: 1 2 3 .o 等同于.Obj .a 等同于.l">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-10-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-10-21T00:00:00+00:00">
    <meta property="article:tag" content="NDK">
    <meta property="og:image" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B.png">
  <meta name="twitter:title" content="NDK开发">
  <meta name="twitter:description" content="概述 全称:Native Development Kit,可让您使用C和C&#43;&#43;等语言以原生代码实现应用的各个部分. 网址: https://developer.android.google.cn/ndk 文件类型: 1 2 3 .o 等同于.Obj .a 等同于.l">
<meta name="application-name" content="夏洛魂">
<meta name="apple-mobile-web-app-title" content="夏洛魂"><meta name="theme-color" data-light="#ffffff" data-dark="#ffffff" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/" /><link rel="prev" href="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/android%E5%BC%80%E5%8F%91/" /><link rel="next" href="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/android%E9%80%86%E5%90%91%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/android%E9%80%86%E5%90%91%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "NDK开发",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/XiaLuoHun.github.io\/posts\/android\/android%E5%9F%BA%E7%A1%80\/ndk%E5%BC%80%E5%8F%91\/"
    },"image": [{
              "@type": "ImageObject",
              "url": "https:\/\/XiaLuoHun.github.io\/posts\/android\/android%E5%9F%BA%E7%A1%80\/ndk%E5%BC%80%E5%8F%91\/images\/%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B.png",
              "width":  644 ,
              "height":  643 
            }],"genre": "posts","keywords": "NDK","wordcount":  7449 ,
    "url": "https:\/\/XiaLuoHun.github.io\/posts\/android\/android%E5%9F%BA%E7%A1%80\/ndk%E5%BC%80%E5%8F%91\/","datePublished": "2021-10-21T00:00:00+00:00","dateModified": "2021-10-21T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "夏洛魂"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="夏洛魂的个人博客"><span class="header-title-text">夏洛魂</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              >文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              >标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              >分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/excalidraw/"
                
                
              >在线绘图</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              >关于作者</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="夏洛魂的个人博客"><span class="header-title-text">夏洛魂</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                >文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                >标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                >分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/excalidraw/"
                  
                  
                >在线绘图</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                >关于作者</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>NDK开发</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="/images/Luo.png" alt="夏洛魂" data-title="夏洛魂" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;夏洛魂</span></span><span class="post-included-in">&nbsp;收录于 <a href="/categories/android%E5%9F%BA%E7%A1%80/" class="post-category" title="分类 - Android基础"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Android基础</a></span></div><div class="post-meta-line"><span title="发布于 2021-10-21 00:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2021-10-21">2021-10-21</time></span>&nbsp;<span title="7449 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 7500 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 15 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#概述">概述</a></li>
        <li><a href="#编译器">编译器</a></li>
        <li><a href="#通用编译脚本">通用编译脚本</a>
          <ul>
            <li><a href="#makefile">Makefile</a></li>
            <li><a href="#cmake编译android主推">Cmake编译(Android主推)</a></li>
          </ul>
        </li>
        <li><a href="#静态库">静态库</a>
          <ul>
            <li><a href="#编译">编译</a>
              <ul>
                <li><a href="#手工编译">手工编译</a></li>
                <li><a href="#ndk-build">ndk-build</a></li>
                <li><a href="#cmake编译">Cmake编译</a></li>
              </ul>
            </li>
            <li><a href="#cmake使用第三方静态库">Cmake使用第三方静态库</a></li>
            <li><a href="#优点">优点</a></li>
            <li><a href="#缺点">缺点</a></li>
          </ul>
        </li>
        <li><a href="#动态库">动态库</a>
          <ul>
            <li><a href="#编译-1">编译</a>
              <ul>
                <li><a href="#手工编译-1">手工编译</a></li>
                <li><a href="#ndk-build-1">ndk-build</a></li>
                <li><a href="#cmake编译-1">Cmake编译</a></li>
              </ul>
            </li>
            <li><a href="#优点-1">优点</a></li>
            <li><a href="#缺点-1">缺点</a></li>
            <li><a href="#查看导出函数">查看导出函数</a></li>
            <li><a href="#函数不导出">函数不导出</a></li>
            <li><a href="#初始化函数">初始化函数</a></li>
            <li><a href="#动态使用">动态使用</a></li>
          </ul>
        </li>
        <li><a href="#android-api">Android API</a>
          <ul>
            <li><a href="#ndk">NDK</a></li>
            <li><a href="#posix">Posix</a>
              <ul>
                <li><a href="#errno">errno</a></li>
                <li><a href="#文件">文件</a></li>
                <li><a href="#线程">线程</a></li>
                <li><a href="#进程">进程</a></li>
                <li><a href="#网络编程">网络编程</a>
                  <ul>
                    <li><a href="#常规socket">常规Socket</a></li>
                    <li><a href="#domain-socket">DoMain Socket</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#混合编程jni">混合编程JNI</a>
          <ul>
            <li><a href="#概述-1">概述</a></li>
            <li><a href="#java调c">Java调C++</a></li>
            <li><a href="#java反射">Java反射</a></li>
            <li><a href="#c调java">C++调Java</a></li>
            <li><a href="#源代码">源代码</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 id="概述" class="heading-element"><span>概述</span>
  <a href="#%e6%a6%82%e8%bf%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>全称:Native Development Kit,可让您使用C和C++等语言以原生代码实现应用的各个部分.</p>
<p>网址:</p>
<p><a href="https://developer.android.google.cn/ndk"target="_blank" rel="external nofollow noopener noreferrer">https://developer.android.google.cn/ndk</a></p>
<p>文件类型:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.o 等同于.Obj
</span></span><span class="line"><span class="cl">.a 等同于.lib
</span></span><span class="line"><span class="cl">.so等同于.dll</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="编译器" class="heading-element"><span>编译器</span>
  <a href="#%e7%bc%96%e8%af%91%e5%99%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>目前主要是clang编译器,Gcc编译器已被移除.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Gcc%E5%B7%B2%E8%A2%AB%E7%A7%BB%E9%99%A4.png" alt="Gcc已被移除" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Gcc%E5%B7%B2%E8%A2%AB%E7%A7%BB%E9%99%A4.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Gcc%E5%B7%B2%E8%A2%AB%E7%A7%BB%E9%99%A4.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Gcc%E5%B7%B2%E8%A2%AB%E7%A7%BB%E9%99%A4.png?size=large 2x" data-title="Gcc已被移除" style="--width: 1028px;--aspect-ratio: 1028 / 595;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>下载NDK,里面有Clang编译器.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Clang%E7%BC%96%E8%AF%91%E5%99%A8.png" alt="Clang编译器" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Clang%E7%BC%96%E8%AF%91%E5%99%A8.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Clang%E7%BC%96%E8%AF%91%E5%99%A8.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Clang%E7%BC%96%E8%AF%91%E5%99%A8.png?size=large 2x" data-title="Clang编译器" style="--width: 876px;--aspect-ratio: 876 / 511;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>编译示例:</p>
<p>将Clang编译器所在目录加入到环境变量path中,这个目录中有很多做好的cmd文件(如:i686-linux-android16-clang.cmd).</p>
<p>假如说编译Hello.c</p>
<ol>
<li>编译</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">i686-linux-android16-clang -c -o Hello.o Hello.c</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B1.png" alt="编译示例1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B1.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B1.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B1.png?size=large 2x" data-title="编译示例1" style="--width: 931px;--aspect-ratio: 931 / 212;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>链接</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">i686-linux-android16-clang -o Hello Hello.o</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B2.png" alt="编译示例2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B2.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B2.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B2.png?size=large 2x" data-title="编译示例2" style="--width: 916px;--aspect-ratio: 916 / 254;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>生成的Hello文件格式为Elf.</p>
<ol start="3">
<li>将生成的文件传到手机上运行</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//传文件到手机上
</span></span><span class="line"><span class="cl">adb push Hello /data/local/tmp
</span></span><span class="line"><span class="cl">//进入shell,修改/data/local/tmp/Hello路径权限为可执行
</span></span><span class="line"><span class="cl">adb shell
</span></span><span class="line"><span class="cl">chmod a+x /data/local/tmp/Hello
</span></span><span class="line"><span class="cl">//运行程序
</span></span><span class="line"><span class="cl">/data/local/tmp/Hello</span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">若要在手机上运行Hello这个程序,需要使用shell命令.若手机有Root权限,该Hello文件执行时也会有Root权限,但是apk文件不会具有Root权限,它只能得到一个带root权限的shell.</div>
    </div>
  </div>
<h2 id="通用编译脚本" class="heading-element"><span>通用编译脚本</span>
  <a href="#%e9%80%9a%e7%94%a8%e7%bc%96%e8%af%91%e8%84%9a%e6%9c%ac" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 id="makefile" class="heading-element"><span>Makefile</span>
  <a href="#makefile" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>假如说10个人开发一个软件,用VS是不行的.</p>
<p>Android NDK工具包中有makefile解释器.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/makefile%E8%A7%A3%E9%87%8A%E5%99%A8.png" alt="makefile解释器" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/makefile%E8%A7%A3%E9%87%8A%E5%99%A8.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/makefile%E8%A7%A3%E9%87%8A%E5%99%A8.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/makefile%E8%A7%A3%E9%87%8A%E5%99%A8.png?size=large 2x" data-title="makefile解释器" style="--width: 638px;--aspect-ratio: 638 / 259;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>效率:</p>
<p>当生成的某个obj文件没有发生变化时,不重新生成,提高编译效率,可通过判断obj生成时间和.c文件的生成时间,若前者大于后者,则说明不需要重新生成,否则就需要重新生成obj文件.</p>
<p>语法参考:</p>
<p><a href="https://github.com/seisman/how-to-write-makefile"target="_blank" rel="external nofollow noopener noreferrer">https://github.com/seisman/how-to-write-makefile</a></p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/Makefile%E8%AF%AD%E6%B3%95%E5%8F%82%E8%80%83.pdf">Makefile语法参考.pdf</a></p>
<p>ndk-build脚本:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/ndk-build%E8%84%9A%E6%9C%AC.png" alt="ndk-build脚本" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/ndk-build%E8%84%9A%E6%9C%AC.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/ndk-build%E8%84%9A%E6%9C%AC.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/ndk-build%E8%84%9A%E6%9C%AC.png?size=large 2x" data-title="ndk-build脚本" style="--width: 971px;--aspect-ratio: 971 / 482;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>手工编译示例:</p>
<ol>
<li>将ndk-build.cmd所在的路径添加到系统环境变量中.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B1.png" alt="手工编译示例1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B1.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B1.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B1.png?size=large 2x" data-title="手工编译示例1" style="--width: 723px;--aspect-ratio: 723 / 452;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>将要编译的文件放到一个名为jni或cpp的文件夹中.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B2.png" alt="手工编译示例2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B2.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B2.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B2.png?size=large 2x" data-title="手工编译示例2" style="--width: 760px;--aspect-ratio: 760 / 143;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="3">
<li>新建一个Android.mk文件.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B3.png" alt="手工编译示例3" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B3.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B3.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B3.png?size=large 2x" data-title="手工编译示例3" style="--width: 1008px;--aspect-ratio: 1008 / 476;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B4.png" alt="手工编译示例4" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B4.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B4.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B4.png?size=large 2x" data-title="手工编译示例4" style="--width: 730px;--aspect-ratio: 730 / 509;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B5.png" alt="手工编译示例5" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B5.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B5.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B5.png?size=large 2x" data-title="手工编译示例5" style="--width: 851px;--aspect-ratio: 851 / 357;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="4">
<li>新建一个Application.mk文件.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B6.png" alt="手工编译示例6" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B6.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B6.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B6.png?size=large 2x" data-title="手工编译示例6" style="--width: 1036px;--aspect-ratio: 1036 / 492;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B7.png" alt="手工编译示例7" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B7.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B7.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B7.png?size=large 2x" data-title="手工编译示例7" style="--width: 408px;--aspect-ratio: 408 / 123;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="5">
<li>编译.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ndk-build</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B8.png" alt="手工编译示例8" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B8.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B8.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B8.png?size=large 2x" data-title="手工编译示例8" style="--width: 850px;--aspect-ratio: 850 / 434;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B9.png" alt="手工编译示例9" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B9.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B9.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91%E7%A4%BA%E4%BE%8B9.png?size=large 2x" data-title="手工编译示例9" style="--width: 883px;--aspect-ratio: 883 / 119;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="6">
<li>编译清理.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ndk-build clean</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/ndk-build%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91.7z">ndk-build手工编译.7z</a></p>
<p>利用AndroidStudio来编译:</p>
<ol>
<li>AS新建一个空工程.</li>
<li>将上面的jni或cpp文件夹拷贝到新建的工程中.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%911.png" alt="利用AndroidStudio来编译1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%911.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%911.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%911.png?size=large 2x" data-title="利用AndroidStudio来编译1" style="--width: 876px;--aspect-ratio: 876 / 180;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>在AS中选择Link C++ Project.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%912.png" alt="利用AndroidStudio来编译2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%912.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%912.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%912.png?size=large 2x" data-title="利用AndroidStudio来编译2" style="--width: 789px;--aspect-ratio: 789 / 195;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%913.png" alt="利用AndroidStudio来编译3" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%913.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%913.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%913.png?size=large 2x" data-title="利用AndroidStudio来编译3" style="--width: 576px;--aspect-ratio: 576 / 244;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>这个地方的右键,其实是在编译脚本中加了一段话.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%914.png" alt="利用AndroidStudio来编译4" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%914.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%914.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%914.png?size=large 2x" data-title="利用AndroidStudio来编译4" style="--width: 914px;--aspect-ratio: 914 / 505;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="4">
<li>指明NDK路径,下载了NDK,默认即可.</li>
<li>指定编译的平台.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%915.png" alt="利用AndroidStudio来编译5" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%915.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%915.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%915.png?size=large 2x" data-title="利用AndroidStudio来编译5" style="--width: 974px;--aspect-ratio: 974 / 474;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="6">
<li>Ctrl + F9 编译工程即可.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%916.png" alt="利用AndroidStudio来编译6" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%916.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%916.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%A9%E7%94%A8AndroidStudio%E6%9D%A5%E7%BC%96%E8%AF%916.png?size=large 2x" data-title="利用AndroidStudio来编译6" style="--width: 833px;--aspect-ratio: 833 / 141;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/ndk-build_AS%E7%BC%96%E8%AF%91.7z">ndk-build_AS编译.7z</a></p>
<div class="details admonition note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content"><p>用ndk-build编译C++程序需注意,Cmake编译无需注意.</p>
<p>需要设置STL C++异常 Rtti的开关.</p>
</div>
    </div>
  </div>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/ndk-build%E6%B3%A8%E6%84%8F.png" alt="ndk-build注意" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/ndk-build%E6%B3%A8%E6%84%8F.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/ndk-build%E6%B3%A8%E6%84%8F.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/ndk-build%E6%B3%A8%E6%84%8F.png?size=large 2x" data-title="ndk-build注意" style="--width: 819px;--aspect-ratio: 819 / 514;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="cmake编译android主推" class="heading-element"><span>Cmake编译(Android主推)</span>
  <a href="#cmake%e7%bc%96%e8%af%91android%e4%b8%bb%e6%8e%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%91%E6%A6%82%E8%BF%B0.png" alt="Cmake编译概述" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%91%E6%A6%82%E8%BF%B0.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%91%E6%A6%82%E8%BF%B0.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%91%E6%A6%82%E8%BF%B0.png?size=large 2x" data-title="Cmake编译概述" style="--width: 1082px;--aspect-ratio: 1082 / 540;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol>
<li>新建一个工程,这个工程默认就是CMake编译.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%911.png" alt="Cmake编译1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%911.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%911.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%911.png?size=large 2x" data-title="Cmake编译1" style="--width: 576px;--aspect-ratio: 576 / 417;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>将要编译的文件,放到工程的cpp目录中.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%912.png" alt="Cmake编译2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%912.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%912.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%912.png?size=large 2x" data-title="Cmake编译2" style="--width: 721px;--aspect-ratio: 721 / 176;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="3">
<li>添加编译链接内容.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%913.png" alt="Cmake编译3" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%913.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%913.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%913.png?size=large 2x" data-title="Cmake编译3" style="--width: 1041px;--aspect-ratio: 1041 / 493;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%914.png" alt="Cmake编译4" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%914.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%914.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%914.png?size=large 2x" data-title="Cmake编译4" style="--width: 1038px;--aspect-ratio: 1038 / 574;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="4">
<li>指定编译的平台.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%915.png" alt="Cmake编译5" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%915.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%915.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%915.png?size=large 2x" data-title="Cmake编译5" style="--width: 1104px;--aspect-ratio: 1104 / 458;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="5">
<li>Ctrl + F9编译工程即可.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%916.png" alt="Cmake编译6" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%916.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%916.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E7%BC%96%E8%AF%916.png?size=large 2x" data-title="Cmake编译6" style="--width: 809px;--aspect-ratio: 809 / 138;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/Cmake%E7%BC%96%E8%AF%91.7z">Cmake编译.7z</a></p>
<h2 id="静态库" class="heading-element"><span>静态库</span>
  <a href="#%e9%9d%99%e6%80%81%e5%ba%93" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>又称归档文件,当一个工程链接静态库时,只会链接需要的Obj.</p>
<h3 id="编译" class="heading-element"><span>编译</span>
  <a href="#%e7%bc%96%e8%af%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="手工编译" class="heading-element"><span>手工编译</span>
  <a href="#%e6%89%8b%e5%b7%a5%e7%bc%96%e8%af%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>编译静态库的程序为llvm-ar.exe.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//mou1.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">mou1</span><span class="p">();</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//mou1.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&#34;mou1.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">mou1</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello mou1</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//main.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&#34;mou1.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">mou1</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello Main</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="err">//Makefile</span>
</span></span><span class="line"><span class="cl"><span class="nv">NDK_PATH</span> <span class="o">:=</span> D:/AndroidSDK/ndk/21.4.7075529/toolchains/llvm/prebuilt/windows-x86_64/bin
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_ABI</span> <span class="o">:=</span> i686
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_PLT_VERSION</span> <span class="o">:=</span> android21
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_CLANG</span> <span class="o">:=</span> <span class="k">$(</span>BUILD_ABI<span class="k">)</span>-linux-<span class="k">$(</span>BUILD_PLT_VERSION<span class="k">)</span>-clang
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_AR</span> <span class="o">:=</span> <span class="k">$(</span>BUILD_ABI<span class="k">)</span>-linux-android-ar
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_MODULE_NAME</span> <span class="o">:=</span> main
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_LIB_NAME</span> <span class="o">:=</span> libmou.a
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_FLAGS</span> <span class="o">:=</span> -c
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_LINKER_FLAGS</span> <span class="o">:=</span> -o <span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span> main.o mou1.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">all</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> <span class="k">$(</span>BUILD_FLAGS<span class="k">)</span> main.c mou1.c
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> <span class="k">$(</span>BUILD_LINKER_FLAGS<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">lib</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_AR<span class="k">)</span> r <span class="k">$(</span>BUILD_LIB_NAME<span class="k">)</span> mou1.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">install</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	adb push <span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span> /data/local/tmp
</span></span><span class="line"><span class="cl">	adb shell chmod a+x /data/local/tmp/<span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span>
</span></span><span class="line"><span class="cl">	adb shell /data/local/tmp/<span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">clean</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	del *.o <span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span> <span class="k">$(</span>BUILD_LIB_NAME<span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/%E9%9D%99%E6%80%81%E5%BA%93%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91.rar">静态库手工编译.rar</a></p>
<h4 id="ndk-build" class="heading-element"><span>ndk-build</span>
  <a href="#ndk-build" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>可以放到AS中进行编译.</p>
<ol>
<li>将要编译的源文件放到jni文件夹中.</li>
<li>新建一个Android.mk文件.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="c">#编译静态库
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">LOCAL_PATH</span> <span class="o">:=</span> <span class="k">$(</span>call my-dir<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="err">include</span> <span class="k">$(</span><span class="nv">CLEAR_VARS</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="c">#存储要构建的模块的名称
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">LOCAL_MODULE</span> <span class="o">:=</span> mou
</span></span><span class="line"><span class="cl"><span class="c">#列举源文件
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">LOCAL_SRC_FILES</span> <span class="o">:=</span> mou1.c mou2.c
</span></span><span class="line"><span class="cl"><span class="c">#包含编译脚本
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="err">include</span> <span class="k">$(</span><span class="nv">BUILD_STATIC_LIBRARY</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#使用静态库
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="err">include</span> <span class="k">$(</span><span class="nv">CLEAR_VARS</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">LOCAL_MODULE</span> <span class="o">:=</span> main
</span></span><span class="line"><span class="cl"><span class="nv">LOCAL_SRC_FILES</span> <span class="o">:=</span> main.c
</span></span><span class="line"><span class="cl"><span class="nv">LOCAL_STATIC_LIBRARIES</span> <span class="o">:=</span> mou
</span></span><span class="line"><span class="cl"><span class="err">include</span> <span class="k">$(</span><span class="nv">BUILD_EXECUTABLE</span><span class="k">)</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>新建一个Application.mk文件.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">APP_PLATFORM</span> <span class="o">:=</span> android-16
</span></span><span class="line"><span class="cl"><span class="nv">APP_ABI</span> <span class="o">:=</span> x86_64
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>cmd运行ndk-build进行编译.
<img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93ndk-build.png" alt="静态库ndk-build" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93ndk-build.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93ndk-build.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93ndk-build.png?size=large 2x" data-title="静态库ndk-build" style="--width: 820px;--aspect-ratio: 820 / 438;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></li>
</ol>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/%E9%9D%99%E6%80%81%E5%BA%93ndk-build.7z">静态库ndk-build.7z</a></p>
<h4 id="cmake编译" class="heading-element"><span>Cmake编译</span>
  <a href="#cmake%e7%bc%96%e8%af%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>假设编译的为Cpp文件,需要注意头文件加 extern &ldquo;C&rdquo;.</p>
<ol>
<li>新建一个工程.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%911.png" alt="静态库Cmake编译1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%911.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%911.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%911.png?size=large 2x" data-title="静态库Cmake编译1" style="--width: 814px;--aspect-ratio: 814 / 589;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>在cpp文件夹新建源文件.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%912.png" alt="静态库Cmake编译2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%912.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%912.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%912.png?size=large 2x" data-title="静态库Cmake编译2" style="--width: 1008px;--aspect-ratio: 1008 / 375;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="3">
<li>指明要静态编译的文件.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%913.png" alt="静态库Cmake编译3" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%913.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%913.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%913.png?size=large 2x" data-title="静态库Cmake编译3" style="--width: 1034px;--aspect-ratio: 1034 / 439;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%914.png" alt="静态库Cmake编译4" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%914.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%914.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%914.png?size=large 2x" data-title="静态库Cmake编译4" style="--width: 1030px;--aspect-ratio: 1030 / 598;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="4">
<li>修改编译脚本.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%915.png" alt="静态库Cmake编译5" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%915.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%915.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%915.png?size=large 2x" data-title="静态库Cmake编译5" style="--width: 1048px;--aspect-ratio: 1048 / 399;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="5">
<li>直接编译即可.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%916.png" alt="静态库Cmake编译6" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%916.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%916.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%916.png?size=large 2x" data-title="静态库Cmake编译6" style="--width: 244px;--aspect-ratio: 244 / 360;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%917.png" alt="静态库Cmake编译7" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%917.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%917.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%9D%99%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%917.png?size=large 2x" data-title="静态库Cmake编译7" style="--width: 592px;--aspect-ratio: 592 / 140;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="cmake使用第三方静态库" class="heading-element"><span>Cmake使用第三方静态库</span>
  <a href="#cmake%e4%bd%bf%e7%94%a8%e7%ac%ac%e4%b8%89%e6%96%b9%e9%9d%99%e6%80%81%e5%ba%93" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E9%9D%99%E6%80%81%E5%BA%93.png" alt="Cmake使用第三方静态库" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E9%9D%99%E6%80%81%E5%BA%93.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E9%9D%99%E6%80%81%E5%BA%93.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Cmake%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E9%9D%99%E6%80%81%E5%BA%93.png?size=large 2x" data-title="Cmake使用第三方静态库" style="--width: 1121px;--aspect-ratio: 1121 / 575;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="优点" class="heading-element"><span>优点</span>
  <a href="#%e4%bc%98%e7%82%b9" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>软件静态链接静态库的时候,只链接需要的代码.</p>
<h3 id="缺点" class="heading-element"><span>缺点</span>
  <a href="#%e7%bc%ba%e7%82%b9" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>某一个.o文件有Bug,其他已经链接了该静态库的软件需要重新编译链接,维护性差.</p>
<h2 id="动态库" class="heading-element"><span>动态库</span>
  <a href="#%e5%8a%a8%e6%80%81%e5%ba%93" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 id="编译-1" class="heading-element"><span>编译</span>
  <a href="#%e7%bc%96%e8%af%91-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="手工编译-1" class="heading-element"><span>手工编译</span>
  <a href="#%e6%89%8b%e5%b7%a5%e7%bc%96%e8%af%91-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="err">//Makefile</span>
</span></span><span class="line"><span class="cl"><span class="nv">NDK_PATH</span> <span class="o">:=</span> D:/AndroidSDK/ndk/21.4.7075529/toolchains/llvm/prebuilt/windows-x86_64/bin
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_ABI</span> <span class="o">:=</span> i686
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_PLT_VERSION</span> <span class="o">:=</span> android21
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_CLANG</span> <span class="o">:=</span> <span class="k">$(</span>BUILD_ABI<span class="k">)</span>-linux-<span class="k">$(</span>BUILD_PLT_VERSION<span class="k">)</span>-clang
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_AR</span> <span class="o">:=</span> <span class="k">$(</span>BUILD_ABI<span class="k">)</span>-linux-android-ar
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_MODULE_NAME</span> <span class="o">:=</span> main
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_LIB_NAME</span> <span class="o">:=</span> libmou.so
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_FLAGS</span> <span class="o">:=</span> -c
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_LINKER_FLAGS</span> <span class="o">:=</span> -o <span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span> main.o <span class="k">$(</span>BUILD_LIB_NAME<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">all</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> <span class="k">$(</span>BUILD_FLAGS<span class="k">)</span> main.c
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> <span class="k">$(</span>BUILD_LINKER_FLAGS<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">lib</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> -c mou1.c mou2.c
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> -o <span class="k">$(</span>BUILD_LIB_NAME<span class="k">)</span> -fpic -shared mou1.o mou2.o
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">install</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	adb push <span class="k">$(</span>BUILD_LIB_NAME<span class="k">)</span> /data/local/tmp
</span></span><span class="line"><span class="cl">	adb push <span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span> /data/local/tmp
</span></span><span class="line"><span class="cl">	adb shell chmod a+x /data/local/tmp/<span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span>
</span></span><span class="line"><span class="cl">	adb shell /data/local/tmp/<span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">clean</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	del *.o <span class="k">$(</span>BUILD_MODULE_NAME<span class="k">)</span> <span class="k">$(</span>BUILD_LIB_NAME<span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>-fpic 位置无关代码.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="c">#编译动态库
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="err">make</span> <span class="err">lib</span>
</span></span><span class="line"><span class="cl"><span class="c">#编译可执行文件
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="err">make</span>
</span></span><span class="line"><span class="cl"><span class="c">#安装可执行文件到Android中并运行
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="err">make</span> <span class="err">install</span></span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/%E5%8A%A8%E6%80%81%E5%BA%93%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91.7z">动态库手工编译.7z</a></p>
<p>报错处理:</p>
<p>需了解Linux共享库搜索规则.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93%E6%8A%A5%E9%94%991.png" alt="动态库报错1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93%E6%8A%A5%E9%94%991.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93%E6%8A%A5%E9%94%991.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93%E6%8A%A5%E9%94%991.png?size=large 2x" data-title="动态库报错1" style="--width: 808px;--aspect-ratio: 808 / 524;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>共享库搜索路径:</p>
<ol>
<li>system/lib</li>
<li>user/lib</li>
<li>环境变量,如果以apk运行,会将/data/data/packageName/lib设为环境变量</li>
</ol>
<p>示例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//查看环境变量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">echo</span> <span class="err">$</span><span class="n">LD_LIBRARY_PATH</span>
</span></span><span class="line"><span class="cl"><span class="c1">//设置临时环境变量, 以:分割环境变量路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">export</span> <span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="err">$</span><span class="nl">LD_LIBRARY_PATH</span><span class="p">:</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">tmp</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93%E6%8A%A5%E9%94%992.png" alt="动态库报错2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93%E6%8A%A5%E9%94%992.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93%E6%8A%A5%E9%94%992.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93%E6%8A%A5%E9%94%992.png?size=large 2x" data-title="动态库报错2" style="--width: 770px;--aspect-ratio: 770 / 583;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="ndk-build-1" class="heading-element"><span>ndk-build</span>
  <a href="#ndk-build-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93ndk-build.png" alt="动态库ndk-build" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93ndk-build.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93ndk-build.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93ndk-build.png?size=large 2x" data-title="动态库ndk-build" style="--width: 576px;--aspect-ratio: 576 / 485;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>cmd 输入ndk-build即可编译.</p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/%E5%8A%A8%E6%80%81%E5%BA%93NDK-BUILD.7z">动态库NDK-BUILD.7z</a></p>
<h4 id="cmake编译-1" class="heading-element"><span>Cmake编译</span>
  <a href="#cmake%e7%bc%96%e8%af%91-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%91.png" alt="动态库Cmake编译" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%91.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%91.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E5%BA%93Cmake%E7%BC%96%E8%AF%91.png?size=large 2x" data-title="动态库Cmake编译" style="--width: 1023px;--aspect-ratio: 1023 / 662;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="优点-1" class="heading-element"><span>优点</span>
  <a href="#%e4%bc%98%e7%82%b9-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>某一个.so文件有Bug,只需重新编译该so文件即可.</p>
<h3 id="缺点-1" class="heading-element"><span>缺点</span>
  <a href="#%e7%bc%ba%e7%82%b9-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li>启动速度慢,但可以延迟加载.</li>
<li>软件加载动态库的时候,Dll中的函数代码全部进内存.</li>
</ul>
<h3 id="查看导出函数" class="heading-element"><span>查看导出函数</span>
  <a href="#%e6%9f%a5%e7%9c%8b%e5%af%bc%e5%87%ba%e5%87%bd%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">命令行 llvm-readelf -s so文件路径</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%9C%8B%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0.png" alt="看导出函数" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%9C%8B%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%9C%8B%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%9C%8B%E5%AF%BC%E5%87%BA%E5%87%BD%E6%95%B0.png?size=large 2x" data-title="看导出函数" style="--width: 976px;--aspect-ratio: 976 / 580;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="函数不导出" class="heading-element"><span>函数不导出</span>
  <a href="#%e5%87%bd%e6%95%b0%e4%b8%8d%e5%af%bc%e5%87%ba" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//在Linux中 函数默认是导出的,若不导出需加前缀
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__attribute__</span> <span class="p">((</span><span class="n">visibility</span><span class="p">(</span><span class="s">&#34;hidden&#34;</span><span class="p">)))</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%87%BD%E6%95%B0%E4%B8%8D%E5%AF%BC%E5%87%BA.png" alt="函数不导出" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%87%BD%E6%95%B0%E4%B8%8D%E5%AF%BC%E5%87%BA.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%87%BD%E6%95%B0%E4%B8%8D%E5%AF%BC%E5%87%BA.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%87%BD%E6%95%B0%E4%B8%8D%E5%AF%BC%E5%87%BA.png?size=large 2x" data-title="函数不导出" style="--width: 656px;--aspect-ratio: 656 / 225;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="初始化函数" class="heading-element"><span>初始化函数</span>
  <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e5%87%bd%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>不常用:</p>
<p>之所以说不常用,是因为不方便,每加一个功能都有可能会修改_init中的代码.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B01.png" alt="初始化函数1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B01.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B01.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B01.png?size=large 2x" data-title="初始化函数1" style="--width: 799px;--aspect-ratio: 799 / 291;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>常用:</p>
<p>方便,名字随意只要声明为构造或析构函数即可,数量不限.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B02.png" alt="初始化函数2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B02.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B02.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B02.png?size=large 2x" data-title="初始化函数2" style="--width: 844px;--aspect-ratio: 844 / 643;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="动态使用" class="heading-element"><span>动态使用</span>
  <a href="#%e5%8a%a8%e6%80%81%e4%bd%bf%e7%94%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>相关函数:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span><span class="o">*</span> <span class="nf">dlopen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__filename</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span><span class="o">*</span> <span class="nf">dlsym</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">__handle</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__symbol</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">dladdr</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">__addr</span><span class="p">,</span> <span class="n">Dl_info</span><span class="o">*</span> <span class="n">__info</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">dlclose</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">__handle</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>示例:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E4%BD%BF%E7%94%A8.png" alt="动态使用" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E4%BD%BF%E7%94%A8.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E4%BD%BF%E7%94%A8.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%8A%A8%E6%80%81%E4%BD%BF%E7%94%A8.png?size=large 2x" data-title="动态使用" style="--width: 936px;--aspect-ratio: 936 / 1135;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/%E5%8A%A8%E6%80%81%E5%BA%93%E4%BD%BF%E7%94%A8.7z">动态库使用.7z</a></p>
<h2 id="android-api" class="heading-element"><span>Android API</span>
  <a href="#android-api" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><p>基于Linux内核,遵循Posix标准,也有自己独有的API.</p>
<h3 id="ndk" class="heading-element"><span>NDK</span>
  <a href="#ndk" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>这是独有的API.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/AndroidAPINDK.png" alt="AndroidAPINDK" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/AndroidAPINDK.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/AndroidAPINDK.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/AndroidAPINDK.png?size=large 2x" data-title="AndroidAPINDK" style="--width: 802px;--aspect-ratio: 802 / 363;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>常用来打日志:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;android/log.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, &#34;LuoHun&#34;, __VA_ARGS__);
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LOGW(...) __android_log_print(ANDROID_LOG_WARN, &#34;LuoHun&#34;, __VA_ARGS__);
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LOGE(...) __android_log_print(ANDROID_LOG_ERROR, &#34;LuoHun&#34;, __VA_ARGS__);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>添加库:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/AndroidAPINDK%E6%B7%BB%E5%8A%A0%E5%BA%93.png" alt="AndroidAPINDK添加库" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/AndroidAPINDK%E6%B7%BB%E5%8A%A0%E5%BA%93.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/AndroidAPINDK%E6%B7%BB%E5%8A%A0%E5%BA%93.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/AndroidAPINDK%E6%B7%BB%E5%8A%A0%E5%BA%93.png?size=large 2x" data-title="AndroidAPINDK添加库" style="--width: 842px;--aspect-ratio: 842 / 527;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="posix" class="heading-element"><span>Posix</span>
  <a href="#posix" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>可移植操作系统接口(Portable Operating System Interface),无窗口API.</p>
<p>Cygwin,该库在Win32系统下实现了POSIX系统调用的API.</p>
<h4 id="errno" class="heading-element"><span>errno</span>
  <a href="#errno" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>扩展了 C标准的errno,下面是C标准的errno.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C%E6%A0%87%E5%87%86%E7%9A%84errno.png" alt="C标准的errno" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C%E6%A0%87%E5%87%86%E7%9A%84errno.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C%E6%A0%87%E5%87%86%E7%9A%84errno.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C%E6%A0%87%E5%87%86%E7%9A%84errno.png?size=large 2x" data-title="C标准的errno" style="--width: 736px;--aspect-ratio: 736 / 452;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>通过查文档可知该函数出错时,errno是否被设置.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/errno%E8%AE%BE%E7%BD%AE.png" alt="errno设置" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/errno%E8%AE%BE%E7%BD%AE.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/errno%E8%AE%BE%E7%BD%AE.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/errno%E8%AE%BE%E7%BD%AE.png?size=large 2x" data-title="errno设置" style="--width: 1304px;--aspect-ratio: 1304 / 456;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="文件" class="heading-element"><span>文件</span>
  <a href="#%e6%96%87%e4%bb%b6" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>相关函数:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//打开
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pathname</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//关闭
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">close</span><span class="p">(</span><span class="kt">int</span> <span class="n">__fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//读
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ssize_t</span> <span class="nf">read</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//写
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ssize_t</span> <span class="nf">write</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">count</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="c1">//移动文件指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">off_t</span> <span class="nf">lseek</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="n">off_t</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">whence</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="c1">//文件控制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">fcntl</span><span class="p">(</span><span class="kt">int</span> <span class="n">__fd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__cmd</span><span class="p">,</span> <span class="p">...);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//指定位置读写
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ssize_t</span> <span class="nf">pread</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">nbyte</span><span class="p">,</span> <span class="n">off_t</span> <span class="n">offset</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="n">ssize_t</span> <span class="nf">pwrite</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">off_t</span> <span class="n">offset</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//文件属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">stat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__path</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">stat</span><span class="o">*</span> <span class="n">__buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//检查文件权限
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">access</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__mode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//更改文件权限
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">chmod</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__path</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">__mode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">fchmod</span><span class="p">(</span><span class="kt">int</span> <span class="n">__fd</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">__mode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//创建目录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">mkdir</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__path</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">__mode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//遍历文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">DIR</span><span class="o">*</span> <span class="nf">opendir</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__path</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>文件控制:</p>
<p>fcntl的用途之一是针对一个打开的文件,获取或修改访问模式和状态标识.</p>
<p>要获取这些设置,应将fcntl的cmd参数设置为F_GETFL.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//下述到吗可以测试文件是否以同步写方式打开
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">nFlags</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">nFlags</span> <span class="o">=</span> <span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">F_GETFL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="n">nFlags</span> <span class="o">&amp;</span> <span class="n">O_SYNC</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>文件属性:</p>
<p>利用系统调用stat(),lstat(),fstat(),可以获取文件相关的信息.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//返回文件的相关信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">stat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__path</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">stat</span><span class="o">*</span> <span class="n">__buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//与stat类似,区别,如果文件属于符号链接,那么返回的信息针对是的符号链接自身
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">lstat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">__path</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">stat</span><span class="o">*</span> <span class="n">__buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//根据文件描述符获取文件的相关信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">fstat</span><span class="p">(</span><span class="kt">int</span> <span class="n">__fd</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">stat</span><span class="o">*</span> <span class="n">__buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">系统调用stat()和lstat()无需对其所操作的文件本身拥有任何的权限,但是针对指定的pathname的父目录要有执行(搜素)权限.而fstat()系统调用只要文件描述符有效,总是成功.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span></span></span></code></pre></td></tr></table>
</div>
</div><p>st_mode:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/st_mode.png" alt="st_mode" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/st_mode.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/st_mode.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/st_mode.png?size=large 2x" data-title="st_mode" style="--width: 576px;--aspect-ratio: 576 / 214;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>示例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">stat</span> <span class="n">statBuf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">stat</span><span class="p">(</span><span class="s">&#34;/data/local/tmp/2.txt&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">statBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">printf</span><span class="p">(</span><span class="s">&#34;st_uid = %d st_gid = %d st_size = %lld, st_mode = %o</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="n">statBuf</span><span class="p">.</span><span class="n">st_uid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="n">statBuf</span><span class="p">.</span><span class="n">st_gid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="n">statBuf</span><span class="p">.</span><span class="n">st_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">       <span class="n">statBuf</span><span class="p">.</span><span class="n">st_mode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">S_ISREG</span><span class="p">(</span><span class="n">statBuf</span><span class="p">.</span><span class="n">st_mode</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;常规文件</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">statBuf</span><span class="p">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="n">S_IRUSR</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;拥有读权限</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>目录权限:</p>
<p>目录与文件拥有相同的权限方案,只是对3种权限的含义另有所指.</p>
<ul>
<li>读权限:可列出目录之下的内容.</li>
<li>写权限:可在目录创建,删除文件.</li>
<li>可执行权限:可访问目录中的文件(搜索权限).</li>
</ul>
<p>权限检查算法:</p>
<ul>
<li>对于特权级进程,授予所有访问权限.</li>
<li>若进程的有效用户ID与文件的用户ID相同,内核会根据文件的属主权限,授予进程相应的访问权限.</li>
<li>若进程的有效组ID与文件的组ID相匹配,内核会根据文件的属组权限,授予进程相应的访问权限.</li>
<li>若以上3点都不满足,内核会根据文件的其他权限,授予进程相应的访问权限.</li>
</ul>
<p>示例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;jni.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;android/log.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, &#34;Luo&#34;, __VA_ARGS__);
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LOGW(...) __android_log_print(ANDROID_LOG_WARN, &#34;Luo&#34;, __VA_ARGS__);
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LOGE(...) __android_log_print(ANDROID_LOG_ERROR, &#34;Luo&#34;, __VA_ARGS__);
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*  FILE* fp = fopen(&#34;/data/local/tmp/1.txt&#34;, &#34;r&#34;);
</span></span></span><span class="line"><span class="cl"><span class="cm">    if (fp == NULL){
</span></span></span><span class="line"><span class="cl"><span class="cm">        //当C库函数出错了,会将错误传给全局变量errno
</span></span></span><span class="line"><span class="cl"><span class="cm">        printf(&#34;fopen error %d\n&#34;, errno);
</span></span></span><span class="line"><span class="cl"><span class="cm">        //将错误转换为字符串
</span></span></span><span class="line"><span class="cl"><span class="cm">        perror(&#34;fopen&#34;);
</span></span></span><span class="line"><span class="cl"><span class="cm">        //传errno,将错误字符串返回,方便界面显示
</span></span></span><span class="line"><span class="cl"><span class="cm">        char* pErr =  strerror(errno);
</span></span></span><span class="line"><span class="cl"><span class="cm">        printf(&#34;%s\n&#34;, pErr);
</span></span></span><span class="line"><span class="cl"><span class="cm">    }*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">&#34;/data/local/tmp/2.txt&#34;</span><span class="p">,</span> <span class="n">O_RDWR</span> <span class="o">|</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="n">S_IRWXU</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">fd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;open&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s">&#34;Hello&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">bytes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;write&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;write bytes: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">bytes</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">lseek</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_SET</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;lseek&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">szBuf</span><span class="p">[</span><span class="mh">0x100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="n">ssize_t</span> <span class="n">readBytes</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">szBuf</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">szBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">readBytes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;read&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;szBuf = %s readBytes = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">szBuf</span><span class="p">,</span> <span class="n">readBytes</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//获取文件属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">struct</span> <span class="nc">stat</span> <span class="n">statBuf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">stat</span><span class="p">(</span><span class="s">&#34;/data/local/tmp/2.txt&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">statBuf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;st_uid = %d st_gid = %d st_size = %lld, st_mode = %o</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="n">statBuf</span><span class="p">.</span><span class="n">st_uid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="n">statBuf</span><span class="p">.</span><span class="n">st_gid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="n">statBuf</span><span class="p">.</span><span class="n">st_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="n">statBuf</span><span class="p">.</span><span class="n">st_mode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">S_ISREG</span><span class="p">(</span><span class="n">statBuf</span><span class="p">.</span><span class="n">st_mode</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;常规文件</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">statBuf</span><span class="p">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="n">S_IRUSR</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;拥有读权限</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//修改文件权限 相同Uid才可以修改权限 Root用户除外
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">fchmod</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">S_IRWXU</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//检查文件权限
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">access</span><span class="p">(</span><span class="s">&#34;/data/local/tmp/2.txt&#34;</span><span class="p">,</span> <span class="n">W_OK</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;拥有写权限</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="线程" class="heading-element"><span>线程</span>
  <a href="#%e7%ba%bf%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>两种状态:</p>
<ul>
<li>连接状态,pthread_join,会阻塞,等待线程结束拿线程返回值.</li>
<li>分离状态,pthread_detach,不会阻塞,节省内存开销.</li>
</ul>
<p>终止线程:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">pthread_exit</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">value_ptr</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">当一个线程设置了一个取消点,可使用下述API结束那个线程,
</span></span></span><span class="line"><span class="cl"><span class="cm">那个线程运行到取消点时,会结束线程
</span></span></span><span class="line"><span class="cl"><span class="cm">但遗憾的是,Android不允许使用此API
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">pthread_cancel</span><span class="p">(</span><span class="n">pthread_t</span> <span class="kr">thread</span><span class="p">);</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>线程同步:</p>
<p>互斥体:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//初始化
</span></span></span><span class="line"><span class="cl"><span class="c1">//可以使用全局变量初始化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pthread_mutex_t</span> <span class="n">mutex</span> <span class="o">=</span> <span class="n">PTHREAD_MUTEX_INITIALIZER</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//也可以使用API初始化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">pthread_mutex_init</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="k">restrict</span> <span class="n">mutex</span><span class="p">,</span> <span class="k">const</span> <span class="n">pthread_mutexattr_t</span> <span class="o">*</span><span class="k">restrict</span> <span class="n">attr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//加锁
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">pthread_mutex_lock</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="n">mutex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//取消锁
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">pthread_mutex_unlock</span><span class="p">(</span><span class="n">pthread_mutex_t</span> <span class="o">*</span><span class="n">mutex</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>信号量:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//初始化
</span></span></span><span class="line"><span class="cl"><span class="c1">//跨进程使用sem_open
</span></span></span><span class="line"><span class="cl"><span class="c1">//不跨进程使用sem_init
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">sem_init</span><span class="p">(</span><span class="n">sem_t</span><span class="o">*</span> <span class="n">__sem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__shared</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">sem_t</span> <span class="o">*</span><span class="nf">sem_open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">sem_t</span> <span class="o">*</span><span class="nf">sem_open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflag</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">mode_t</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//释放信号量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">sem_post</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//等待信号量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">sem_wait</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>示例:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BA%BF%E7%A8%8B.png" alt="线程" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BA%BF%E7%A8%8B.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BA%BF%E7%A8%8B.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E7%BA%BF%E7%A8%8B.png?size=large 2x" data-title="线程" style="--width: 783px;--aspect-ratio: 783 / 1301;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="进程" class="heading-element"><span>进程</span>
  <a href="#%e8%bf%9b%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Android将进程相关操作从原来的process.h移动到了unistd.h</p>
<p>相关函数:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//获取自身进程PID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pid_t</span>  <span class="nf">getpid</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//获取父进程PID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pid_t</span>  <span class="nf">getppid</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//创建进程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">pid_t</span>  <span class="nf">fork</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//退进程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__noreturn</span> <span class="kt">void</span> <span class="nf">_exit</span><span class="p">(</span><span class="kt">int</span> <span class="n">__status</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">kill</span><span class="p">(</span><span class="n">pid_t</span> <span class="n">__pid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__signal</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//信号量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">sem_init</span><span class="p">(</span><span class="n">sem_t</span><span class="o">*</span> <span class="n">__sem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__shared</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">sem_t</span> <span class="o">*</span><span class="nf">sem_open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">sem_t</span> <span class="o">*</span><span class="nf">sem_open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflag</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">mode_t</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sem_close</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sem_destroy</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">sem_getvalue</span><span class="p">(</span><span class="n">sem_t</span> <span class="o">*</span><span class="n">sem</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">sval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//内存映射
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="nf">mmap</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">__addr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">__size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__prot</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__flags</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__fd</span><span class="p">,</span> <span class="n">off_t</span> <span class="n">__offset</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">munmap</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">__addr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">__size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">msync</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">__addr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">__size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__flags</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//修改内存保护属性,需要给页首地址,否则会失败
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">mprotect</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">__addr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">__size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__prot</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div><p>创建进程:</p>
<p>系统调用fork(),一个进程(父进程)创建一个新进程(子进程),新的子进程获取父进程的栈,数据段,堆和执行文本段的拷贝.</p>
<p>Linux系统中,父子进程关系很密切,同生共死.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B.png" alt="创建进程" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B.png?size=large 2x" data-title="创建进程" style="--width: 644px;--aspect-ratio: 644 / 643;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>虚拟文件系统:</p>
<p>Linux搞了一些假文件,通过操作这些假文件,可以访问内核的一些信息,Android中的虚拟文件在根目录的/proc中.</p>
<p>拿Cpu信息:</p>
<p>访问/proc/cpuinfo这个文件,就可以拿到Cpu信息.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%8B%BFCpu%E4%BF%A1%E6%81%AF.png" alt="拿Cpu信息" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%8B%BFCpu%E4%BF%A1%E6%81%AF.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%8B%BFCpu%E4%BF%A1%E6%81%AF.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E6%8B%BFCpu%E4%BF%A1%E6%81%AF.png?size=large 2x" data-title="拿Cpu信息" style="--width: 1355px;--aspect-ratio: 1355 / 447;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>遍历进程:</p>
<p>/proc目录下的每个以数字命名的文件夹都是一个进程,这些数字代表的是进程PID</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%81%8D%E5%8E%86%E8%BF%9B%E7%A8%8B1.png" alt="遍历进程1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%81%8D%E5%8E%86%E8%BF%9B%E7%A8%8B1.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%81%8D%E5%8E%86%E8%BF%9B%E7%A8%8B1.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E9%81%8D%E5%8E%86%E8%BF%9B%E7%A8%8B1.png?size=large 2x" data-title="遍历进程1" style="--width: 434px;--aspect-ratio: 434 / 711;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">EnumProcess</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">DIR</span> <span class="o">*</span><span class="n">dirp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="nc">dirent</span> <span class="o">*</span><span class="n">direntp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">dirp</span> <span class="o">=</span> <span class="n">opendir</span><span class="p">(</span><span class="s">&#34;/proc&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">dirp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;can&#39;t open /proc&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">direntp</span> <span class="o">=</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dirp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">direntp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// /proc目录中以数字开头的是进程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="n">direntp</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="sc">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">direntp</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//取进程路径,在命令行的第一个参数中,有的系统进程可能无路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">char</span> <span class="n">szProcessCmdPath</span><span class="p">[</span><span class="mh">0x1000</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">                <span class="kt">char</span> <span class="n">szProcessPath</span><span class="p">[</span><span class="mh">0x1000</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">                <span class="n">sprintf</span><span class="p">(</span><span class="n">szProcessCmdPath</span><span class="p">,</span> <span class="s">&#34;/proc/%s/cmdline&#34;</span><span class="p">,</span> <span class="n">direntp</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">szProcessCmdPath</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">fgets</span><span class="p">(</span><span class="n">szProcessPath</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">szProcessPath</span><span class="p">),</span> <span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">printf</span><span class="p">(</span><span class="s">&#34;PID:%s ProcessPath:%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">direntp</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">,</span> <span class="n">szProcessPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">closedir</span><span class="p">(</span><span class="n">dirp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>遍历模块:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">EnumModule</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mh">0x1000</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//访问/proc每个进程下的maps文件,即可遍历模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//只要root权限的用户才可以遍历别人进程的模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//遍历自身模块,可以写/proc/self/maps
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;/proc/self/maps&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>读写内存:</p>
<p>访问/proc/pid/mem文件即可,文件偏移就是内存地址.</p>
<p>Andorid内存搜索工具:GG</p>
<p>进程状态:</p>
<p>访问/proc/pid/status文件即可.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81.png" alt="进程状态" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81.png?size=large 2x" data-title="进程状态" style="--width: 686px;--aspect-ratio: 686 / 595;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="网络编程" class="heading-element"><span>网络编程</span>
  <a href="#%e7%bd%91%e7%bb%9c%e7%bc%96%e7%a8%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><h5 id="常规socket" class="heading-element"><span>常规Socket</span>
  <a href="#%e5%b8%b8%e8%a7%84socket" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>耗费网络资源</p>
<p>服务端:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;jni.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/in.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//初始化Socket
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;socket&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;socket s = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//绑定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sockaddr_in</span> <span class="n">addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">5566</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">INADDR_ANY</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">addr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;bind&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;bind s = %d ok</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//监听
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SOMAXCONN</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;listen&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;listen s = %d ok</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//接受连接
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">socklen_t</span> <span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="n">addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">cs</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">cs</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;accept&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;accept cs = %d ip:%s port:%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">),</span> <span class="n">htons</span><span class="p">(</span><span class="n">addr</span><span class="p">.</span><span class="n">sin_port</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">260</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">bytes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">bytes</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">bytes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;bytes:%d buf:%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">close</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;close Socket</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>客户端:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;jni.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/in.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//初始化Socket
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;socket&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;socket s = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//绑定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sockaddr_in</span> <span class="n">addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span><span class="p">.</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">AF_INET</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span><span class="p">.</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">5566</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">INADDR_ANY</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">addr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;connect&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;connect s = %d ok</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">260</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">bytes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">bytes</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;send bytes:%d buf:%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">close</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;close Socket</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="domain-socket" class="heading-element"><span>DoMain Socket</span>
  <a href="#domain-socket" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><ul>
<li>不耗费网络资源.</li>
<li>无IP和端口概念,用虚拟文件来代替IP地址.</li>
</ul>
<p>服务端:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;jni.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/in.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/un.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//初始化Socket
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;socket&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;socket s = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//绑定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//删除文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">unlink</span><span class="p">(</span><span class="s">&#34;/data/local/tmp/myServer&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sockaddr_un</span> <span class="n">addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//协议要用AF_UNIX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">addr</span><span class="p">.</span><span class="n">sun_family</span> <span class="o">=</span> <span class="n">AF_UNIX</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//用文件来代替IP地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">strcpy</span><span class="p">(</span><span class="n">addr</span><span class="p">.</span><span class="n">sun_path</span><span class="p">,</span> <span class="s">&#34;/data/local/tmp/myServer&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">addr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;bind&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;bind s = %d ok</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//监听
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">listen</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SOMAXCONN</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;listen&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;listen s = %d ok</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//接受连接
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">socklen_t</span> <span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="n">addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">cs</span> <span class="o">=</span> <span class="n">accept</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">cs</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;accept&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;accept cs = %d ip:%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">addr</span><span class="p">.</span><span class="n">sun_path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">260</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">bytes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">bytes</span> <span class="o">=</span> <span class="n">recv</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">bytes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;bytes:%d buf:%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">close</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;close Socket</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>客户端:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;jni.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/in.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/un.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//初始化Socket
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;socket&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;socket s = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//绑定 可以不绑定 绑定是为了让服务器知道是谁连接的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sockaddr_un</span> <span class="n">clientAddr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//协议要用AF_UNIX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">clientAddr</span><span class="p">.</span><span class="n">sun_family</span> <span class="o">=</span> <span class="n">AF_UNIX</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//用文件来代替IP地址 +Pid 防止文件冲突
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sprintf</span><span class="p">(</span><span class="n">clientAddr</span><span class="p">.</span><span class="n">sun_path</span><span class="p">,</span> <span class="s">&#34;/data/local/tmp/myClient_%d&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">sockaddr</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">clientAddr</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">clientAddr</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;bind&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sockaddr_un</span> <span class="n">serverAddr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//协议要用AF_UNIX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">serverAddr</span><span class="p">.</span><span class="n">sun_family</span> <span class="o">=</span> <span class="n">AF_UNIX</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//用文件来代替IP地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">strcpy</span><span class="p">(</span><span class="n">serverAddr</span><span class="p">.</span><span class="n">sun_path</span><span class="p">,</span> <span class="s">&#34;/data/local/tmp/myServer&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">connect</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">serverAddr</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">serverAddr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;connect&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;connect s = %d ok</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">260</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">bytes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">bytes</span> <span class="o">=</span> <span class="n">send</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;send bytes:%d buf:%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">close</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;close Socket</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">测试的时候,填写的虚拟Socket文件可能没有权限,需要进root测试,实际apk应用的时候,可以填写apk所在的目录,这样就没有权限问题了.</div>
    </div>
  </div>
<h2 id="混合编程jni" class="heading-element"><span>混合编程JNI</span>
  <a href="#%e6%b7%b7%e5%90%88%e7%bc%96%e7%a8%8bjni" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 id="概述-1" class="heading-element"><span>概述</span>
  <a href="#%e6%a6%82%e8%bf%b0-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>Java Native Interface
Java =&gt; JNI =&gt;xxx(动态库 so)
xxx(动态库 so) =&gt; JNI =&gt;Java</p>
<p>两边互调应满足以下条件:</p>
<ul>
<li>so文件应该导出函数,在函数前加JNIEXPORT.</li>
<li>类型匹配,Java要调C++,首先类型应该匹配,在Jni.h中已定义好.</li>
<li>调用约定,在函数前加JNICALL.</li>
</ul>
<p>如果是C++,防止名称粉碎,在函数前加extern &ldquo;C&rdquo;</p>
<p>名称规范问题:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">为了防止误调so中的导出函数,应以包名_类名_函数名来命名
</span></span><span class="line"><span class="cl">可以使用javah.exe将编译好的class文件给这个exe,
</span></span><span class="line"><span class="cl">它会扫描类声明,看到native会自动创建头文件
</span></span><span class="line"><span class="cl">不过这样还是很麻烦的,AndroidStodio已集成该工具</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="java调c" class="heading-element"><span>Java调C++</span>
  <a href="#java%e8%b0%83c" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ol>
<li>在Java类中添加声明, 声明前加native关键字.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;1.png" alt="Java调C&#43;&#43;1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;1.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;1.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;1.png?size=large 2x" data-title="Java调C&#43;&#43;1" style="--width: 690px;--aspect-ratio: 690 / 644;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>Alt + Enter,创建Jni方法.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;2.png" alt="Java调C&#43;&#43;2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;2.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;2.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;2.png?size=large 2x" data-title="Java调C&#43;&#43;2" style="--width: 888px;--aspect-ratio: 888 / 204;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;3.png" alt="Java调C&#43;&#43;3" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;3.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;3.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/Java%E8%B0%83C&#43;&#43;3.png?size=large 2x" data-title="Java调C&#43;&#43;3" style="--width: 936px;--aspect-ratio: 936 / 262;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="java反射" class="heading-element"><span>Java反射</span>
  <a href="#java%e5%8f%8d%e5%b0%84" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//拿目标对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//①
</span></span></span><span class="line"><span class="cl"><span class="c1">// Class cls = MainActivity.class;
</span></span></span><span class="line"><span class="cl"><span class="c1">//② 本身有对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//Class cls = this.getClass();
</span></span></span><span class="line"><span class="cl"><span class="c1">//③ 常用, 通过类名拿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Class</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">Class</span><span class="p">.</span><span class="n">forName</span><span class="p">(</span><span class="s">&#34;org.example.luojni.MainActivity&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//new 对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//不带构造new对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="n">newInstance</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//带构造new对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Constructor</span> <span class="n">constructor</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="n">getConstructor</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//传构造参数即可
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">obj</span> <span class="o">=</span> <span class="n">constructor</span><span class="p">.</span><span class="n">newInstance</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//调方法 传参数是为了防止有歧义,因为函数可以重载
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//①拿方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="n">getMethod</span><span class="p">(</span><span class="s">&#34;MyAdd&#34;</span><span class="p">,</span> <span class="kt">int</span><span class="p">.</span><span class="k">class</span><span class="err">, </span><span class="nc">int</span><span class="p">.</span><span class="k">class</span><span class="err">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//②拿方法 修改方法的访问权限 当方法为private时 第①种方式会拿不到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">method</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="n">getDeclaredMethod</span><span class="p">(</span><span class="s">&#34;MyAdd&#34;</span><span class="p">,</span> <span class="kt">int</span><span class="p">.</span><span class="k">class</span><span class="err">, </span><span class="nc">int</span><span class="p">.</span><span class="k">class</span><span class="err">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//修改方法的访问权限
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">method</span><span class="p">.</span><span class="n">setAccessible</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//为了统一 返回值为Object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//如果为静态方法 第一个参数给null就可以了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Object</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">method</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//若返回值为整型 就转为整型的包装类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">nResult</span> <span class="o">=</span> <span class="p">((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">ret</span><span class="p">).</span><span class="n">intValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//反射字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//①拿字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Field</span> <span class="n">field</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="n">getField</span><span class="p">(</span><span class="s">&#34;mData&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//②拿字段 修改字段的访问权限 当字段为private时 第①种方式会拿不到
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">field</span> <span class="o">=</span> <span class="n">cls</span><span class="p">.</span><span class="n">getDeclaredField</span><span class="p">(</span><span class="s">&#34;mData&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//修改字段的访问权限
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">field</span><span class="p">.</span><span class="n">setAccessible</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//修改字段值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">field</span><span class="p">.</span><span class="n">setInt</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//获取字段值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">nResult</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ClassNotFoundException</span> <span class="o">|</span> <span class="n">NoSuchMethodException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IllegalAccessException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InvocationTargetException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">NoSuchFieldException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InstantiationException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Java反射的强大之处在于可以修改方法和字段的访问权限.</p>
<h3 id="c调java" class="heading-element"><span>C++调Java</span>
  <a href="#c%e8%b0%83java" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>C++操作Java中的字符串以及数组:</p>
<ol>
<li>Java中声明函数,以及使用.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E6%93%8D%E4%BD%9CJava%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A5%E5%8F%8A%E6%95%B0%E7%BB%841.png" alt="C&#43;&#43;操作Java中的字符串以及数组1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E6%93%8D%E4%BD%9CJava%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A5%E5%8F%8A%E6%95%B0%E7%BB%841.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E6%93%8D%E4%BD%9CJava%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A5%E5%8F%8A%E6%95%B0%E7%BB%841.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E6%93%8D%E4%BD%9CJava%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A5%E5%8F%8A%E6%95%B0%E7%BB%841.png?size=large 2x" data-title="C&#43;&#43;操作Java中的字符串以及数组1" style="--width: 724px;--aspect-ratio: 724 / 65;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E6%93%8D%E4%BD%9CJava%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A5%E5%8F%8A%E6%95%B0%E7%BB%842.png" alt="C&#43;&#43;操作Java中的字符串以及数组2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E6%93%8D%E4%BD%9CJava%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A5%E5%8F%8A%E6%95%B0%E7%BB%842.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E6%93%8D%E4%BD%9CJava%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A5%E5%8F%8A%E6%95%B0%E7%BB%842.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E6%93%8D%E4%BD%9CJava%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A5%E5%8F%8A%E6%95%B0%E7%BB%842.png?size=large 2x" data-title="C&#43;&#43;操作Java中的字符串以及数组2" style="--width: 859px;--aspect-ratio: 859 / 351;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>C++中操作.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="k">extern</span> <span class="s">&#34;C&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">JNIEXPORT</span> <span class="n">jstring</span> <span class="n">JNICALL</span>
</span></span><span class="line"><span class="cl"><span class="n">Java_org_example_luojni_MainActivity_fun1</span><span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                          <span class="n">jobject</span> <span class="n">thiz</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                          <span class="n">jstring</span> <span class="n">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                          <span class="n">jbyteArray</span> <span class="n">ary</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//操作Java中的字符串
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">nLen</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetStringLength</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//传false 说明不拷贝缓冲区,跟Java中用的是同一个缓冲区
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">jboolean</span> <span class="n">flag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">psz</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetStringUTFChars</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGD</span><span class="p">(</span><span class="s">&#34;len = %d str = %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">nLen</span><span class="p">,</span> <span class="n">psz</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//操作Java中的数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">int</span> <span class="n">nCount</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">(</span><span class="n">ary</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">   <span class="n">jbyte</span> <span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetByteArrayElements</span><span class="p">(</span><span class="n">ary</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nCount</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">LOGD</span><span class="p">(</span><span class="s">&#34;%d &#34;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">//返回String
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span>  <span class="n">env</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="s">&#34;Hello Ret&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>C++反射调Java:</p>
<ol>
<li>写一个Java类.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java1.png" alt="C&#43;&#43;反射调Java1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java1.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java1.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java1.png?size=large 2x" data-title="C&#43;&#43;反射调Java1" style="--width: 738px;--aspect-ratio: 738 / 753;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>在Java中声明native方法并调用.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java2.png" alt="C&#43;&#43;反射调Java2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java2.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java2.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java2.png?size=large 2x" data-title="C&#43;&#43;反射调Java2" style="--width: 783px;--aspect-ratio: 783 / 150;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java3.png" alt="C&#43;&#43;反射调Java3" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java3.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java3.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/images/C&#43;&#43;%E5%8F%8D%E5%B0%84%E8%B0%83Java3.png?size=large 2x" data-title="C&#43;&#43;反射调Java3" style="--width: 777px;--aspect-ratio: 777 / 351;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="3">
<li>在C++中反射调Java.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//参数信息描述
</span></span></span><span class="line"><span class="cl"><span class="c1">//I(int) F(float) D(double) J(long) Z(bool) C(char) S(short) Ljava/lang/String(String)
</span></span></span><span class="line"><span class="cl"><span class="c1">//一维数组 [i(int[])
</span></span></span><span class="line"><span class="cl"><span class="c1">//二维数组 [[i(int[][])
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="s">&#34;C&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span>
</span></span><span class="line"><span class="cl"><span class="n">Java_org_example_luojni_MainActivity_fun2</span><span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">thiz</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//反射
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//拿Java类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">jclass</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="s">&#34;org/example/luojni/MyClass&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//new对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//传&#34;&lt;init&gt;&#34; 就是拿构造
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">jmethodID</span> <span class="n">construct</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#34;&lt;init&gt;&#34;</span><span class="p">,</span> <span class="s">&#34;()V&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//构造若是有参数就传参, 这个函数是不定参的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">jobject</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">NewObject</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">construct</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//调方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//非静态方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//()V 括号内写参数 后面写返回值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">jmethodID</span> <span class="n">fun1</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#34;fun1&#34;</span><span class="p">,</span> <span class="s">&#34;()V&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">env</span><span class="o">-&gt;</span><span class="n">CallVoidMethod</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fun1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//静态方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">jmethodID</span> <span class="n">fun2</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetStaticMethodID</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#34;fun2&#34;</span><span class="p">,</span> <span class="s">&#34;()V&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">env</span><span class="o">-&gt;</span><span class="n">CallStaticVoidMethod</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fun2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//示例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">jmethodID</span> <span class="n">Add</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#34;Add&#34;</span><span class="p">,</span> <span class="s">&#34;(II)I&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//检查Java中的异常
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="o">-&gt;</span><span class="n">ExceptionCheck</span><span class="p">()){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//打印异常栈信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">env</span><span class="o">-&gt;</span><span class="n">ExceptionDescribe</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//清除异常信息 为了不让程序崩
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">env</span><span class="o">-&gt;</span><span class="n">ExceptionClear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">jint</span> <span class="n">nRet</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">CallIntMethod</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//修改字段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">jfieldID</span> <span class="n">mData</span> <span class="o">=</span>  <span class="n">env</span><span class="o">-&gt;</span><span class="n">GetFieldID</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#34;mData&#34;</span><span class="p">,</span> <span class="s">&#34;I&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">env</span><span class="o">-&gt;</span><span class="n">SetIntField</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mData</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//引用计数 我们在C++中New了一个对象 Java虚拟机如何知道何时释放对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//释放字符串或数组对象 可以调env-&gt;Release...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">env</span><span class="o">-&gt;</span><span class="n">DeleteLocalRef</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>加密:</p>
<p>Java的逆向相对于C++来说比较容易,将Java中的所有代码都用C++反射来调用,然后对C++层进行加密.</p>
<div class="details admonition note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">在C++中反射调Java无视权限(public private).</div>
    </div>
  </div>
<h3 id="源代码" class="heading-element"><span>源代码</span>
  <a href="#%e6%ba%90%e4%bb%a3%e7%a0%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><a href="/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/C&#43;&#43;%E8%B0%83Java.7z" class="card-link"><span class="cl-backdrop" style="--cl-bg-url: url(/images/fixit.min.svg);"></span>
    <span class="cl-content">
      <span class="cl-text">
        <span class="cl-title">C++调Java</span>
        <span class="cl-meta">
          <svg class="cl-icon-link" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M574 665.4c-3.1-3.1-8.2-3.1-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8c-3.1-3.1-8.2-3.1-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zM832.6 191.4c-84.6-84.6-221.5-84.6-306 0L410.3 307.6c-3.1 3.1-3.1 8.2 0 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6c-3.1 3.1-3.1 8.2 0 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1z" fill="#a9a9b3"></path><path d="M610.1 372.3c-3.1-3.1-8.2-3.1-11.3 0L372.3 598.7c-3.1 3.1-3.1 8.2 0 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z" fill="#a9a9b3"></path></svg>
          <span class="cl-url">/posts/android/android%E5%9F%BA%E7%A1%80/ndk%E5%BC%80%E5%8F%91/C&#43;&#43;%E8%B0%83Java.7z</span>
        </span>
      </span><svg class="cl-shortcut-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="64" height="64"><path d="M960 512c0 249.408-203.2 448-448 448-244.778667 0-448-198.592-448-448S262.592 64 512 64s448 198.592 448 448" fill="#2196F3"></path><path d="M507.52 718.08c0-8.96-4.48-13.44-13.44-17.92-26.88-8.96-53.76-8.96-76.16-31.381333-4.48-8.96-4.48-17.92-8.96-26.88-8.96-8.96-31.36-13.44-44.8-17.92h-89.6c-13.44-4.48-22.4-22.4-31.36-35.84 0-4.48 0-13.461333-8.96-13.461334-8.96-4.458667-17.92 4.501333-26.88 0-4.48-4.458667-4.48-8.96-4.48-13.418666 0-13.461333 8.96-26.901333 17.92-35.861334 13.44-8.96 26.88 4.48 40.32 4.48 4.48 0 4.48 0 8.96 4.48 13.44 4.48 17.92 22.4 17.92 35.861334v8.96c0 4.48 4.48 4.48 8.96 4.48 4.48-22.4 4.48-44.821333 8.96-67.2 0-26.88 26.88-53.781333 49.28-62.72 8.96-4.458667 13.44 4.501333 22.4 0 26.88-8.96 94.08-35.84 80.64-71.658667-8.96-31.381333-35.84-62.698667-71.68-58.24-8.96 4.501333-13.44 8.96-22.4 13.461333-13.44 8.96-40.32 35.84-53.76 35.84-22.4-4.48-22.4-35.84-17.92-49.301333 4.48-17.92 44.8-76.138667 71.68-67.178667l17.92 17.92c8.96 4.48 22.4 4.48 35.84 4.48 4.48 0 8.96 0 13.44-4.48 4.48-4.48 4.48-4.48 4.48-8.96 0-13.44-13.44-26.901333-22.4-35.861333s-22.4-17.92-35.84-22.378667c-44.8-13.461333-116.48 4.458667-152.32 35.84-35.84 31.36-62.72 85.12-80.64 129.92-8.96 26.88-17.92 62.698667-22.4 94.08-4.48 22.4-8.96 40.32 4.48 62.698667 13.44 26.88 40.32 53.781333 67.2 71.68 17.92 13.44 53.76 13.44 71.68 35.84 13.44 17.941333 8.96 40.32 8.96 62.72 0 26.88 17.92 49.28 26.88 71.658667 4.48 13.461333 8.96 31.381333 13.44 44.821333 0 4.48 4.48 31.36 4.48 35.84 26.88 13.44 49.28 26.901333 80.64 35.861333 4.48 0 22.4-26.901333 22.4-31.381333 13.44-13.44 22.4-31.36 35.84-40.32 8.96-4.48 17.92-8.96 26.88-17.941333 8.96-8.96 13.44-26.88 17.92-40.32 4.48-8.938667 8.96-26.858667 4.48-40.298667M516.48 305.92c4.48 0 8.96-4.48 17.92-8.96 13.44-8.96 26.901333-22.4 40.32-31.36 13.461333-8.96 26.901333-22.4 35.861333-31.36 13.44-8.96 22.4-26.88 26.88-40.341333 4.48-8.96 17.941333-26.88 13.44-40.32-4.48-8.96-26.88-13.44-35.84-17.92C579.2 126.698667 547.84 122.24 512 122.24c-13.44 0-31.36 4.458667-35.84 17.92-4.48 22.4 13.44 17.92 31.36 22.4 0 0 4.48 35.84 4.48 40.32 4.48 22.421333-8.96 35.84-8.96 58.24 0 13.44 0 35.84 8.96 44.8h4.48zM892.8 619.52c4.501333-8.96 4.501333-22.4 8.96-31.36 4.501333-22.421333 4.501333-44.8 4.501333-67.2 0-44.8-4.501333-89.578667-17.92-129.92-8.96-13.44-13.461333-26.88-17.941333-40.341333-8.96-22.378667-22.4-44.8-40.32-62.698667-17.92-22.4-40.341333-85.12-80.64-67.2-13.44 4.501333-22.4 22.421333-31.36 31.381333l-26.88 40.32c-4.501333 4.48-8.96 13.44-4.501333 17.92 0 4.48 4.501333 4.48 8.96 4.48 8.96 4.501333 13.461333 4.501333 22.421333 8.96 4.48 0 8.96 4.501333 4.48 8.96 0 0 0 4.501333-4.48 4.501334-22.421333 22.4-44.8 40.32-67.2 62.698666-4.48 4.48-8.96 13.44-8.96 17.92s4.48 4.48 4.48 8.96c0 4.501333-4.48 4.501333-8.96 8.96-8.96 4.501333-17.92 8.96-22.4 13.461334-4.48 8.96 0 22.4-4.48 31.36-4.48 22.4-17.941333 40.32-26.901333 62.72-8.96 13.418667-13.418667 26.88-22.378667 40.32 0 17.92-4.501333 31.36 4.458667 44.8 22.421333 31.36 62.72 13.44 94.08 26.901333 8.96 4.458667 17.92 4.458667 22.421333 13.418667 13.418667 13.461333 13.418667 35.861333 17.92 49.301333 4.458667 17.92 8.96 35.84 17.92 53.76 4.48 22.421333 13.44 44.821333 17.92 62.72 40.341333-31.36 76.16-67.178667 103.04-112 26.88-31.424 40.341333-67.242667 53.76-103.104" fill="#CDDC39"></path></svg></span></a>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2021-10-21 00:00:00">更新于 2021-10-21&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/ndk/" class="post-tag" title="标签 - NDK">NDK</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/android/android%E5%9F%BA%E7%A1%80/android%E5%BC%80%E5%8F%91/" class="post-nav-item" rel="prev" title="Android开发"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>Android开发</a>
      <a href="/posts/android/android%E5%9F%BA%E7%A1%80/android%E9%80%86%E5%90%91%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/android%E9%80%86%E5%90%91%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-nav-item" rel="next" title="Android逆向常用命令">Android逆向常用命令<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2020 - 2024</span><span class="author" itemprop="copyrightHolder">
              <a href="/">夏洛魂</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">该网站在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="preload" href="/lib/katex/katex.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/katex/katex.min.css"></noscript><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":150},"comment":{"enable":false},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":50,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"version":"v0.3.8-RC"};</script><script src="/js/theme.min.js" defer></script><script src="/js/custom.min.js" defer></script></body>
</html>
