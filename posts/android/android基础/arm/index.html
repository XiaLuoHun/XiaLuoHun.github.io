<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Arm指令 - 夏洛魂的个人博客</title><meta name="author" content="夏洛魂">
<meta name="author-link" content="">
<meta name="description" content="基本概念 Arm处理器特点 体积小、低功耗、低成本、高性能. 支持Thumb(16位)/ARM(32位)双指令集,能很好的兼容8位/16位器件. 大" /><meta name="keywords" content='Arm' />
  <meta itemprop="name" content="Arm指令">
  <meta itemprop="description" content="基本概念 Arm处理器特点 体积小、低功耗、低成本、高性能. 支持Thumb(16位)/ARM(32位)双指令集,能很好的兼容8位/16位器件. 大">
  <meta itemprop="datePublished" content="2021-08-29T00:00:00+00:00">
  <meta itemprop="dateModified" content="2021-08-29T00:00:00+00:00">
  <meta itemprop="wordCount" content="8091">
  <meta itemprop="image" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png">
  <meta itemprop="keywords" content="Arm"><meta property="og:url" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/arm/">
  <meta property="og:site_name" content="夏洛魂的个人博客">
  <meta property="og:title" content="Arm指令">
  <meta property="og:description" content="基本概念 Arm处理器特点 体积小、低功耗、低成本、高性能. 支持Thumb(16位)/ARM(32位)双指令集,能很好的兼容8位/16位器件. 大">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-08-29T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-08-29T00:00:00+00:00">
    <meta property="article:tag" content="Arm">
    <meta property="og:image" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png">
  <meta name="twitter:title" content="Arm指令">
  <meta name="twitter:description" content="基本概念 Arm处理器特点 体积小、低功耗、低成本、高性能. 支持Thumb(16位)/ARM(32位)双指令集,能很好的兼容8位/16位器件. 大">
<meta name="application-name" content="夏洛魂">
<meta name="apple-mobile-web-app-title" content="夏洛魂"><meta name="theme-color" data-light="#ffffff" data-dark="#ffffff" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://XiaLuoHun.github.io/posts/android/android%E5%9F%BA%E7%A1%80/arm/" /><link rel="prev" href="https://XiaLuoHun.github.io/posts/ida/idapython%E4%BD%BF%E7%94%A8/" /><link rel="next" href="https://XiaLuoHun.github.io/posts/%E5%B9%B3%E5%8F%B0api/github/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Arm指令",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/XiaLuoHun.github.io\/posts\/android\/android%E5%9F%BA%E7%A1%80\/arm\/"
    },"image": [{
              "@type": "ImageObject",
              "url": "https:\/\/XiaLuoHun.github.io\/posts\/android\/android%E5%9F%BA%E7%A1%80\/arm\/images\/Arm\/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png",
              "width":  1650 ,
              "height":  709 
            }],"genre": "posts","keywords": "Arm","wordcount":  8091 ,
    "url": "https:\/\/XiaLuoHun.github.io\/posts\/android\/android%E5%9F%BA%E7%A1%80\/arm\/","datePublished": "2021-08-29T00:00:00+00:00","dateModified": "2021-08-29T00:00:00+00:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "夏洛魂"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="夏洛魂的个人博客"><span class="header-title-text">夏洛魂</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/posts/"
                
                
              >文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/tags/"
                
                
              >标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/categories/"
                
                
              >分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/excalidraw/"
                
                
              >在线绘图</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/about/"
                
                
              >关于作者</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="夏洛魂的个人博客"><span class="header-title-text">夏洛魂</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/posts/"
                  
                  
                >文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/tags/"
                  
                  
                >标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/categories/"
                  
                  
                >分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/excalidraw/"
                  
                  
                >在线绘图</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/about/"
                  
                  
                >关于作者</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>Arm指令</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><img loading="lazy" src="/images/Luo.png" alt="夏洛魂" data-title="夏洛魂" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;夏洛魂</span></span><span class="post-included-in">&nbsp;收录于 <a href="/categories/android%E5%9F%BA%E7%A1%80/" class="post-category" title="分类 - Android基础"><i class="fa-regular fa-folder fa-fw" aria-hidden="true"></i> Android基础</a></span></div><div class="post-meta-line"><span title="发布于 2021-08-29 00:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2021-08-29">2021-08-29</time></span>&nbsp;<span title="8091 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 8100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 17 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#基本概念">基本概念</a>
              <ul>
                <li><a href="#arm处理器特点">Arm处理器特点</a></li>
                <li><a href="#数据和指令类型">数据和指令类型</a></li>
                <li><a href="#工作状态">工作状态</a></li>
                <li><a href="#寄存器">寄存器</a></li>
              </ul>
            </li>
            <li><a href="#编译环境">编译环境</a>
              <ul>
                <li><a href="#手工编译">手工编译</a></li>
                <li><a href="#cmake编译">Cmake编译</a></li>
                <li><a href="#ndk-build编译">ndk-build编译</a></li>
              </ul>
            </li>
            <li><a href="#arm调试">Arm调试</a></li>
            <li><a href="#寻址方式">寻址方式</a>
              <ul>
                <li><a href="#寄存器寻址">寄存器寻址</a></li>
                <li><a href="#立即寻址">立即寻址</a></li>
                <li><a href="#寄存器移位寻址">寄存器移位寻址</a></li>
                <li><a href="#寄存器间接寻址">寄存器间接寻址</a></li>
                <li><a href="#基址寻址">基址寻址</a></li>
                <li><a href="#多寄存器寻址">多寄存器寻址</a></li>
                <li><a href="#堆栈寻址">堆栈寻址</a></li>
                <li><a href="#块拷贝寻址">块拷贝寻址</a></li>
                <li><a href="#相对寻址">相对寻址</a></li>
              </ul>
            </li>
            <li><a href="#arm指令格式">Arm指令格式</a></li>
            <li><a href="#存储器访问指令">存储器访问指令</a>
              <ul>
                <li><a href="#单寄存器">单寄存器</a></li>
                <li><a href="#多寄存器">多寄存器</a></li>
                <li><a href="#寄存器和存储器交换">寄存器和存储器交换</a></li>
              </ul>
            </li>
            <li><a href="#数据处理指令">数据处理指令</a>
              <ul>
                <li><a href="#指令编码">指令编码</a></li>
                <li><a href="#操作码表">操作码表</a></li>
                <li><a href="#数据传送指令">数据传送指令</a></li>
                <li><a href="#算术逻辑运算指令">算术逻辑运算指令</a></li>
                <li><a href="#逻辑指令">逻辑指令</a></li>
                <li><a href="#比较指令">比较指令</a></li>
                <li><a href="#乘法指令">乘法指令</a></li>
                <li><a href="#除法指令">除法指令</a></li>
              </ul>
            </li>
            <li><a href="#跳转指令">跳转指令</a>
              <ul>
                <li><a href="#概述">概述</a></li>
                <li><a href="#条件码">条件码</a></li>
                <li><a href="#指令编码-1">指令编码</a></li>
                <li><a href="#ida静态分析切换指令集">IDA静态分析,切换指令集</a></li>
                <li><a href="#指令示例">指令示例</a></li>
              </ul>
            </li>
            <li><a href="#其他指令">其他指令</a>
              <ul>
                <li><a href="#中断指令">中断指令</a>
                  <ul>
                    <li><a href="#系统调用_exit">系统调用_exit</a></li>
                    <li><a href="#喜讯">喜讯</a></li>
                    <li><a href="#arm调用_exit示例">Arm调用_exit示例</a></li>
                    <li><a href="#ndk编程调用_exit示例">NDK编程调用_exit示例</a></li>
                    <li><a href="#标志寄存器">标志寄存器</a></li>
                  </ul>
                </li>
                <li><a href="#伪指令">伪指令</a>
                  <ul>
                    <li><a href="#解决偏移问题">解决偏移问题</a></li>
                    <li><a href="#解决给立即数问题">解决给立即数问题</a></li>
                    <li><a href="#nop">NOP</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#浮点指令">浮点指令</a></li>
            <li><a href="#arm指令参考">Arm指令参考</a></li>
            <li><a href="#arm应用">Arm应用</a>
              <ul>
                <li><a href="#内联汇编">内联汇编</a></li>
                <li><a href="#裸函数">裸函数</a></li>
                <li><a href="#混合编译">混合编译</a></li>
                <li><a href="#调试">调试</a></li>
                <li><a href="#代码注入">代码注入</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h3 id="基本概念" class="heading-element"><span>基本概念</span>
  <a href="#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="arm处理器特点" class="heading-element"><span>Arm处理器特点</span>
  <a href="#arm%e5%a4%84%e7%90%86%e5%99%a8%e7%89%b9%e7%82%b9" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ol>
<li>体积小、低功耗、低成本、高性能.</li>
<li>支持Thumb(16位)/ARM(32位)双指令集,能很好的兼容8位/16位器件.</li>
<li>大量使用寄存器,指令执行速度更快.</li>
<li>大多数数据操作都在寄存器中完成.</li>
<li>寻址方式灵活简单,执行效率高.</li>
<li>指令长度固定.</li>
</ol>
<h4 id="数据和指令类型" class="heading-element"><span>数据和指令类型</span>
  <a href="#%e6%95%b0%e6%8d%ae%e5%92%8c%e6%8c%87%e4%bb%a4%e7%b1%bb%e5%9e%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>Arm约定数据长度如下:</p>
<table>
<thead>
<tr>
<th>byte(字节)</th>
<th>8bits</th>
</tr>
</thead>
<tbody>
<tr>
<td>Halfword(半字)</td>
<td>16bits</td>
</tr>
<tr>
<td>Word(字)</td>
<td>32bits</td>
</tr>
</tbody>
</table>
<p>Arm指令集:</p>
<table>
<thead>
<tr>
<th>指令集</th>
<th>指令长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>thumb</td>
<td>2字节(16位)</td>
</tr>
<tr>
<td>arm</td>
<td>4字节(32位)</td>
</tr>
<tr>
<td>thumb2(常用)</td>
<td>2字节和4字节混合</td>
</tr>
</tbody>
</table>
<h4 id="工作状态" class="heading-element"><span>工作状态</span>
  <a href="#%e5%b7%a5%e4%bd%9c%e7%8a%b6%e6%80%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ol>
<li><strong>ARM状态</strong>:32位,ARM状态执行字对齐的32位ARM指令.</li>
<li><strong>Thumb状态</strong>:16位,执行半字对齐的16位指令.</li>
</ol>
<p>状态的切换,看标志寄存器的T位.</p>
<h4 id="寄存器" class="heading-element"><span>寄存器</span>
  <a href="#%e5%af%84%e5%ad%98%e5%99%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>ARM 处理器一般共有37个寄存器,其中包括:</p>
<ol>
<li>31个通用寄存器,包括 PC(程序计数器)在内,都是32位的寄存器</li>
<li>6个状态寄存器,都是32位的寄存器</li>
</ol>
<p>3环可操作的寄存器有17个,R0-R15 CPSR(标志寄存器),除此之外 还有浮点寄存器</p>
<p>重要寄存器:</p>
<ul>
<li><strong>R13(SP)</strong>:栈指针.</li>
<li><strong>R14(LR)</strong>:链接寄存器,保存返回值.Call指令,将Call的下条指令地址给R14,但是当Call中嵌套调Call时,还是会将LR寄存器压栈保存.</li>
<li><strong>R15(PC)</strong>:程序计数器,等价于x86的EIP.</li>
</ul>
<p>历史遗留别名寄存器:</p>
<ul>
<li><strong>R11(FP)</strong></li>
<li><strong>R12(IP)</strong></li>
</ul>
<p>标志寄存器:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8.png" alt="标志寄存器" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8.png?size=large 2x" data-title="标志寄存器" style="--width: 1678px;--aspect-ratio: 1678 / 847;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="编译环境" class="heading-element"><span>编译环境</span>
  <a href="#%e7%bc%96%e8%af%91%e7%8e%af%e5%a2%83" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="手工编译" class="heading-element"><span>手工编译</span>
  <a href="#%e6%89%8b%e5%b7%a5%e7%bc%96%e8%af%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>本地程序生成过程:</p>
<p><strong>预处理</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="err">gcc</span> <span class="err">-E</span> <span class="err">hello.c</span> <span class="err">-o</span> <span class="err">hello.i</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>C到汇编</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="err">gcc</span> <span class="err">-S</span> <span class="err">-mthumb</span> <span class="err">hello.i</span> <span class="err">-o</span> <span class="err">hello.s</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>汇编到Arm</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="err">gcc</span> <span class="err">-c</span> <span class="err">hello.s</span> <span class="err">-o</span> <span class="err">hello.o</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>链接</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="err">gcc</span> <span class="err">hello.o</span> <span class="err">-o</span> <span class="err">hello</span></span></span></code></pre></td></tr></table>
</div>
</div><p>汇编编译器:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%B1%87%E7%BC%96%E7%BC%96%E8%AF%91%E5%99%A8.png" alt="汇编编译器" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%B1%87%E7%BC%96%E7%BC%96%E8%AF%91%E5%99%A8.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%B1%87%E7%BC%96%E7%BC%96%E8%AF%91%E5%99%A8.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%B1%87%E7%BC%96%E7%BC%96%E8%AF%91%E5%99%A8.png?size=large 2x" data-title="汇编编译器" style="--width: 1394px;--aspect-ratio: 1394 / 735;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>编译的时候用Clang 加命令行参数-S,就可以调到上述的汇编编译器.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Clang.png" alt="Clang" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Clang.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Clang.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Clang.png?size=large 2x" data-title="Clang" style="--width: 1393px;--aspect-ratio: 1393 / 921;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>示例:</p>
<p><strong>hello.c</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello Arm</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Markfile脚本</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">NDK_PATH</span> <span class="o">:=</span>D:/AndroidSDK/ndk/21.4.7075529/toolchains/llvm/prebuilt/windows-x86_64/bin
</span></span><span class="line"><span class="cl"><span class="nv">BUILD_CLANG</span> <span class="o">:=</span><span class="k">$(</span>NDK_PATH<span class="k">)</span>/armv7a-linux-androideabi16-clang
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">all</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#预处理</span>
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> -E -o Hello.i Hello.c
</span></span><span class="line"><span class="cl">    <span class="c1">#C到汇编 -m是指cpu -marm 编译arm -mthumb 编译thumb</span>
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> -S -mthumb -o Hello.s Hello.i
</span></span><span class="line"><span class="cl">    <span class="c1">#编译</span>
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> -c -o Hello.o Hello.s
</span></span><span class="line"><span class="cl">    <span class="c1">#链接</span>
</span></span><span class="line"><span class="cl">	<span class="k">$(</span>BUILD_CLANG<span class="k">)</span> -o Hello Hello.o
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nf">install</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	adb push Hello /data/local/tmp
</span></span><span class="line"><span class="cl">	adb shell chmod a+x /data/local/tmp/Hello
</span></span><span class="line"><span class="cl">	adb shell /data/local/tmp/Hello
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/Arm_%E6%89%8B%E5%B7%A5%E7%BC%96%E8%AF%91.7z">Arm_手工编译.7z</a></p>
<h4 id="cmake编译" class="heading-element"><span>Cmake编译</span>
  <a href="#cmake%e7%bc%96%e8%af%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>不支持Arm编译,仅支持x86汇编.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Cmake%E4%B8%8D%E6%94%AF%E6%8C%81Arm%E7%BC%96%E8%AF%91.png" alt="Cmake不支持Arm编译" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Cmake%E4%B8%8D%E6%94%AF%E6%8C%81Arm%E7%BC%96%E8%AF%91.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Cmake%E4%B8%8D%E6%94%AF%E6%8C%81Arm%E7%BC%96%E8%AF%91.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Cmake%E4%B8%8D%E6%94%AF%E6%8C%81Arm%E7%BC%96%E8%AF%91.png?size=large 2x" data-title="Cmake不支持Arm编译" style="--width: 1975px;--aspect-ratio: 1975 / 993;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="ndk-build编译" class="heading-element"><span>ndk-build编译</span>
  <a href="#ndk-build%e7%bc%96%e8%af%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ol>
<li>新建一个<strong>jni</strong>或<strong>cpp文件夹</strong>,将.<strong>s文件</strong>放进去.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">	<span class="na">.text</span>
</span></span><span class="line"><span class="cl">	<span class="na">.globl</span>	<span class="no">main</span>
</span></span><span class="line"><span class="cl">	<span class="na">.p2align</span>	<span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="na">.type</span>	<span class="no">main</span><span class="p">,</span><span class="nv">%function</span>
</span></span><span class="line"><span class="cl">	<span class="na">.code</span>	<span class="mi">32</span>  
</span></span><span class="line"><span class="cl"><span class="no">main</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="nf">push</span> <span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="err">@</span><span class="nf">ToDo</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">	<span class="na">.p2align</span>	<span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nl">main_end:</span>
</span></span><span class="line"><span class="cl">	<span class="na">.size</span>	<span class="no">main</span><span class="p">,</span> <span class="no">main_end-main</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>新建一个<strong>Android.mk</strong>文件.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">LOCAL_PATH</span> <span class="o">:=</span> <span class="k">$(</span>call my-dir<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">include</span> <span class="k">$(</span><span class="nv">CLEAR_VARS</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#存储要构建的模块的名称
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">LOCAL_MODULE</span> <span class="o">:=</span> LuoHello
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#列举源文件
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">LOCAL_SRC_FILES</span> <span class="o">:=</span> Hello.s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#包含编译脚本
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="err">include</span> <span class="k">$(</span><span class="nv">BUILD_EXECUTABLE</span><span class="k">)</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>新建一个<strong>Application.mk</strong>文件.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">APP_PLATFORM</span> <span class="o">:=</span> android-16
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">APP_ABI</span> <span class="o">:=</span> armeabi-v7a
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>命令行输入<strong>ndk-build</strong>进行编译.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ndk_build%E7%BC%96%E8%AF%91.png" alt="ndk_build编译" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ndk_build%E7%BC%96%E8%AF%91.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ndk_build%E7%BC%96%E8%AF%91.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ndk_build%E7%BC%96%E8%AF%91.png?size=large 2x" data-title="ndk_build编译" style="--width: 1120px;--aspect-ratio: 1120 / 472;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/Arm_ndk_Build%E7%BC%96%E8%AF%91.7z">Arm_ndk_Build编译.7z</a></p>
<h3 id="arm调试" class="heading-element"><span>Arm调试</span>
  <a href="#arm%e8%b0%83%e8%af%95" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><strong>准备一个Arm虚拟机或者真机</strong></p>
<p>概述:</p>
<p>将IDA中的dbgsrv程序放到Android系统中并运行起来,然后和IDA交互完成调试.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDAServer.png" alt="IDAServer" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDAServer.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDAServer.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDAServer.png?size=large 2x" data-title="IDAServer" style="--width: 1133px;--aspect-ratio: 1133 / 482;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><strong>将ndk程序(LuoHello)以及IDA dbgsrv放到Android系统中</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">INSTALLAPP_PATH</span> <span class="o">:=</span>C:/Users/XiaLuoHun/Desktop/Build/libs/armeabi-v7a
</span></span><span class="line"><span class="cl"><span class="nv">INSTALLAPP_NAME</span> <span class="o">:=</span>LuoHello
</span></span><span class="line"><span class="cl"><span class="nv">INSTALLAPP</span> <span class="o">:=</span><span class="k">$(</span>INSTALLAPP_PATH<span class="k">)</span>/<span class="k">$(</span>INSTALLAPP_NAME<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">REMOTEPATH</span> <span class="o">:=</span>/data/local/tmp
</span></span><span class="line"><span class="cl"><span class="nv">REMOTEAPP</span> <span class="o">:=</span><span class="k">$(</span>REMOTEPATH<span class="k">)</span>/<span class="k">$(</span>INSTALLAPP_NAME<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">IDADBGSERVER</span> <span class="o">:=</span>D:<span class="se">\L</span>uoHackTools<span class="se">\T</span>ools<span class="se">\D</span>isassemblers<span class="se">\I</span>DA_Pro_v7.5<span class="se">\d</span>bgsrv
</span></span><span class="line"><span class="cl"><span class="nv">IDADBGSERVER_NAME</span> <span class="o">:=</span> android_server
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">install</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	adb push <span class="k">$(</span>INSTALLAPP<span class="k">)</span> <span class="k">$(</span>REMOTEPATH<span class="k">)</span>
</span></span><span class="line"><span class="cl">	adb shell chmod a+x <span class="k">$(</span>REMOTEAPP<span class="k">)</span>
</span></span><span class="line"><span class="cl">	adb shell <span class="k">$(</span>REMOTEAPP<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">debug</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	adb forward tcp:23946 tcp:23946
</span></span><span class="line"><span class="cl">	adb push <span class="s2">&#34;</span><span class="k">$(</span>IDADBGSERVER<span class="k">)</span><span class="s2">/</span><span class="k">$(</span>IDADBGSERVER_NAME<span class="k">)</span><span class="s2">&#34;</span> <span class="k">$(</span>REMOTEPATH<span class="k">)</span>
</span></span><span class="line"><span class="cl">	adb shell chmod a+x <span class="k">$(</span>REMOTEPATH<span class="k">)</span>/<span class="k">$(</span>IDADBGSERVER_NAME<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#IDA远程启动某个ndk程序调试 下面的方式是可以的,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#但如果是附加调试 遍历进程时,会没有权限 要以Root权限运行才可以</span>
</span></span><span class="line"><span class="cl">	adb shell <span class="k">$(</span>REMOTEPATH<span class="k">)</span>/<span class="k">$(</span>IDADBGSERVER_NAME<span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/Arm_IDA%E8%B0%83%E8%AF%95%E7%A4%BA%E4%BE%8B.7z">Arm_IDA调试示例.7z</a></p>
<p>IDA调试设置:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE1.png" alt="IDA调试设置1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE1.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE1.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE1.png?size=large 2x" data-title="IDA调试设置1" style="--width: 492px;--aspect-ratio: 492 / 921;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE2.png" alt="IDA调试设置2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE2.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE2.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%B0%83%E8%AF%95%E8%AE%BE%E7%BD%AE2.png?size=large 2x" data-title="IDA调试设置2" style="--width: 662px;--aspect-ratio: 662 / 612;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>远程启动:</p>
<p><strong>保证上述IDA dbgsrv运行起来</strong></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDADebug.png" alt="IDADebug" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDADebug.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDADebug.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDADebug.png?size=large 2x" data-title="IDADebug" style="--width: 1410px;--aspect-ratio: 1410 / 607;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><strong>IDA远程启动</strong></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%BF%9C%E7%A8%8B%E5%90%AF%E5%8A%A81.png" alt="IDA远程启动1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%BF%9C%E7%A8%8B%E5%90%AF%E5%8A%A81.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%BF%9C%E7%A8%8B%E5%90%AF%E5%8A%A81.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%BF%9C%E7%A8%8B%E5%90%AF%E5%8A%A81.png?size=large 2x" data-title="IDA远程启动1" style="--width: 1011px;--aspect-ratio: 1011 / 488;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%BF%9C%E7%A8%8B%E5%90%AF%E5%8A%A82.png" alt="IDA远程启动2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%BF%9C%E7%A8%8B%E5%90%AF%E5%8A%A82.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%BF%9C%E7%A8%8B%E5%90%AF%E5%8A%A82.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E8%BF%9C%E7%A8%8B%E5%90%AF%E5%8A%A82.png?size=large 2x" data-title="IDA远程启动2" style="--width: 780px;--aspect-ratio: 780 / 446;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><strong>Main函数</strong></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/NdkMain%E5%87%BD%E6%95%B0.png" alt="Ndk Main函数" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/NdkMain%E5%87%BD%E6%95%B0.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/NdkMain%E5%87%BD%E6%95%B0.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/NdkMain%E5%87%BD%E6%95%B0.png?size=large 2x" data-title="Ndk Main函数" style="--width: 1734px;--aspect-ratio: 1734 / 1007;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>调试推荐:</p>
<ol>
<li>定位Main函数.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%901.png" alt="调试推荐1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%901.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%901.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%901.png?size=large 2x" data-title="调试推荐1" style="--width: 1734px;--aspect-ratio: 1734 / 1011;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="2">
<li>找到Main函数后 F2下个断.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%902.png" alt="调试推荐2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%902.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%902.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%902.png?size=large 2x" data-title="调试推荐2" style="--width: 1535px;--aspect-ratio: 1535 / 1005;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<ol start="3">
<li>F9选择调试器,配置好参数就可以调试了.</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%903.png" alt="调试推荐3" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%903.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%903.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%903.png?size=large 2x" data-title="调试推荐3" style="--width: 483px;--aspect-ratio: 483 / 405;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%904.png" alt="调试推荐4" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%904.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%904.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B0%83%E8%AF%95%E6%8E%A8%E8%8D%904.png?size=large 2x" data-title="调试推荐4" style="--width: 811px;--aspect-ratio: 811 / 456;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="寻址方式" class="heading-element"><span>寻址方式</span>
  <a href="#%e5%af%bb%e5%9d%80%e6%96%b9%e5%bc%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="寄存器寻址" class="heading-element"><span>寄存器寻址</span>
  <a href="#%e5%af%84%e5%ad%98%e5%99%a8%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl"><span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r2</span>
</span></span><span class="line"><span class="cl"><span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>      <span class="err">@等价于</span><span class="no">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="立即寻址" class="heading-element"><span>立即寻址</span>
  <a href="#%e7%ab%8b%e5%8d%b3%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">mov</span>  <span class="no">r0</span><span class="p">,</span> <span class="c1">#1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">mov</span>  <span class="no">r0</span><span class="p">,</span> <span class="c1">#0x5678
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">movt</span> <span class="no">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">0x1234</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="寄存器移位寻址" class="heading-element"><span>寄存器移位寻址</span>
  <a href="#%e5%af%84%e5%ad%98%e5%99%a8%e7%a7%bb%e4%bd%8d%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">lsl</span> <span class="c1">#2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">lsl</span> <span class="c1">#2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">lsl</span> <span class="no">r2</span>
</span></span><span class="line"><span class="cl"><span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">lsr</span> <span class="no">r2</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="寄存器间接寻址" class="heading-element"><span>寄存器间接寻址</span>
  <a href="#%e5%af%84%e5%ad%98%e5%99%a8%e9%97%b4%e6%8e%a5%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="基址寻址" class="heading-element"><span>基址寻址</span>
  <a href="#%e5%9f%ba%e5%9d%80%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">,</span> <span class="c1">#4] @前基址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">],</span> <span class="c1">#4 @后基址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">,</span> <span class="no">r0</span><span class="p">]</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="多寄存器寻址" class="heading-element"><span>多寄存器寻址</span>
  <a href="#%e5%a4%9a%e5%af%84%e5%ad%98%e5%99%a8%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">stmfd</span> <span class="no">sp</span><span class="p">!,</span> <span class="err">{</span><span class="no">r0-r5</span><span class="p">,</span> <span class="no">r8</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span> <span class="err">@</span><span class="p">!</span><span class="err">回写</span> <span class="err">会自动修改</span><span class="no">sp的值</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmfd</span> <span class="no">sp</span><span class="p">!,</span> <span class="err">{</span><span class="no">r0-r5</span><span class="p">,</span> <span class="no">r8</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="堆栈寻址" class="heading-element"><span>堆栈寻址</span>
  <a href="#%e5%a0%86%e6%a0%88%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>概述:</p>
<p><strong>堆栈方向</strong></p>
<ol>
<li>向上生长:向高地址方向生长, 称为递增堆栈</li>
<li>乡下生长:向低地址方向生长, 称为递减堆栈</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%A0%86%E6%A0%88%E6%96%B9%E5%90%91.png" alt="堆栈方向" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%A0%86%E6%A0%88%E6%96%B9%E5%90%91.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%A0%86%E6%A0%88%E6%96%B9%E5%90%91.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%A0%86%E6%A0%88%E6%96%B9%E5%90%91.png?size=large 2x" data-title="堆栈方向" style="--width: 1615px;--aspect-ratio: 1615 / 914;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><strong>满和空堆栈</strong></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%BB%A1%E5%92%8C%E7%A9%BA%E5%A0%86%E6%A0%88.png" alt="满和空堆栈" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%BB%A1%E5%92%8C%E7%A9%BA%E5%A0%86%E6%A0%88.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%BB%A1%E5%92%8C%E7%A9%BA%E5%A0%86%E6%A0%88.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%BB%A1%E5%92%8C%E7%A9%BA%E5%A0%86%E6%A0%88.png?size=large 2x" data-title="满和空堆栈" style="--width: 1655px;--aspect-ratio: 1655 / 803;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><strong>堆栈方式</strong></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%A0%86%E6%A0%88%E6%96%B9%E5%BC%8F.png" alt="堆栈方式" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%A0%86%E6%A0%88%E6%96%B9%E5%BC%8F.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%A0%86%E6%A0%88%E6%96%B9%E5%BC%8F.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%A0%86%E6%A0%88%E6%96%B9%E5%BC%8F.png?size=large 2x" data-title="堆栈方式" style="--width: 1661px;--aspect-ratio: 1661 / 724;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">LDMFA</span> <span class="no">LDMEA</span>
</span></span><span class="line"><span class="cl"><span class="nl">F:</span><span class="err">满</span> <span class="nf">full</span>
</span></span><span class="line"><span class="cl"><span class="nl">E:</span><span class="err">空</span> <span class="nf">empty</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">STMFA</span> <span class="no">STMFD</span>
</span></span><span class="line"><span class="cl"><span class="nl">A:</span><span class="err">加</span> <span class="nf">add</span>
</span></span><span class="line"><span class="cl"><span class="nl">D:</span><span class="err">减</span> <span class="nf">decrease</span></span></span></code></pre></td></tr></table>
</div>
</div><p>示例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">stmfd</span> <span class="no">sp</span><span class="p">!,</span> <span class="err">{</span><span class="no">r0-r5</span><span class="p">,</span> <span class="no">r8</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span> <span class="err">@</span><span class="p">!</span><span class="err">回写</span> <span class="err">会自动修改</span><span class="no">sp的值</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmfd</span> <span class="no">sp</span><span class="p">!,</span> <span class="err">{</span><span class="no">r0-r5</span><span class="p">,</span> <span class="no">r8</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="块拷贝寻址" class="heading-element"><span>块拷贝寻址</span>
  <a href="#%e5%9d%97%e6%8b%b7%e8%b4%9d%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">ldmia</span> <span class="no">ldmda</span>
</span></span><span class="line"><span class="cl"><span class="nl">i:</span><span class="nf">inc</span>
</span></span><span class="line"><span class="cl"><span class="nl">d:</span><span class="nf">dec</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">ldmia</span> <span class="no">ldmib</span>
</span></span><span class="line"><span class="cl"><span class="nl">a:</span><span class="nf">after</span>
</span></span><span class="line"><span class="cl"><span class="nl">b:</span><span class="nf">befor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">ldmia</span> <span class="err">取内容之后加</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmib</span> <span class="err">取内容之前加</span><span class="mi">4</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@</span><span class="nf">inc</span> <span class="no">dec</span> <span class="no">after</span> <span class="no">befor</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmia</span> <span class="no">sp</span><span class="p">,</span> <span class="err">{</span><span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmda</span> <span class="no">sp</span><span class="p">,</span> <span class="err">{</span><span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmib</span> <span class="no">sp</span><span class="p">,</span> <span class="err">{</span><span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmdb</span> <span class="no">sp</span><span class="p">,</span> <span class="err">{</span><span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="err">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="相对寻址" class="heading-element"><span>相对寻址</span>
  <a href="#%e7%9b%b8%e5%af%b9%e5%af%bb%e5%9d%80" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E7%9B%B8%E5%AF%B9%E5%AF%BB%E5%9D%80.png" alt="相对寻址" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E7%9B%B8%E5%AF%B9%E5%AF%BB%E5%9D%80.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E7%9B%B8%E5%AF%B9%E5%AF%BB%E5%9D%80.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E7%9B%B8%E5%AF%B9%E5%AF%BB%E5%9D%80.png?size=large 2x" data-title="相对寻址" style="--width: 1108px;--aspect-ratio: 1108 / 524;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="arm指令格式" class="heading-element"><span>Arm指令格式</span>
  <a href="#arm%e6%8c%87%e4%bb%a4%e6%a0%bc%e5%bc%8f" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png" alt="Arm指令格式1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F1.png?size=large 2x" data-title="Arm指令格式1" style="--width: 1650px;--aspect-ratio: 1650 / 709;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F2.png" alt="Arm指令格式2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F2.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F2.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F2.png?size=large 2x" data-title="Arm指令格式2" style="--width: 1672px;--aspect-ratio: 1672 / 822;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F3.png" alt="Arm指令格式3" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F3.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F3.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm%E6%8C%87%E4%BB%A4%E6%A0%BC%E5%BC%8F3.png?size=large 2x" data-title="Arm指令格式3" style="--width: 1689px;--aspect-ratio: 1689 / 660;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="存储器访问指令" class="heading-element"><span>存储器访问指令</span>
  <a href="#%e5%ad%98%e5%82%a8%e5%99%a8%e8%ae%bf%e9%97%ae%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="单寄存器" class="heading-element"><span>单寄存器</span>
  <a href="#%e5%8d%95%e5%af%84%e5%ad%98%e5%99%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>概述:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%8D%95%E5%AF%84%E5%AD%98%E5%99%A8%E6%A6%82%E8%BF%B01.png" alt="单寄存器概述1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%8D%95%E5%AF%84%E5%AD%98%E5%99%A8%E6%A6%82%E8%BF%B01.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%8D%95%E5%AF%84%E5%AD%98%E5%99%A8%E6%A6%82%E8%BF%B01.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%8D%95%E5%AF%84%E5%AD%98%E5%99%A8%E6%A6%82%E8%BF%B01.png?size=large 2x" data-title="单寄存器概述1" style="--width: 2269px;--aspect-ratio: 2269 / 598;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%8D%95%E5%AF%84%E5%AD%98%E5%99%A8%E6%A6%82%E8%BF%B02.png" alt="单寄存器概述2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%8D%95%E5%AF%84%E5%AD%98%E5%99%A8%E6%A6%82%E8%BF%B02.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%8D%95%E5%AF%84%E5%AD%98%E5%99%A8%E6%A6%82%E8%BF%B02.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%8D%95%E5%AF%84%E5%AD%98%E5%99%A8%E6%A6%82%E8%BF%B02.png?size=large 2x" data-title="单寄存器概述2" style="--width: 2269px;--aspect-ratio: 2269 / 506;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>指令编码:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%811.png" alt="指令编码1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%811.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%811.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%811.png?size=large 2x" data-title="指令编码1" style="--width: 1708px;--aspect-ratio: 1708 / 1156;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%812.png" alt="指令编码2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%812.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%812.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%812.png?size=large 2x" data-title="指令编码2" style="--width: 1694px;--aspect-ratio: 1694 / 1056;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>加载指令:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@单寄存器加载</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldr</span>  <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="mi">4</span><span class="err">字节内容给</span><span class="no">r0</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldrb</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="mi">1</span><span class="err">字节内容给</span><span class="no">r0</span> <span class="err">高位补</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldrh</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="mi">2</span><span class="err">字节内容给</span><span class="no">r0</span> <span class="err">高位补</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldrd</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="mi">8</span><span class="err">字节字节内容</span> <span class="err">给</span><span class="no">r0</span> <span class="err">存不下的放</span><span class="no">r1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">@有符号</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldrsb</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="mi">1</span><span class="err">字节内容给</span><span class="no">r0</span> <span class="err">高位补符号位</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldrsh</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="mi">2</span><span class="err">字节内容给</span><span class="no">r0</span> <span class="err">高位补符号位</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">@上述指令加</span><span class="nf">ex版本的表示原子操作</span><span class="p">(</span><span class="err">内存锁</span><span class="p">)</span> <span class="err">加</span><span class="no">t版本的为带用户特权</span><span class="p">(</span><span class="err">内核用</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldrex</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span></span></span></code></pre></td></tr></table>
</div>
</div><p>存储指令:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@单寄存器存储</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span>  <span class="no">r0</span><span class="p">,</span> <span class="no">sp</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="nf">mov</span>  <span class="no">r1</span><span class="p">,</span> <span class="c1">#1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">@</span><span class="nf">str</span>  <span class="no">r1</span><span class="p">,</span> <span class="p">[</span><span class="no">r0</span><span class="p">]</span> <span class="err">@</span><span class="no">r1</span>    <span class="mi">4</span><span class="err">字节内容给</span><span class="p">[</span><span class="no">r0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="nf">strb</span> <span class="no">r1</span><span class="p">,</span> <span class="p">[</span><span class="no">r0</span><span class="p">]</span> <span class="err">@</span><span class="no">r1</span>    <span class="mi">1</span><span class="err">字节内容给</span><span class="p">[</span><span class="no">r0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="nf">strh</span> <span class="no">r1</span><span class="p">,</span> <span class="p">[</span><span class="no">r0</span><span class="p">]</span> <span class="err">@</span><span class="no">r1</span>    <span class="mi">2</span><span class="err">字节内容给</span><span class="p">[</span><span class="no">r0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="nf">strd</span> <span class="no">r2</span><span class="p">,</span> <span class="p">[</span><span class="no">r0</span><span class="p">]</span> <span class="err">@</span><span class="no">r2</span> <span class="no">r3</span> <span class="mi">8</span><span class="err">字节内容给</span><span class="p">[</span><span class="no">r0</span><span class="p">]</span></span></span></code></pre></td></tr></table>
</div>
</div><p>寻址方式:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F1.png" alt="寻址方式1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F1.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F1.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F1.png?size=large 2x" data-title="寻址方式1" style="--width: 1578px;--aspect-ratio: 1578 / 648;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@前变址</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="no">sp</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">r3</span><span class="p">,</span> <span class="c1">#-4] @[r3-4] 4字节内容给r0 r3不变
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">@后变址</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">r3</span><span class="p">],</span> <span class="err">#</span><span class="p">-</span><span class="mi">4</span> <span class="err">@</span><span class="p">[</span><span class="no">r3</span><span class="p">]</span> <span class="mi">4</span><span class="err">字节内容给</span><span class="no">r0</span> <span class="no">r3</span> <span class="err">=</span> <span class="no">r3</span> <span class="p">-</span> <span class="mi">4</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="多寄存器" class="heading-element"><span>多寄存器</span>
  <a href="#%e5%a4%9a%e5%af%84%e5%ad%98%e5%99%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>概述:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A81.png" alt="多寄存器1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A81.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A81.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A81.png?size=large 2x" data-title="多寄存器1" style="--width: 2271px;--aspect-ratio: 2271 / 598;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A82.png" alt="多寄存器2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A82.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A82.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A82.png?size=large 2x" data-title="多寄存器2" style="--width: 2261px;--aspect-ratio: 2261 / 697;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>指令编码:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A8%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png" alt="多寄存器指令编码" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A8%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A8%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A8%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=large 2x" data-title="多寄存器指令编码" style="--width: 1715px;--aspect-ratio: 1715 / 891;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>8种模式:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A88%E7%A7%8D%E6%A8%A1%E5%BC%8F.png" alt="多寄存器8种模式" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A88%E7%A7%8D%E6%A8%A1%E5%BC%8F.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A88%E7%A7%8D%E6%A8%A1%E5%BC%8F.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AD%98%E5%82%A8%E5%99%A8%E8%AE%BF%E9%97%AE%E6%8C%87%E4%BB%A4/%E5%A4%9A%E5%AF%84%E5%AD%98%E5%99%A88%E7%A7%8D%E6%A8%A1%E5%BC%8F.png?size=large 2x" data-title="多寄存器8种模式" style="--width: 1656px;--aspect-ratio: 1656 / 751;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>加载指令:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@</span><span class="nf">inc</span> <span class="no">dec</span> <span class="no">after</span> <span class="no">befor</span>
</span></span><span class="line"><span class="cl"><span class="err">@加载</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span>   <span class="no">r3</span><span class="p">,</span> <span class="no">sp</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmia</span> <span class="no">r3</span><span class="p">,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@取内容之后加</span> <span class="err">将</span><span class="p">[</span><span class="no">r3</span><span class="p">]</span> <span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span><span class="err">处的内容</span><span class="p">,</span><span class="err">依次给</span><span class="no">r0</span> <span class="no">r1</span> <span class="no">r2</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmib</span> <span class="no">r3</span><span class="p">,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@取内容之前加</span> <span class="err">将</span><span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span> <span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">0xC</span><span class="p">]</span><span class="err">处的内容</span><span class="p">,</span><span class="err">依次给</span><span class="no">r0</span> <span class="no">r1</span> <span class="no">r2</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmda</span> <span class="no">r3</span><span class="p">,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@取内容之后减</span> <span class="err">将</span><span class="p">[</span><span class="no">r3</span><span class="p">]</span> <span class="p">[</span><span class="no">r3-4</span><span class="p">]</span> <span class="p">[</span><span class="no">r3-8</span><span class="p">]</span><span class="err">处的内容</span><span class="p">,</span><span class="err">依次给</span><span class="no">r2</span> <span class="no">r1</span> <span class="no">r0</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmdb</span> <span class="no">r3</span><span class="p">,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@取内容之前减</span> <span class="err">将</span><span class="p">[</span><span class="no">r3-4</span><span class="p">]</span> <span class="p">[</span><span class="no">r3-8</span><span class="p">]</span> <span class="p">[</span><span class="no">r3-0xC</span><span class="p">]</span><span class="err">处的内容</span><span class="p">,</span><span class="err">依次给</span><span class="no">r2</span> <span class="no">r1</span> <span class="no">r0</span></span></span></code></pre></td></tr></table>
</div>
</div><p>存储指令:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@存储</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span>   <span class="no">r3</span><span class="p">,</span> <span class="no">sp</span>
</span></span><span class="line"><span class="cl"><span class="nf">stmia</span> <span class="no">r3</span><span class="p">,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@取内容之后加</span> <span class="err">将</span><span class="no">r0</span> <span class="no">r1</span> <span class="no">r2</span> <span class="err">依次给</span><span class="p">[</span><span class="no">r3</span><span class="p">]</span> <span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">stmib</span> <span class="no">r3</span><span class="p">,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@取内容之前加</span> <span class="err">将</span><span class="no">r0</span> <span class="no">r1</span> <span class="no">r2</span> <span class="err">依次给</span><span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span> <span class="p">[</span><span class="no">r3</span><span class="err">+</span><span class="mi">0xC</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">stmda</span> <span class="no">r3</span><span class="p">,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@取内容之后减</span> <span class="err">将</span><span class="no">r2</span> <span class="no">r1</span> <span class="no">r0</span> <span class="err">依次给</span><span class="p">[</span><span class="no">r3</span><span class="p">]</span> <span class="p">[</span><span class="no">r3-4</span><span class="p">]</span> <span class="p">[</span><span class="no">r3-8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">stmdb</span> <span class="no">r3</span><span class="p">,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@取内容之前减</span> <span class="err">将</span><span class="no">r2</span> <span class="no">r1</span> <span class="no">r0</span> <span class="err">依次给</span><span class="p">[</span><span class="no">r3-4</span><span class="p">]</span> <span class="p">[</span><span class="no">r3-8</span><span class="p">]</span> <span class="p">[</span><span class="no">r3-0xC</span><span class="p">]</span></span></span></code></pre></td></tr></table>
</div>
</div><p>入栈出栈:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@</span><span class="nf">full</span> <span class="no">dec</span> <span class="err">满递减</span> <span class="err">堆栈向下增长</span> <span class="err">与</span><span class="no">x86相同</span>
</span></span><span class="line"><span class="cl"><span class="err">@入栈</span>
</span></span><span class="line"><span class="cl"><span class="nf">stmfd</span> <span class="no">sp</span><span class="p">!,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@等同于</span><span class="no">x86中的</span> <span class="no">push</span> <span class="no">r0</span> <span class="no">push</span> <span class="no">r1</span> <span class="no">push</span> <span class="no">r2</span> <span class="no">sp加</span><span class="p">!(</span><span class="err">回写</span><span class="p">)</span><span class="err">后</span><span class="p">,</span><span class="no">sp会自动修改</span><span class="p">(</span><span class="err">每次先减</span><span class="mi">4</span><span class="p">,</span><span class="err">再存</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">@出栈</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldmfd</span> <span class="no">sp</span><span class="p">!,</span> <span class="err">{</span><span class="no">r0-r2</span><span class="err">}</span> <span class="err">@等同于</span><span class="no">x86中的</span> <span class="no">pop</span>  <span class="no">r2</span> <span class="no">pop</span>  <span class="no">r1</span> <span class="no">pop</span>  <span class="no">r0</span> <span class="no">sp加</span><span class="p">!(</span><span class="err">回写</span><span class="p">)</span><span class="err">后</span><span class="p">,</span><span class="no">sp会自动修改</span><span class="p">(</span><span class="err">每次先加</span><span class="mi">4</span><span class="p">,</span><span class="err">再存</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="寄存器和存储器交换" class="heading-element"><span>寄存器和存储器交换</span>
  <a href="#%e5%af%84%e5%ad%98%e5%99%a8%e5%92%8c%e5%ad%98%e5%82%a8%e5%99%a8%e4%ba%a4%e6%8d%a2" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AF%84%E5%AD%98%E5%99%A8%E5%92%8C%E5%AD%98%E5%82%A8%E5%99%A8%E4%BA%A4%E6%8D%A2.png" alt="寄存器和存储器交换" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AF%84%E5%AD%98%E5%99%A8%E5%92%8C%E5%AD%98%E5%82%A8%E5%99%A8%E4%BA%A4%E6%8D%A2.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AF%84%E5%AD%98%E5%99%A8%E5%92%8C%E5%AD%98%E5%82%A8%E5%99%A8%E4%BA%A4%E6%8D%A2.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E5%AF%84%E5%AD%98%E5%99%A8%E5%92%8C%E5%AD%98%E5%82%A8%E5%99%A8%E4%BA%A4%E6%8D%A2.png?size=large 2x" data-title="寄存器和存储器交换" style="--width: 2266px;--aspect-ratio: 2266 / 127;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@寄存器和存储器交换</span>
</span></span><span class="line"><span class="cl"><span class="nf">swp</span>  <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@将</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span><span class="err">的值给</span><span class="no">r0</span> <span class="no">r1的值给</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nf">swp</span>  <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@将</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span><span class="err">的值给</span><span class="no">r0</span> <span class="no">r0原来的值给</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">达到了寄存器和存储器交换的目的</span>
</span></span><span class="line"><span class="cl"><span class="nf">swpb</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r3</span><span class="p">,</span> <span class="p">[</span><span class="no">sp</span><span class="p">]</span> <span class="err">@将</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span><span class="err">中</span><span class="mi">1</span><span class="err">字节的值给</span><span class="no">r2</span><span class="p">,</span><span class="err">高位补</span><span class="mi">0</span> <span class="no">r3中1字节的值给</span><span class="p">[</span><span class="no">sp</span><span class="p">]</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="数据处理指令" class="heading-element"><span>数据处理指令</span>
  <a href="#%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="指令编码" class="heading-element"><span>指令编码</span>
  <a href="#%e6%8c%87%e4%bb%a4%e7%bc%96%e7%a0%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png" alt="数据处理指令编码" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=large 2x" data-title="数据处理指令编码" style="--width: 1683px;--aspect-ratio: 1683 / 711;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="操作码表" class="heading-element"><span>操作码表</span>
  <a href="#%e6%93%8d%e4%bd%9c%e7%a0%81%e8%a1%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><table>
<thead>
<tr>
<th>操作码</th>
<th>指令助记符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>0000</td>
<td>AND</td>
<td>逻辑与操作指令</td>
</tr>
<tr>
<td>0001</td>
<td>EOR</td>
<td>逻辑异或操作指令</td>
</tr>
<tr>
<td>0010</td>
<td>SUB</td>
<td>减法运算指令</td>
</tr>
<tr>
<td>0011</td>
<td>RSB</td>
<td>逆向减法指令</td>
</tr>
<tr>
<td>0100</td>
<td>ADD</td>
<td>加法运算指令</td>
</tr>
<tr>
<td>0101</td>
<td>ADC</td>
<td>带进位加法</td>
</tr>
<tr>
<td>0110</td>
<td>SBC</td>
<td>带进位减法指令</td>
</tr>
<tr>
<td>0111</td>
<td>RSC</td>
<td>带进位逆向减法指令</td>
</tr>
<tr>
<td>1000</td>
<td>TST</td>
<td>位测试指令</td>
</tr>
<tr>
<td>1001</td>
<td>TEQ</td>
<td>相等测试指令</td>
</tr>
<tr>
<td>1010</td>
<td>CMP</td>
<td>比较指令</td>
</tr>
<tr>
<td>1011</td>
<td>CMN</td>
<td>负数比较指令</td>
</tr>
<tr>
<td>1100</td>
<td>ORR</td>
<td>逻辑或操作指令</td>
</tr>
<tr>
<td>1101</td>
<td>MOV</td>
<td>数据传送</td>
</tr>
<tr>
<td>1110</td>
<td>BIC</td>
<td>位清除指令</td>
</tr>
<tr>
<td>1111</td>
<td>MVN</td>
<td>数据非传送</td>
</tr>
</tbody>
</table>
<h4 id="数据传送指令" class="heading-element"><span>数据传送指令</span>
  <a href="#%e6%95%b0%e6%8d%ae%e4%bc%a0%e9%80%81%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A41.png" alt="数据传送指令1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A41.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A41.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A41.png?size=large 2x" data-title="数据传送指令1" style="--width: 2265px;--aspect-ratio: 2265 / 590;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A42.png" alt="数据传送指令2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A42.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A42.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A42.png?size=large 2x" data-title="数据传送指令2" style="--width: 2259px;--aspect-ratio: 2259 / 211;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@数据传送指令</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span>  <span class="no">r0</span><span class="p">,</span> <span class="c1">#1   @将1给r0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">mvn</span>  <span class="no">r1</span><span class="p">,</span> <span class="c1">#0   @将0取反后的结果给r1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">movt</span> <span class="no">r2</span><span class="p">,</span> <span class="err">#</span><span class="mi">123</span> <span class="err">@将</span><span class="mi">123</span><span class="err">的值给</span><span class="no">r2的高16位</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="算术逻辑运算指令" class="heading-element"><span>算术逻辑运算指令</span>
  <a href="#%e7%ae%97%e6%9c%af%e9%80%bb%e8%be%91%e8%bf%90%e7%ae%97%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4.png" alt="算术逻辑运算指令" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E6%8C%87%E4%BB%A4.png?size=large 2x" data-title="算术逻辑运算指令" style="--width: 2252px;--aspect-ratio: 2252 / 451;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@算术逻辑指令</span>
</span></span><span class="line"><span class="cl"><span class="nf">adds</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r2</span> <span class="err">@</span><span class="no">r1</span> <span class="err">=</span> <span class="no">r2</span> <span class="err">+</span> <span class="no">r2</span> <span class="err">影响标志寄存器</span> <span class="err">进位</span> <span class="no">Carry</span> <span class="err">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nf">adc</span>  <span class="no">r1</span><span class="p">,</span> <span class="no">r2</span><span class="p">,</span> <span class="c1">#2 @r1 = r2 + 2 + Carry位的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">add</span>  <span class="no">r1</span><span class="p">,</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r2</span> <span class="err">@</span><span class="no">r1</span> <span class="err">=</span> <span class="no">r2</span> <span class="err">+</span> <span class="no">r2</span> <span class="err">不影响标志寄存器</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">subs</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="c1">#9 @r0 = r1 - 9 影响标志寄存器 借位 Carry = 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">sbc</span>  <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="c1">#5 @r0 = r1 - 5 - (Carry位取反的值)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">sub</span>  <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="c1">#5 @r0 = r1 - 5 不影响标志寄存器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">rsb</span>  <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="c1">#5 @r0 = 5 - r1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">rsc</span>  <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="err">#</span><span class="mi">5</span> <span class="err">@</span><span class="no">r0</span> <span class="err">=</span> <span class="mi">5</span> <span class="p">-</span> <span class="no">r1</span> <span class="p">-</span> <span class="p">(</span><span class="no">Carry位取反的值</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong></p>
<p>加法进位 Carry位为1
减法借位 Carry位为0</p>
<h4 id="逻辑指令" class="heading-element"><span>逻辑指令</span>
  <a href="#%e9%80%bb%e8%be%91%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E9%80%BB%E8%BE%91%E6%8C%87%E4%BB%A4.png" alt="逻辑指令" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E9%80%BB%E8%BE%91%E6%8C%87%E4%BB%A4.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E9%80%BB%E8%BE%91%E6%8C%87%E4%BB%A4.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E9%80%BB%E8%BE%91%E6%8C%87%E4%BB%A4.png?size=large 2x" data-title="逻辑指令" style="--width: 2254px;--aspect-ratio: 2254 / 250;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@逻辑指令</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="c1">#-1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">and</span> <span class="no">r0</span><span class="p">,</span> <span class="c1">#0x80000001 @r0 = r0 &amp; 0x80000001 清零
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">orr</span> <span class="no">r0</span><span class="p">,</span> <span class="c1">#0x80000001 @r0 = r0 | 0x80000001 置位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">eor</span> <span class="no">r0</span><span class="p">,</span> <span class="c1">#0xff       @r0 = r0 ^ 0x80000001 按位取反      
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">bic</span> <span class="no">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">0xff</span>       <span class="err">@</span><span class="no">r0</span> <span class="err">=</span> <span class="no">r0</span> <span class="err">&amp;</span> <span class="p">(</span><span class="err">~</span><span class="mi">0xff</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="比较指令" class="heading-element"><span>比较指令</span>
  <a href="#%e6%af%94%e8%be%83%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><img src="images/Arm/数据处理指令/比较指令.png" alt="比较指令"  />
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@比较指令</span>
</span></span><span class="line"><span class="cl"><span class="nf">cmp</span> <span class="no">r0</span><span class="p">,</span> <span class="c1">#3 @r0 - 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">cmn</span> <span class="no">r0</span><span class="p">,</span> <span class="c1">#3 @r0 - (-3) 负数比较
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">tst</span> <span class="no">r0</span><span class="p">,</span> <span class="c1">#3 @r0 &amp; 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">tst</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span> <span class="err">@判</span><span class="no">r0是否为0</span>
</span></span><span class="line"><span class="cl"><span class="nf">teq</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span> <span class="err">@</span><span class="no">r0</span> <span class="err">^</span> <span class="no">r1</span> <span class="err">判</span><span class="no">r0与r1是否相等</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="乘法指令" class="heading-element"><span>乘法指令</span>
  <a href="#%e4%b9%98%e6%b3%95%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E4%B9%98%E6%B3%95%E6%8C%87%E4%BB%A4.png" alt="乘法指令" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E4%B9%98%E6%B3%95%E6%8C%87%E4%BB%A4.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E4%B9%98%E6%B3%95%E6%8C%87%E4%BB%A4.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%8C%87%E4%BB%A4/%E4%B9%98%E6%B3%95%E6%8C%87%E4%BB%A4.png?size=large 2x" data-title="乘法指令" style="--width: 2258px;--aspect-ratio: 2258 / 927;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@乘法指令</span>
</span></span><span class="line"><span class="cl"><span class="nf">mul</span>   <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>     <span class="err">@</span><span class="mi">32</span><span class="err">位乘法</span> <span class="no">r2</span> <span class="err">=</span> <span class="p">(</span><span class="no">r0</span> <span class="p">*</span> <span class="no">r1</span><span class="p">)</span><span class="err">的结果只取低</span><span class="mi">32</span><span class="err">位</span> 
</span></span><span class="line"><span class="cl"><span class="no">mla</span>   <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="mi">32</span><span class="err">位乘法</span> <span class="no">r2</span> <span class="err">=</span> <span class="p">(</span><span class="no">r3</span> <span class="err">+</span> <span class="p">(</span><span class="no">r0</span> <span class="p">*</span> <span class="no">r1</span><span class="p">))</span><span class="err">的结果只取低</span><span class="mi">32</span><span class="err">位</span>
</span></span><span class="line"><span class="cl"><span class="nf">mls</span>   <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="mi">32</span><span class="err">位乘法</span> <span class="no">r2</span> <span class="err">=</span> <span class="p">(</span><span class="no">r3</span> <span class="p">-</span> <span class="p">(</span><span class="no">r0</span> <span class="p">*</span> <span class="no">r1</span><span class="p">))</span><span class="err">的结果只取低</span><span class="mi">32</span><span class="err">位</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">umull</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="mi">64</span><span class="err">位无符号</span> <span class="p">(</span><span class="no">r1</span> <span class="p">*</span> <span class="no">r3</span><span class="p">)</span><span class="err">的结果</span><span class="p">,</span><span class="err">低</span><span class="mi">32</span><span class="err">位放</span><span class="no">r2</span> <span class="err">高</span><span class="mi">32</span><span class="err">位结果放</span><span class="no">r0</span>
</span></span><span class="line"><span class="cl"><span class="nf">umlal</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="mi">64</span><span class="err">位无符号</span> <span class="no">r2作为低32位</span> <span class="no">r0作为高32位组成64位</span> <span class="err">加上</span><span class="no">r1</span> <span class="p">*</span> <span class="no">r3的结果</span><span class="p">,</span><span class="err">低</span><span class="mi">32</span><span class="err">位放</span><span class="no">r2</span>   <span class="err">高</span><span class="mi">32</span><span class="err">位放</span><span class="no">r0</span>
</span></span><span class="line"><span class="cl"><span class="nf">umaal</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="mi">64</span><span class="err">位无符号</span> <span class="p">(</span><span class="no">r2</span> <span class="err">+</span> <span class="no">r0</span> <span class="err">+</span> <span class="no">r1</span> <span class="p">*</span> <span class="no">r3</span><span class="p">)</span><span class="err">的结果</span><span class="p">,</span><span class="err">低</span><span class="mi">32</span><span class="err">位放</span><span class="no">r2</span> <span class="err">高</span><span class="mi">32</span><span class="err">位结果放</span><span class="no">r0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">smull</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="mi">64</span><span class="err">位有符号</span> <span class="p">(</span><span class="no">r1</span> <span class="p">*</span> <span class="no">r3</span><span class="p">)</span><span class="err">的结果</span><span class="p">,</span><span class="err">低</span><span class="mi">32</span><span class="err">位放</span><span class="no">r2</span> <span class="err">高</span><span class="mi">32</span><span class="err">位结果放</span><span class="no">r0</span>
</span></span><span class="line"><span class="cl"><span class="nf">smlal</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="mi">64</span><span class="err">位有符号</span> <span class="no">r2作为低32位</span> <span class="no">r0作为高32位组成64位</span> <span class="err">加上</span><span class="no">r1</span> <span class="p">*</span> <span class="no">r3的结果</span><span class="p">,</span><span class="err">低</span><span class="mi">32</span><span class="err">位放</span><span class="no">r2</span>   <span class="err">高</span><span class="mi">32</span><span class="err">位放</span><span class="no">r0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">smmul</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span>     <span class="err">@</span><span class="p">(</span><span class="no">r1</span> <span class="p">*</span> <span class="no">r3</span><span class="p">)</span><span class="err">的结果</span><span class="p">,</span><span class="err">高</span><span class="mi">32</span><span class="err">位放</span><span class="no">r2</span>
</span></span><span class="line"><span class="cl"><span class="nf">smmla</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="no">r2</span> <span class="err">=</span> <span class="p">(</span><span class="no">r3</span> <span class="err">+</span> <span class="p">(</span><span class="no">r0</span> <span class="p">*</span> <span class="no">r1</span><span class="p">)</span><span class="err">的高</span><span class="mi">32</span><span class="err">位</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">smmls</span> <span class="no">r2</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span><span class="p">,</span> <span class="no">r3</span> <span class="err">@</span><span class="no">r2</span> <span class="err">=</span> <span class="p">(</span><span class="no">r3</span> <span class="p">-</span> <span class="p">(</span><span class="no">r0</span> <span class="p">*</span> <span class="no">r1</span><span class="p">)</span><span class="err">的高</span><span class="mi">32</span><span class="err">位</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="除法指令" class="heading-element"><span>除法指令</span>
  <a href="#%e9%99%a4%e6%b3%95%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>没有特定的指令,需要依靠其他指令做优化来完成除法运算.</p>
<p>编译器已将做好了库,直接调用即可.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E9%99%A4%E6%B3%95%E6%8C%87%E4%BB%A41.png" alt="除法指令1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E9%99%A4%E6%B3%95%E6%8C%87%E4%BB%A41.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E9%99%A4%E6%B3%95%E6%8C%87%E4%BB%A41.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E9%99%A4%E6%B3%95%E6%8C%87%E4%BB%A41.png?size=large 2x" data-title="除法指令1" style="--width: 871px;--aspect-ratio: 871 / 212;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E9%99%A4%E6%B3%95%E6%8C%87%E4%BB%A42.png" alt="除法指令2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E9%99%A4%E6%B3%95%E6%8C%87%E4%BB%A42.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E9%99%A4%E6%B3%95%E6%8C%87%E4%BB%A42.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E9%99%A4%E6%B3%95%E6%8C%87%E4%BB%A42.png?size=large 2x" data-title="除法指令2" style="--width: 878px;--aspect-ratio: 878 / 290;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h3 id="跳转指令" class="heading-element"><span>跳转指令</span>
  <a href="#%e8%b7%b3%e8%bd%ac%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="概述" class="heading-element"><span>概述</span>
  <a href="#%e6%a6%82%e8%bf%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%A6%82%E8%BF%B0.png" alt="跳转指令概述" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%A6%82%E8%BF%B0.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%A6%82%E8%BF%B0.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%A6%82%E8%BF%B0.png?size=large 2x" data-title="跳转指令概述" style="--width: 1390px;--aspect-ratio: 1390 / 242;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="条件码" class="heading-element"><span>条件码</span>
  <a href="#%e6%9d%a1%e4%bb%b6%e7%a0%81" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%9D%A1%E4%BB%B6%E7%A0%81.png" alt="跳转指令条件码" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%9D%A1%E4%BB%B6%E7%A0%81.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%9D%A1%E4%BB%B6%E7%A0%81.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%9D%A1%E4%BB%B6%E7%A0%81.png?size=large 2x" data-title="跳转指令条件码" style="--width: 576px;--aspect-ratio: 576 / 441;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>b的后面可以跟条件码,如beq,bne.</p>
<h4 id="指令编码-1" class="heading-element"><span>指令编码</span>
  <a href="#%e6%8c%87%e4%bb%a4%e7%bc%96%e7%a0%81-1" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png" alt="跳转指令指令编码" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4%E6%8C%87%E4%BB%A4%E7%BC%96%E7%A0%81.png?size=large 2x" data-title="跳转指令指令编码" style="--width: 576px;--aspect-ratio: 576 / 340;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="ida静态分析切换指令集" class="heading-element"><span>IDA静态分析,切换指令集</span>
  <a href="#ida%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90%e5%88%87%e6%8d%a2%e6%8c%87%e4%bb%a4%e9%9b%86" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%88%87%E6%8D%A2%E6%8C%87%E4%BB%A4%E9%9B%86.png" alt="IDA静态分析切换指令集" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%88%87%E6%8D%A2%E6%8C%87%E4%BB%A4%E9%9B%86.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%88%87%E6%8D%A2%E6%8C%87%E4%BB%A4%E9%9B%86.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/IDA%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%88%87%E6%8D%A2%E6%8C%87%E4%BB%A4%E9%9B%86.png?size=large 2x" data-title="IDA静态分析切换指令集" style="--width: 1060px;--aspect-ratio: 1060 / 433;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="指令示例" class="heading-element"><span>指令示例</span>
  <a href="#%e6%8c%87%e4%bb%a4%e7%a4%ba%e4%be%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>B:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">    <span class="nf">push</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="no">r1</span><span class="p">,</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="no">lr</span><span class="p">,</span> <span class="no">pc</span>  <span class="err">@使用</span><span class="no">b指令来调用函数</span><span class="p">,</span><span class="err">需要自己设置</span><span class="no">LR寄存器</span><span class="p">,</span><span class="err">十分不方便</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">    <span class="nf">b</span> <span class="no">my_add</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nl">my_add:</span>
</span></span><span class="line"><span class="cl">	<span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">pc</span><span class="p">,</span> <span class="no">lr</span></span></span></code></pre></td></tr></table>
</div>
</div><p>BL:</p>
<p>bl所在的指令集和所调函数的指令集相同.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">    <span class="nf">push</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="nf">mov</span> <span class="no">r1</span><span class="p">,</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="nf">bl</span> <span class="no">my_add</span>   <span class="err">@使用</span><span class="no">bl指令来调用函数</span><span class="p">,</span><span class="err">不需要自己设置</span><span class="no">LR寄存器</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nl">my_add:</span>
</span></span><span class="line"><span class="cl">	<span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">pc</span><span class="p">,</span> <span class="no">lr</span></span></span></code></pre></td></tr></table>
</div>
</div><p>bl所在的指令集和所调函数的指令集不同.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">	<span class="err">@</span><span class="nf">bl</span> <span class="err">下面所示的调用会崩</span><span class="p">,</span><span class="err">没有切换指令集</span>
</span></span><span class="line"><span class="cl">	<span class="nf">push</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.code</span>	<span class="mi">32</span>      <span class="na">@arm指令集</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r1</span><span class="p">,</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">	<span class="nf">bl</span> <span class="no">my_add</span>   <span class="err">@使用</span><span class="no">bl指令来调函数</span><span class="p">,</span><span class="err">不需要自己设置</span><span class="no">LR寄存器</span><span class="p">,</span><span class="err">但是无法自动切换指令集</span><span class="p">,</span><span class="err">即标志寄存器的</span><span class="no">T位.</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nl">my_add:</span>
</span></span><span class="line"><span class="cl"><span class="na">.code</span>	<span class="mi">16</span>      <span class="na">@thumb指令集</span>
</span></span><span class="line"><span class="cl">	<span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">pc</span><span class="p">,</span> <span class="no">lr</span></span></span></code></pre></td></tr></table>
</div>
</div><p>BX:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">	<span class="err">@</span><span class="nf">bx</span> <span class="err">后面跟的只能是寄存器</span>
</span></span><span class="line"><span class="cl">	<span class="nf">push</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.code</span>	<span class="mi">32</span>         <span class="na">@arm指令集.</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r1</span><span class="p">,</span> <span class="mi">5</span>      <span class="err">@</span>   <span class="no">cpu计算偏移的时候</span><span class="p">,</span><span class="err">会忽略地址的低位</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">	<span class="nf">add</span> <span class="no">r2</span><span class="p">,</span> <span class="no">pc</span><span class="p">,</span> <span class="c1">#9 @1. 需要自己算偏移,状态的切换由地址的最低位来决定,0:arm指令,1:thumb指令
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">mov</span> <span class="no">lr</span><span class="p">,</span> <span class="no">pc</span>     <span class="err">@</span><span class="mi">2</span><span class="p">.</span> <span class="err">需要自己设置</span><span class="no">LR寄存器.</span>
</span></span><span class="line"><span class="cl">	<span class="nf">bx</span> <span class="no">r2</span>          <span class="err">@</span>   <span class="err">会根据地址的最低位</span><span class="p">,</span><span class="err">自动切换状态</span><span class="p">,</span><span class="err">即标志寄存器</span><span class="no">T位的值.</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nl">my_add:</span>
</span></span><span class="line"><span class="cl"><span class="na">.code</span>	<span class="mi">16</span>         <span class="na">@thumb指令集.</span>
</span></span><span class="line"><span class="cl">	<span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">	<span class="err">@</span><span class="nf">mov</span> <span class="no">pc</span><span class="p">,</span> <span class="no">lr</span>
</span></span><span class="line"><span class="cl">	<span class="nf">bx</span> <span class="no">lr</span>          <span class="err">@</span><span class="mi">3</span><span class="p">.</span> <span class="err">状态切换</span><span class="p">,</span><span class="err">由地址低位来决定</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="no">arm指令</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="no">thumb指令.</span>
</span></span><span class="line"><span class="cl">	</span></span></code></pre></td></tr></table>
</div>
</div><p>BLX:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">    <span class="nf">push</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="na">.code</span>	<span class="mi">32</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r1</span><span class="p">,</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="nf">blx</span> <span class="no">my_add</span>     <span class="err">@会自动切状态</span><span class="p">,</span><span class="no">T位取反.</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nl">my_add:</span>
</span></span><span class="line"><span class="cl"><span class="na">.code</span>	<span class="mi">16</span>         <span class="na">@thumb指令集.</span>
</span></span><span class="line"><span class="cl">	<span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">	<span class="err">@</span><span class="nf">mov</span> <span class="no">pc</span><span class="p">,</span> <span class="no">lr</span>
</span></span><span class="line"><span class="cl">	<span class="nf">bx</span> <span class="no">lr</span>          <span class="err">@</span><span class="mi">3</span><span class="p">.</span> <span class="err">状态切换</span><span class="p">,</span><span class="err">由地址低位来决定</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="no">arm指令</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="no">thumb指令.</span></span></span></code></pre></td></tr></table>
</div>
</div><p>TBB:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">	<span class="err">@</span><span class="nf">tbb</span> <span class="no">thumb2指令才可以用</span><span class="p">,</span><span class="err">常用来做</span><span class="no">SwitchCase</span>
</span></span><span class="line"><span class="cl">	<span class="nf">push</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">blx</span> <span class="no">thumb2</span>
</span></span><span class="line"><span class="cl"><span class="na">.code</span>	<span class="mi">16</span>
</span></span><span class="line"><span class="cl"><span class="nl">thumb2:</span>
</span></span><span class="line"><span class="cl">	<span class="nf">add</span> <span class="no">r2</span><span class="p">,</span> <span class="no">pc</span><span class="p">,</span> <span class="c1">#8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">mov</span> <span class="no">r3</span><span class="p">,</span> <span class="c1">#2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nf">tbb</span> <span class="p">[</span><span class="no">r2</span><span class="p">,</span> <span class="no">r3</span><span class="p">]</span>  <span class="err">@</span><span class="no">PC</span> <span class="err">=</span> <span class="no">PC</span> <span class="err">+</span> <span class="p">(</span><span class="no">R2</span> <span class="err">+</span> <span class="no">R3</span><span class="p">)</span><span class="err">内存地址处取一字节然后乘以</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nl">table1:</span>
</span></span><span class="line"><span class="cl">	<span class="na">.byte</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">	<span class="na">.byte</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="na">.byte</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="na">.byte</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="nl">case1:</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">pc</span><span class="err">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>TBH:</p>
<p>表跳转半字
B:byte
H:half</p>
<p>PC = PC + ZeroExtend( Memory( Rn + Rm &laquo; 1, 2) &laquo; 1)</p>
<h3 id="其他指令" class="heading-element"><span>其他指令</span>
  <a href="#%e5%85%b6%e4%bb%96%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="中断指令" class="heading-element"><span>中断指令</span>
  <a href="#%e4%b8%ad%e6%96%ad%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">swi</span> <span class="c1">#中断号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">svc</span> <span class="err">#中断号</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="系统调用_exit" class="heading-element"><span>系统调用_exit</span>
  <a href="#%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8_exit" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>看下系统底层是如何调_exit这个API的:</p>
<p><strong>测试代码</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="nf">bl</span> <span class="no">_exit</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>操作</strong>:</p>
<p>IDA调试,F7跟进_exit.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8_exit.png" alt="系统调用_exit" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8_exit.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8_exit.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8_exit.png?size=large 2x" data-title="系统调用_exit" style="--width: 834px;--aspect-ratio: 834 / 255;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><strong>结论</strong>:</p>
<ul>
<li>Android系统调API的中断是0.</li>
<li>_exit的api编号是0xF8.</li>
</ul>
<h5 id="喜讯" class="heading-element"><span>喜讯</span>
  <a href="#%e5%96%9c%e8%ae%af" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><ul>
<li>Android 0环Api调用的参数与3环参数相同.</li>
<li>目前Android所有版本API编号一样.
这与Windows有所不同,Windows不同版本,API编号也不一样.</li>
<li>Android Ndk目录中有一个文件(unistd-common.h)记录了所有的API编号,
ndk编程中不同指令集要包含不同路径下的unistd-common.h.</li>
</ul>
<h5 id="arm调用_exit示例" class="heading-element"><span>Arm调用_exit示例</span>
  <a href="#arm%e8%b0%83%e7%94%a8_exit%e7%a4%ba%e4%be%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@调用</span><span class="nf">_exit示例</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="no">r7</span><span class="p">,</span> <span class="c1">#0xF8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">svc</span> <span class="err">#</span><span class="mi">0</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ndk编程调用_exit示例" class="heading-element"><span>NDK编程调用_exit示例</span>
  <a href="#ndk%e7%bc%96%e7%a8%8b%e8%b0%83%e7%94%a8_exit%e7%a4%ba%e4%be%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;syscall.h&gt;</span><span class="cp">  </span><span class="c1">//包含这个文件会根据指令集包含一个合适的头文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="s">&#34;C&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">JNIEXPORT</span> <span class="kt">void</span> <span class="n">JNICALL</span>
</span></span><span class="line"><span class="cl"><span class="n">Java_org_example_luondk_MainActivity_TstExit</span><span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">thiz</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//查看unistd-common.h. 我们发现exit对应的api编号为 __NR_exit_group, 即0xF8,十进制的248
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//可通过调用syscall 就不用我们手写汇编了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//调用的api,后面有几个参数,就传几个参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">syscall</span><span class="p">(</span><span class="n">__NR_exit_group</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="标志寄存器" class="heading-element"><span>标志寄存器</span>
  <a href="#%e6%a0%87%e5%bf%97%e5%af%84%e5%ad%98%e5%99%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A81.png" alt="标志寄存器1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A81.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A81.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A81.png?size=large 2x" data-title="标志寄存器1" style="--width: 717px;--aspect-ratio: 717 / 179;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A82.png" alt="标志寄存器2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A82.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A82.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A82.png?size=large 2x" data-title="标志寄存器2" style="--width: 1634px;--aspect-ratio: 1634 / 82;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@读标志寄存器</span>
</span></span><span class="line"><span class="cl"><span class="nf">mrs</span> <span class="no">r0</span><span class="p">,</span> <span class="no">cpsr</span>
</span></span><span class="line"><span class="cl"><span class="err">@改标志寄存器,只能修改高8位,其他无权限</span>
</span></span><span class="line"><span class="cl"><span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="mi">0xffffffff</span>
</span></span><span class="line"><span class="cl"><span class="nf">msr</span> <span class="no">cpsr_cfsx</span><span class="p">,</span> <span class="no">r0</span>
</span></span><span class="line"><span class="cl"><span class="nf">msr</span> <span class="no">cpsr_f</span><span class="p">,</span> <span class="no">r0</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="伪指令" class="heading-element"><span>伪指令</span>
  <a href="#%e4%bc%aa%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><h5 id="解决偏移问题" class="heading-element"><span>解决偏移问题</span>
  <a href="#%e8%a7%a3%e5%86%b3%e5%81%8f%e7%a7%bb%e9%97%ae%e9%a2%98" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>ADR:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ADR%E6%A6%82%E8%BF%B0.png" alt="ADR概述" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ADR%E6%A6%82%E8%BF%B0.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ADR%E6%A6%82%E8%BF%B0.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ADR%E6%A6%82%E8%BF%B0.png?size=large 2x" data-title="ADR概述" style="--width: 576px;--aspect-ratio: 576 / 308;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">	<span class="err">@</span><span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">pc</span><span class="p">,</span> <span class="c1">#8  @计算到code1的偏移.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="err">@上面那种写法的痛点在于</span> <span class="err">如果这条语句和</span><span class="nf">code1之间新增了指令</span><span class="p">,</span><span class="err">就需要重新计算偏移</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">	<span class="nf">adr</span> <span class="no">code1</span>  <span class="err">@我们可以使用</span><span class="no">adr伪指令来代替上面的那条很不舒服的指令</span><span class="p">,</span><span class="err">编译器会帮我们计算偏移</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">code1:</span>
</span></span><span class="line"><span class="cl">	<span class="nf">mov</span> <span class="no">r0</span><span class="p">,</span> <span class="err">#</span><span class="mi">3</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ADRL:</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ADRL%E6%A6%82%E8%BF%B0.png" alt="ADRL概述" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ADRL%E6%A6%82%E8%BF%B0.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ADRL%E6%A6%82%E8%BF%B0.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/ADRL%E6%A6%82%E8%BF%B0.png?size=large 2x" data-title="ADRL概述" style="--width: 576px;--aspect-ratio: 576 / 319;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>adrl能计算的偏移更大,但是目前版本的编译器不能使用该伪指令.</p>
<h5 id="解决给立即数问题" class="heading-element"><span>解决给立即数问题</span>
  <a href="#%e8%a7%a3%e5%86%b3%e7%bb%99%e7%ab%8b%e5%8d%b3%e6%95%b0%e9%97%ae%e9%a2%98" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>LDR:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">@伪指令</span> <span class="nf">LDR</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldr</span> <span class="no">r0</span><span class="p">,</span> <span class="err">=</span><span class="mi">0xff1</span>  <span class="err">@伪指令给立即数</span><span class="p">,</span><span class="err">后面要写=</span>
</span></span><span class="line"><span class="cl"><span class="nf">ldr</span> <span class="no">r2</span><span class="p">,</span> <span class="err">=</span><span class="mi">0x55668899</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="nop" class="heading-element"><span>NOP</span>
  <a href="#nop" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h5><p>目前nop指令已不是伪指令了,在早期版本nop指令是伪指令.
早期nop伪指令对应的汇编语句为 mov r0, r0.</p>
<h3 id="浮点指令" class="heading-element"><span>浮点指令</span>
  <a href="#%e6%b5%ae%e7%82%b9%e6%8c%87%e4%bb%a4" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p>寄存器:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nl">float:</span> <span class="nf">s0-s31</span>
</span></span><span class="line"><span class="cl"><span class="nl">double:</span> <span class="nf">d0-d31</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在常规指令前加V即可,如VADD,VSUB,VMOV.</p>
<h3 id="arm指令参考" class="heading-element"><span>Arm指令参考</span>
  <a href="#arm%e6%8c%87%e4%bb%a4%e5%8f%82%e8%80%83" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/ARM-Thumb2%E6%8C%87%E4%BB%A4%E9%9B%86%E9%80%9F%E6%9F%A5%E5%8D%A1.pdf">ARM-Thumb2指令集速查卡.pdf</a></p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/ARMv8-arm64%E6%8C%87%E4%BB%A4%E9%9B%86%E9%80%9F%E8%A7%88%E8%A1%A8.pdf">ARMv8-arm64指令集速览表.pdf</a></p>
<p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/ARM%E7%9F%A2%E9%87%8F%E6%B5%AE%E7%82%B9%E6%8C%87%E4%BB%A4%E9%9B%86%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C.pdf">ARM矢量浮点指令集参考手册.pdf</a></p>
<h3 id="arm应用" class="heading-element"><span>Arm应用</span>
  <a href="#arm%e5%ba%94%e7%94%a8" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><h4 id="内联汇编" class="heading-element"><span>内联汇编</span>
  <a href="#%e5%86%85%e8%81%94%e6%b1%87%e7%bc%96" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p><strong>LuoHello.cpp</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//单行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">__asm__</span><span class="p">(</span><span class="s">&#34;mov r0, r1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//多行,每一行的后面要有换行符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">__asm__</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;mov r2, r1</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;mov r1, r1</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;mov r3, r4</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;mov r1, r1</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello Arm</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/Arm_%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96.7z">Arm_内联汇编.7z</a></p>
<h4 id="裸函数" class="heading-element"><span>裸函数</span>
  <a href="#%e8%a3%b8%e5%87%bd%e6%95%b0" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">//裸函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">extern</span> <span class="s">&#34;C&#34;</span> <span class="n">__attribute__</span><span class="p">((</span><span class="kr">naked</span><span class="p">))</span> <span class="kt">int</span> <span class="n">MySub</span><span class="p">(</span><span class="kt">int</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl"> <span class="n">__asm__</span><span class="p">(</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;sub r0, r0, r1</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;bx lr&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="混合编译" class="heading-element"><span>混合编译</span>
  <a href="#%e6%b7%b7%e5%90%88%e7%bc%96%e8%af%91" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>源文件:</p>
<p><strong>LuoArm.s</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">	<span class="na">.text</span>
</span></span><span class="line"><span class="cl">	<span class="na">.globl</span> 	 <span class="no">LuoAdd</span>                  
</span></span><span class="line"><span class="cl">	<span class="no">.globl</span>  <span class="no">LuoSub</span>
</span></span><span class="line"><span class="cl">	<span class="err">@</span><span class="na">.extern</span> <span class="no">MySub</span>
</span></span><span class="line"><span class="cl">	<span class="na">.p2align</span>	<span class="mi">2</span>
</span></span><span class="line"><span class="cl">	<span class="na">.type</span>	<span class="no">LuoAdd</span><span class="p">,</span><span class="nv">%function</span>
</span></span><span class="line"><span class="cl">	<span class="na">.code</span>	<span class="mi">32</span>                      
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">LuoSub</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="nf">push</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="err">@汇编调</span><span class="nf">C</span>
</span></span><span class="line"><span class="cl">	<span class="nf">bl</span> <span class="no">MySub</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">bx</span> <span class="no">lr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">LuoAdd:</span>
</span></span><span class="line"><span class="cl">	<span class="nf">push</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nf">add</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r0</span><span class="p">,</span> <span class="no">r1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nf">pop</span>	<span class="err">{</span><span class="no">r11</span><span class="p">,</span> <span class="no">lr</span><span class="err">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">bx</span> <span class="no">lr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="na">.p2align</span>	<span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nl">LuoAdd_end:</span>
</span></span><span class="line"><span class="cl">	<span class="na">.size</span>	<span class="no">LuoAdd</span><span class="p">,</span> <span class="no">LuoAdd_end-LuoAdd</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>LuoHello.cpp</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//裸函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">extern</span> <span class="s">&#34;C&#34;</span> <span class="n">__attribute__</span><span class="p">((</span><span class="kr">naked</span><span class="p">))</span> <span class="kt">int</span> <span class="n">MySub</span><span class="p">(</span><span class="kt">int</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="n">__asm__</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;sub r0, r0, r1</span><span class="se">\n</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;bx lr&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="s">&#34;C&#34;</span> <span class="kt">int</span> <span class="n">LuoAdd</span><span class="p">(</span><span class="kt">int</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="s">&#34;C&#34;</span> <span class="kt">int</span> <span class="n">LuoSub</span><span class="p">(</span><span class="kt">int</span> <span class="n">n1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//C++调汇编
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;LuoAdd: 2 + 3 = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">LuoAdd</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">printf</span><span class="p">(</span><span class="s">&#34;MySub: 6 - 1 = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">LuoSub</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Android.mk</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">LOCAL_PATH</span> <span class="o">:=</span> <span class="k">$(</span>call my-dir<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">include</span> <span class="k">$(</span><span class="nv">CLEAR_VARS</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#存储要构建的模块的名称
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">LOCAL_MODULE</span> <span class="o">:=</span> LuoHello
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#列举源文件
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">LOCAL_SRC_FILES</span> <span class="o">:=</span> LuoHello.cpp LuoArm.s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#链接选项
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="nv">LOCAL_CPPFLAGS</span> <span class="o">:=</span> -marm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#包含编译脚本
</span></span></span><span class="line"><span class="cl"><span class="c"></span><span class="err">include</span> <span class="k">$(</span><span class="nv">BUILD_EXECUTABLE</span><span class="k">)</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Application.mk</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">APP_PLATFORM</span> <span class="o">:=</span> android-16
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">APP_ABI</span> <span class="o">:=</span> armeabi-v7a
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%91.7z">Arm_混合编译.7z</a></p>
<p>编译:</p>
<p>输入<strong>ndk-build</strong>进行编译.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%911.png" alt="Arm_混合编译1" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%911.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%911.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%911.png?size=large 2x" data-title="Arm_混合编译1" style="--width: 1173px;--aspect-ratio: 1173 / 525;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p>运行:</p>
<p>确保Android虚拟机在开着.</p>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%912.png" alt="Arm_混合编译2" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%912.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%912.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/Arm_%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%912.png?size=large 2x" data-title="Arm_混合编译2" style="--width: 1158px;--aspect-ratio: 1158 / 605;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<h4 id="调试" class="heading-element"><span>调试</span>
  <a href="#%e8%b0%83%e8%af%95" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><p>调试api:</p>
<p><a href="https://man7.org/linux/man-pages/man2/ptrace.2.html"target="_blank" rel="external nofollow noopener noreferrer">https://man7.org/linux/man-pages/man2/ptrace.2.html</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="kt">long</span> <span class="nf">ptrace</span><span class="p">(</span><span class="k">enum</span> <span class="nc">__ptrace_request</span> <span class="n">request</span><span class="p">,</span> <span class="n">pid_t</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//参数一:request的宏定义很多,可以参考上面的网址.
</span></span></span><span class="line"><span class="cl"><span class="c1">//PTRACE_ATTACH 附加
</span></span></span><span class="line"><span class="cl"><span class="c1">//PTRACE_CONT 继续执行
</span></span></span><span class="line"><span class="cl"><span class="c1">//PTRACE_PEEKTEXT, PTRACE_PEEKDATA 读数据
</span></span></span><span class="line"><span class="cl"><span class="c1">//PTRACE_GETREGSET 获取寄存器信息
</span></span></span><span class="line"><span class="cl"><span class="c1">//PTRACE_SETREGSET 设置寄存器信息
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>调试示例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;jni.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/ptrace.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Main Start:%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">childPid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">childPid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;childPid: %d......</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//附加子进程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_ATTACH</span><span class="p">,</span> <span class="n">childPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_ATTACH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//等调试事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">waitpid</span><span class="p">(</span><span class="n">childPid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">WUNTRACED</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;PTRACE_ATTACH OK</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//继续执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_CONT</span><span class="p">,</span> <span class="n">childPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_CONT&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;PTRACE_CONT OK</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//等待子进程结束
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">waitpid</span><span class="p">(</span><span class="n">childPid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">WUNTRACED</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Main End:%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/Arm_LuoDebug.7z">Arm_LuoDebug.7z</a></p>
<div class="details admonition note open">
    <div class="details-summary admonition-title">
      <i class="icon fa-solid fa-pencil-alt fa-fw" aria-hidden="true"></i>注意<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden="true"></i>
    </div>
    <div class="details-content">
      <div class="admonition-content">不是父子进程之间调试,就需要root权限.</div>
    </div>
  </div>
<h4 id="代码注入" class="heading-element"><span>代码注入</span>
  <a href="#%e4%bb%a3%e7%a0%81%e6%b3%a8%e5%85%a5" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h4><ol>
<li>思路</li>
</ol>
<p>在远程进程中申请一段地址空间,将要注入的动态库文件的路径写进去,然后在远程进程中调dlopen函数将动态库加载到内存中.</p>
<ol start="2">
<li>细节</li>
</ol>
<p><strong>①如何在远程进程中申请地址空间?</strong></p>
<p>我们知道在自身进程中,可以调用mmap函数来申请地址空间.我们可以附加远程进程,将pc寄存器的值设置为远程进程中mmap函数的地址(这个地方需要注意的就是<strong>pc寄存器值的低位不可能为1</strong>),然后运行程序,函数的返回值就是申请的地址空间.</p>
<p><strong>②如何计算远程api函数的地址?</strong></p>
<p>远程api函数地址 = 远程api函数所在模块基址 + (自身进程api函数地址 - 自身进程api函数所在的基址).</p>
<p><strong>③如何知道api函数在哪个模块中?</strong></p>
<p>我们可以在自身进程中打印api函数地址以及所有的内存模块地址,比对api函数地址在哪个内存模块地址范围内,即可知道api函数所在的模块.</p>
<p><strong>④如何知道远程进程api函数执行完毕?</strong></p>
<p>我们在执行远程进程api函数之前,将lr寄存器的值设置为0,这样远程进程api函数执行完毕,就会产生异常.我们可以调用waitpid这个函数来等待异常(这个函数在异常没来之前会阻塞),当执行到waitpid的下一行的时候,说明远程进程api函数已经执行完毕.</p>
<ol start="3">
<li>源代码</li>
</ol>
<p>注入的目标程序:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Inject Target: %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注入的动态库:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span> <span class="kt">void</span> <span class="n">LuoLoad</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Hello LuoLoad</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注入程序:</p>
<p><strong>步骤:</strong></p>
<ol>
<li>附加目标进程.</li>
<li>保存寄存器环境.</li>
<li>修改寄存器环境.
<ol>
<li>在远程进程中申请地址空间.</li>
<li>将库路径写入申请的地址空间中.</li>
<li>将远程进程dlopen的地址给pc寄存器.</li>
</ol>
</li>
<li>还原寄存器环境.</li>
<li>取消附加.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/ptrace.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;android/log.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;dlfcn.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;android/log.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, &#34;Luo&#34;, __VA_ARGS__);
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//显示寄存器的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">show_regs</span><span class="p">(</span><span class="n">pt_regs</span> <span class="o">*</span><span class="n">pRegs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;SP:%08X</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;LR:%08X</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;PC:%08X</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;R%d:%08X</span><span class="se">\t</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//获取远程注入进程的寄存器环境
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">get_remote_regs</span><span class="p">(</span><span class="kt">int</span> <span class="n">nPid</span><span class="p">,</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">pRegs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_GETREGS</span><span class="p">,</span> <span class="n">nPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_GETREGS&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//修改远程注入进程的寄存器环境
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">set_remote_regs</span><span class="p">(</span><span class="kt">int</span> <span class="n">nPid</span><span class="p">,</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">pRegs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_SETREGS</span><span class="p">,</span> <span class="n">nPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_SETREGS&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//获取远程进程的模块基址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="o">*</span><span class="nf">get_module_base</span><span class="p">(</span><span class="n">pid_t</span> <span class="n">pid</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">moduleName</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">260</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;/proc/%d/maps&#34;</span><span class="p">,</span> <span class="n">pid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;fopen&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">buf</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">strstr</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">moduleName</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;%08x&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//设置远程进程的pc寄存器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">set_pc_regs</span><span class="p">(</span><span class="kt">int</span> <span class="n">nPid</span><span class="p">,</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">pRegs</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">pc_addr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">get_remote_regs</span><span class="p">(</span><span class="n">nPid</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    * 将lr寄存器的值设置为0, 这样远程进程执行完api函数,返回的时候就会产生异常
</span></span></span><span class="line"><span class="cl"><span class="cm">    * 这样的话,我们就知道api函数执行完毕
</span></span></span><span class="line"><span class="cl"><span class="cm">    */</span>
</span></span><span class="line"><span class="cl">    <span class="n">pRegs</span><span class="o">-&gt;</span><span class="n">ARM_lr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 设置pc的值为远程api的地址
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 这里需要注意PC的地址低位不可能为1
</span></span></span><span class="line"><span class="cl"><span class="cm">     * bl 10001, pc的地址为1000
</span></span></span><span class="line"><span class="cl"><span class="cm">     * bx 10001, pc的地址为1000, 然后根据地址低位来切换cpu的工作状态,即T位的值
</span></span></span><span class="line"><span class="cl"><span class="cm">     * */</span>
</span></span><span class="line"><span class="cl">    <span class="n">pRegs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">pc_addr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//手动切换T位的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">pc_addr</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">pRegs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">pRegs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">|=</span> <span class="o">~</span><span class="mh">0x20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//计算远程进程的api地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="nf">calc_remote_api_addr</span><span class="p">(</span><span class="kt">int</span> <span class="n">nSelfPid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nInjectPid</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">moduleName</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vSelfApiAddr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">local_libc_base</span> <span class="o">=</span> <span class="n">get_module_base</span><span class="p">(</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">moduleName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">remote_libc_base</span> <span class="o">=</span> <span class="n">get_module_base</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="n">moduleName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">remote_addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">remote_libc_base</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">vSelfApiAddr</span> <span class="o">-</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">local_libc_base</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">remote_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">api_end</span><span class="p">(</span><span class="kt">int</span> <span class="n">nPid</span><span class="p">,</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">pRegs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//设置远程进程寄存器环境
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">set_remote_regs</span><span class="p">(</span><span class="n">nPid</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//继续执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_CONT</span><span class="p">,</span> <span class="n">nPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_CONT&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//等待调试事件 会阻塞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">waitpid</span><span class="p">(</span><span class="n">nPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">WUNTRACED</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//走到这里的时候, r0就是申请的地址空间的首地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">get_remote_regs</span><span class="p">(</span><span class="n">nPid</span><span class="p">,</span> <span class="n">pRegs</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//远程申请内存空间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="o">*</span><span class="nf">remote_mmap</span><span class="p">(</span><span class="kt">int</span> <span class="n">nInjectPid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//计算远程进程的mmap地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="o">*</span><span class="n">remote_mmap_addr</span> <span class="o">=</span> <span class="n">calc_remote_api_addr</span><span class="p">(</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">nInjectPid</span><span class="p">,</span> <span class="s">&#34;libc.so&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">mmap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">pt_regs</span> <span class="n">regs</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//设置pc寄存器的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">set_pc_regs</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="p">,</span> <span class="n">remote_mmap_addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//设置寄存器的值,给远程进程的api传参
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">regs</span><span class="p">.</span><span class="n">ARM_r0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">regs</span><span class="p">.</span><span class="n">ARM_r1</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">regs</span><span class="p">.</span><span class="n">ARM_r2</span> <span class="o">=</span> <span class="n">PROT_READ</span> <span class="o">|</span> <span class="n">PROT_WRITE</span> <span class="o">|</span> <span class="n">PROT_EXEC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">regs</span><span class="p">.</span><span class="n">ARM_r3</span> <span class="o">=</span> <span class="n">MAP_PRIVATE</span> <span class="o">|</span> <span class="n">MAP_ANONYMOUS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">regs</span><span class="p">.</span><span class="n">ARM_sp</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//超过4个参数,入栈
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">         * 需要注意的是 PTRACE_POKEDATA, 一次只能写4字节内容
</span></span></span><span class="line"><span class="cl"><span class="cm">         * 如果要写2字节内容,需要先将原来的4字节内容取出来,修改低2字节,然后再写进去
</span></span></span><span class="line"><span class="cl"><span class="cm">         * 如果要写大量内容,就用虚拟文件系统来写, /proc/pid/mem
</span></span></span><span class="line"><span class="cl"><span class="cm">         */</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_POKEDATA</span><span class="p">,</span> <span class="n">nInjectPid</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">regs</span><span class="p">.</span><span class="n">ARM_sp</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_POKEDATA&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//设置远程进程寄存器的值,等待api函数执行完毕
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">api_end</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">regs</span><span class="p">.</span><span class="n">ARM_r0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//将远程进程dlopen的地址给pc寄存器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="nf">set_remote_dlopen</span><span class="p">(</span><span class="kt">int</span> <span class="n">nInjectPid</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">libPath</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//计算远程进程的dlopen地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="o">*</span><span class="n">remote_dlopen_addr</span> <span class="o">=</span> <span class="n">calc_remote_api_addr</span><span class="p">(</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">nInjectPid</span><span class="p">,</span> <span class="s">&#34;linker&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                                    <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">dlopen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">pt_regs</span> <span class="n">regs</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//设置pc寄存器的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">set_pc_regs</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="p">,</span> <span class="n">remote_dlopen_addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">regs</span><span class="p">.</span><span class="n">ARM_r0</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="n">libPath</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">regs</span><span class="p">.</span><span class="n">ARM_r1</span> <span class="o">=</span> <span class="n">RTLD_NOW</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">api_end</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;LuoInject Start %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">nInjectPid</span> <span class="o">=</span> <span class="mi">633</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//1 附加目标进程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_ATTACH</span><span class="p">,</span> <span class="n">nInjectPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_ATTACH</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//等待调试事件 会阻塞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">waitpid</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">WUNTRACED</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//当走到这个地方,说明要注入的程序已被附加 已经停止运行了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">//2 保存寄存器环境
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">pt_regs</span> <span class="n">oldRegs</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">get_remote_regs</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldRegs</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//3 修改寄存器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">//3.1 申请空间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">remote_mmap</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;remote_mmap OK addr = %08X</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//3.2 将库路径写入申请的地址空间中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">char</span> <span class="n">path</span><span class="p">[</span><span class="mi">260</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;/data/local/tmp/libinject.so&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="n">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_POKEDATA</span><span class="p">,</span> <span class="n">nInjectPid</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                   <span class="o">*</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_POKEDATA&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//3.3 将远程进程dlopen的地址给pc寄存器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">set_remote_dlopen</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;set_remote_dlopen OK</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//4 还原寄存器环境
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">set_remote_regs</span><span class="p">(</span><span class="n">nInjectPid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oldRegs</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//5 取消附加
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_DETACH</span><span class="p">,</span> <span class="n">nInjectPid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;PTRACE_DETACH&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;LuoInject End %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p><a href="/posts/android/android%E5%9F%BA%E7%A1%80/arm/Arm_Inject.7z">Arm_Inject.7z</a></p>
<ol start="4">
<li>注入</li>
</ol>
<p><img loading="lazy" src="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%B3%A8%E5%85%A5%E6%88%90%E5%8A%9F%E7%A4%BA%E4%BE%8B.png" alt="注入成功示例" srcset="/posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%B3%A8%E5%85%A5%E6%88%90%E5%8A%9F%E7%A4%BA%E4%BE%8B.png?size=small, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%B3%A8%E5%85%A5%E6%88%90%E5%8A%9F%E7%A4%BA%E4%BE%8B.png?size=medium 1.5x, /posts/android/android%E5%9F%BA%E7%A1%80/arm/images/Arm/%E6%B3%A8%E5%85%A5%E6%88%90%E5%8A%9F%E7%A4%BA%E4%BE%8B.png?size=large 2x" data-title="注入成功示例" style="--width: 1624px;--aspect-ratio: 1624 / 837;background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/></p>
<p><strong>需要注意的是</strong>,前面我们讲不是父子进程之间调试,就需要root权限.这里注入程序和注入的目标程序,不是父子关系没有root权限也可以调试的原因是:它们两个都是shell用户启动的,同用户名.</p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2021-08-29 00:00:00">更新于 2021-08-29&nbsp;</span>
      </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span></span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/arm/" class="post-tag" title="标签 - Arm">Arm</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="/posts/ida/idapython%E4%BD%BF%E7%94%A8/" class="post-nav-item" rel="prev" title="IDAPython使用笔记"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>IDAPython使用笔记</a>
      <a href="/posts/%E5%B9%B3%E5%8F%B0api/github/" class="post-nav-item" rel="next" title="Github Api调用">Github Api调用<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content always-active" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2020 - 2024</span><span class="author" itemprop="copyrightHolder">
              <a href="/">夏洛魂</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">该网站在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="preload" href="/lib/katex/katex.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/katex/katex.min.css"></noscript><script src="/lib/autocomplete/autocomplete.min.js" defer></script><script src="/lib/fuse/fuse.min.js" defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":150},"comment":{"enable":false},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":50,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"version":"v0.3.8-RC"};</script><script src="/js/theme.min.js" defer></script><script src="/js/custom.min.js" defer></script></body>
</html>
